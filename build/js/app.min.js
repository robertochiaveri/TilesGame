var game={utils:{},config:{},metrics:{}};window.Modernizr=function(e,t,n){function S(e){f.cssText=e}function T(e,t){return typeof e===t}var l,g,E,r="2.8.3",i={},s=!0,o=t.documentElement,u="modernizr",a=t.createElement(u),f=a.style,h=({}.toString,{}),v=[],m=v.slice,y=function(e,n,r,i){var s,a,f,l,c=t.createElement("div"),h=t.body,p=h||t.createElement("body");if(parseInt(r,10))for(;r--;)f=t.createElement("div"),f.id=i?i[r]:u+(r+1),c.appendChild(f);return s=["&#173;",'<style id="s',u,'">',e,"</style>"].join(""),c.id=u,(h?c:p).innerHTML+=s,p.appendChild(c),h||(p.style.background="",p.style.overflow="hidden",l=o.style.overflow,o.style.overflow="hidden",o.appendChild(p)),a=n(c,e),h?c.parentNode.removeChild(c):(p.parentNode.removeChild(p),o.style.overflow=l),!!a},b=function(t){var n=e.matchMedia||e.msMatchMedia;if(n)return n(t)&&n(t).matches||!1;var r;return y("@media "+t+" { #"+u+" { position: absolute; } }",function(t){r="absolute"==(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle).position}),r},w={}.hasOwnProperty;E=T(w,"undefined")||T(w.call,"undefined")?function(e,t){return t in e&&T(e.constructor.prototype[t],"undefined")}:function(e,t){return w.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if("function"!=typeof n)throw new TypeError;var r=m.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(m.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(m.call(arguments)))};return i});for(var k in h)E(h,k)&&(g=k.toLowerCase(),i[g]=h[k](),v.push((i[g]?"":"no-")+g));return i.addTest=function(e,t){if("object"==typeof e)for(var r in e)E(e,r)&&i.addTest(r,e[r]);else{if(e=e.toLowerCase(),i[e]!==n)return i;t="function"==typeof t?t():t,"undefined"!=typeof s&&s&&(o.className+=" "+(t?"":"no-")+e),i[e]=t}return i},S(""),a=l=null,i._version=r,i.mq=b,i.testStyles=y,o.className=o.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(s?" js "+v.join(" "):""),i}(this,this.document),function(){for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)}(),game.utils.addClass=function(element,cls){return game.utils.hasClass(element,cls)||(element.className=element.className+" "+game.utils.trim(cls)),element.className},game.utils.cloneObj=function(obj){if(null==obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&"htmlElement"!=attr&&(copy[attr]=obj[attr]);return copy},game.utils.createCSSClass=function(selector,style){if(document.styleSheets&&0!=document.getElementsByTagName("head").length){var mediaType;if(document.styleSheets.length>0)for(i=0;i<document.styleSheets.length;i++)if(!document.styleSheets[i].disabled){var media=document.styleSheets[i].media;if(mediaType=typeof media,"string"==mediaType?(""==media||-1!=media.indexOf("screen"))&&(styleSheet=document.styleSheets[i]):"object"==mediaType&&(""==media.mediaText||-1!=media.mediaText.indexOf("screen"))&&(styleSheet=document.styleSheets[i]),"undefined"!=typeof styleSheet)break}if("undefined"==typeof styleSheet){var styleSheetElement=document.createElement("style");for(styleSheetElement.type="text/css",document.getElementsByTagName("head")[0].appendChild(styleSheetElement),i=0;i<document.styleSheets.length;i++)document.styleSheets[i].disabled||(styleSheet=document.styleSheets[i]);var media=styleSheet.media;mediaType=typeof media}if("string"==mediaType){for(i=0;i<styleSheet.rules.length;i++)if(styleSheet.rules[i].selectorText.toLowerCase()==selector.toLowerCase())return void(styleSheet.rules[i].style.cssText=style);styleSheet.addRule(selector,style)}else if("object"==mediaType){for(i=0;i<styleSheet.cssRules.length;i++)if(styleSheet.cssRules[i].selectorText.toLowerCase()==selector.toLowerCase())return void(styleSheet.cssRules[i].style.cssText=style);styleSheet.insertRule(selector+"{"+style+"}",0)}}},game.utils.detectFullscreen=function(){return"standalone"in window.navigator&&window.navigator.standalone?!0:!1},game.utils.getBrowserPrefix=function(){var styles=window.getComputedStyle(document.documentElement,""),pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1],dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1];return{dom:dom,lowercase:pre,css:"-"+pre+"-",js:pre[0].toUpperCase()+pre.substr(1)}},game.utils.hasClass=function(element,cls){return(" "+element.className+" ").indexOf(" "+cls+" ")>-1},game.utils.listenTo=function(element,eventType,fn,listenersList){"use strict";if(listenersList=listenersList||{},!element)return console.log("can't find this element: "+element),!1;var id=element.id;if("undefined"==typeof id||""===id)if(element===document.body)id="body";else if(element===document.documentElement)id="html";else{if(element!==window)return console.log("better not add a listener to elements witout id: ",element),!1;id="window"}return"undefined"==typeof listenersList[id]&&(listenersList[id]={}),"undefined"!=typeof listenersList[id][eventType]?(console.log("cannot add another listener for "+eventType+" to ",element),!1):(listenersList[id][eventType]=fn,void(element.addEventListener?element.addEventListener&&(0===eventType.indexOf("touch")?element.addEventListener(eventType,function(event){if(event.preventDefault(),0===event.touches.length)fn(event);else for(var i=0;i<event.touches.length;i++)event.touches[i].timeStamp=event.timeStamp,event.touches[i].type=event.type,event.touches[i].multiTouchEvent=event,fn(event.touches[i])},!0):element.addEventListener(eventType,fn,!1)):element.attachEvent("on"+eventType,fn)))},game.utils.removeClass=function(element,cls){var regexp=new RegExp("\\b"+cls+"\\b","g");return element.className=" "+element.className+" ",element.className=game.utils.trim(element.className.replace(regexp,"")),element.className},game.utils.roundTo=function(input,num){var resto=input%num;return num/2>=resto?input-resto:input+num-resto},game.utils.stopListeningTo=function(element,eventType,listenersList){"use strict";if("undefined"==typeof listenersList)return console.log("no registered listeners"),!1;var id=element.id;if("undefined"==typeof element.id||""===element.id)if(element===document.body)id="body";else if(element===document.documentElement)id="html";else{if(element!==window)return console.log("better not add a listener to elements witout id: ",element),!1;id="window"}return"undefined"!=typeof listenersList[id][eventType]?(element.removeEventListener(eventType,listenersList[id][eventType]),listenersList[id][eventType]=void 0,!0):!1},game.utils.trim=function(str){for(var str=str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),ws=/\s/,i=str.length;ws.test(str.charAt(--i)););return str.slice(0,i+1)},game.utils.use3D=function(){return"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix},game.utils.useCSS3Animations=function(){var div=document.createElement("div"),divStyle=div.style,support={transition:""===divStyle.MozTransition?{name:"MozTransition",end:"transitionend"}:""===divStyle.MsTransition?{name:"MsTransition",end:"msTransitionend"}:""===divStyle.WebkitTransition?{name:"WebkitTransition",end:"webkitTransitionEnd"}:""===divStyle.OTransition?{name:"OTransition",end:"oTransitionEnd"}:""===divStyle.transition?{name:"transition",end:"transitionend"}:!1,transform:""===divStyle.MozTransform?"MozTransform":""===divStyle.MsTransform?"MsTransform":""===divStyle.WebkitTransform?"WebkitTransform":""===divStyle.OTransform?"OTransform":""===divStyle.transform?"transform":!1,animation:""===divStyle.MozAnimation?"MozAnimation":""===divStyle.MsAnimation?"MsAnimation":""===divStyle.WebkitAnimation?"WebkitAnimation":""===divStyle.OAnimation?"OAnimation":""===divStyle.animation?"animation":!1};return support},game.utils.useLocalStorage=function(){return"undefined"!=typeof Storage&&"undefined"!=typeof localStorage},game.utils.useTouch=function(){return!!("ontouchstart"in window)||!!("onmsgesturechange"in window)},game.config={size:{h:4,v:4},margin:{h:4,v:4},borderSize:4,pushMultiple:!0,touchTolerance:.2,transitionDuration:{generic:150,byKeyboard:100},useKeyboard:!0},game.config.easings={EASING_TILES_MOVEMENT:"cubic-bezier(0.403, 0.543, 0.754, 1)"},game.config.keycodes={KEY_ARROW_LEFT:37,KEY_ARROW_UP:38,KEY_ARROW_RIGHT:39,KEY_ARROW_DOWN:40,KEY_ESCAPE:2,KEY_RETURN:13},game.config.labels={WRAPPER_ID:"gameWrapper",GAME_ID:"game",BOARD_ID:"board",TOOLBAR_ID:"toolbar",TILE_PREFIX:"tile-",TBUTTON_PREFIX:"btn-",SELECTED_LABEL:"selected",PRESSED_LABEL:"pressed",NO_TRANSITIONS:"noTransitions",USETOUCH_LABEL:"useTouch",NO_TOUCH_LABEL:"noTouch",UP:"up",RIGHT:"right",DOWN:"down",LEFT:"left",LANDSCAPE:"landscape",PORTRAIT:"portrait",SAVEDGAMES_LABEL:"savedGames",AUTOSAVE_LABEL:"automatic",USERSAVE_LABEL:"user",SORTEDSAVE_LABEL:"sorted",SHUFFLEDSAVE_LABEL:"shuffled"},game.config.toolbarButtons=[{id:"new",description:"New game",handler:function(){window.confirm("Start a new game?")&&game.newGame()}},{id:"save",description:"Save the board",handler:function(){game.saveGame(game.config.labels.USERSAVE_LABEL),game.utils.addClass(document.getElementById("btn-save"),"on")}},{id:"load",description:"Load the saved board",handler:function(){window.confirm("Load the saved game?")&&game.loadGame(game.config.labels.USERSAVE_LABEL),game.animate({element:document.getElementById(game.config.labels.GAME_ID),animation:"load",duration:1e3})}},{id:"settings",description:"change your preferences",handler:function(){}},{id:"info",description:"About this game",handler:function(){}}],game.animate=function(params){"use strict";if("undefined"==typeof params||!params.element||"string"!=typeof params.animation)return console.log("wrong parameters in animate call",params),!1;"number"!=typeof params.duration&&(params.duration=game.config.transitionDuration.generic);for(var CSSstyleDeclaration,prefix="",p=0;p<game.config.CSSprefixes.length;p++)prefix=game.config.CSSprefixes[p],CSSstyleDeclaration+=prefix+"animation-fill-mode:both;",CSSstyleDeclaration+=prefix+"animation-duration:"+params.duration+"ms;",CSSstyleDeclaration+=prefix+"animation-name:"+params.animation+";","undefined"!=typeof params.iterations&&(CSSstyleDeclaration+=prefix+"animation-iteration-count:"+params.iteration+";"),"number"==typeof params.delay&&(CSSstyleDeclaration+=prefix+"animation-delay:"+params.delay+"ms;"),"string"==typeof params.easing&&(CSSstyleDeclaration+=prefix+"animation-timing-function:"+params.easing+";"),0>p?game.utils.listenTo(params.element,"animationEnd",function(event){event.target.style.animation=""}):game.utils.listenTo(params.element,game.config.CSSprefixes[p]+"AnimationEnd",function(event){event.target.style[event.type.replace("End","")]=""});params.element.style.cssText+=CSSstyleDeclaration},game.canMove=function(tile){var tile=game.isTile(tile),hole=game.runtime.tiles[game.config.labels.TILE_PREFIX+game.config.labels.HOLE_INDEX],holePosition=hole.col+"-"+hole.row;return tile?holePosition==tile.col+"-"+(tile.row-1)?game.config.labels.UP:holePosition==tile.col+1+"-"+tile.row?game.config.labels.RIGHT:holePosition==tile.col+"-"+(tile.row+1)?game.config.labels.DOWN:holePosition==tile.col-1+"-"+tile.row?game.config.labels.LEFT:!1:!1},game.canPush=function(tile){var tile=game.isTile(tile),hole=game.runtime.tiles[game.config.labels.TILE_PREFIX+game.config.labels.HOLE_INDEX],tilesToPush=(hole.col+"-"+hole.row,0);return tile?!game.config.pushMultiple||tile.col!=hole.col&&tile.row!=hole.row?!1:(tilesToPush=tile.col-hole.col==0?hole.row-tile.row:hole.col-tile.col,0==tilesToPush?!1:tile.col==hole.col?tilesToPush>0?{n:Math.abs(tilesToPush)-1,direction:game.config.labels.DOWN}:{n:Math.abs(tilesToPush)-1,direction:game.config.labels.UP}:tilesToPush>0?{n:Math.abs(tilesToPush)-1,direction:game.config.labels.RIGHT}:{n:Math.abs(tilesToPush)-1,direction:game.config.labels.LEFT}):!1},game.checkFeatures=function(){"use strict";game.config.useTouch=game.utils.useTouch(),game.config.use3Dtransforms=game.utils.use3D(),game.config.useLstorage=game.utils.useLocalStorage(),game.config.useCssAnimations=game.utils.useCSS3Animations(),game.config.launchedAsApp=game.utils.detectFullscreen(),game.config.CSSprefixes=["",game.utils.getBrowserPrefix().css]},game.countMove=function(){game.runtime.movesCount++},game.createBoard=function(){var boardHTML,tile,row=0,col=0;game.config.size.n=game.config.size.h*game.config.size.v,game.config.labels.HOLE_INDEX=game.config.size.n-1,boardHTML=document.createElement("div"),boardHTML.setAttribute("id",game.config.labels.BOARD_ID),game.config.useTouch?game.utils.addClass(document.documentElement,game.config.labels.USETOUCH_LABEL):game.utils.addClass(document.documentElement,game.config.labels.NO_TOUCH_LABEL),document.getElementById(game.config.labels.GAME_ID).appendChild(boardHTML);for(var i=0;i<game.config.size.n;i++)tile={i:i,id:game.config.labels.TILE_PREFIX+i,col:col,row:row,correctCol:col,correctRow:row,even:i%2===0?!0:!1,evenCol:col%2===0?!0:!1,evenRow:row%2===0?!0:!1},tile.htmlElement=document.createElement("div"),tile.htmlElement.setAttribute("id",game.config.labels.TILE_PREFIX+i),tile.htmlElement.setAttribute("tabindex",i),tile.htmlElement.setAttribute("class"," tile"+(tile.evenRow?" even-row":" odd-row")+(tile.evenCol?" even-col":" odd-col")+(tile.even?" even":" odd")+(i==game.config.labels.HOLE_INDEX?" hole":"")+" col-"+col+" row-"+row),tile.htmlElement.innerHTML='<div class="inner"><div class="number">'+(i+1)+"</div></div>",game.runtime.tiles[game.config.labels.TILE_PREFIX+i]=tile,document.getElementById(game.config.labels.BOARD_ID).appendChild(tile.htmlElement),col++,col>=game.config.size.h&&(row++,col=0);game.saveGame(game.config.labels.SORTEDSAVE_LABEL)},game.deselectTile=function(){var tile=game.isTile(game.runtime.selectedTile);if(!tile)return!1;if(game.utils.removeClass(tile.htmlElement,game.config.labels.SELECTED_LABEL),game.utils.removeClass(tile.htmlElement,game.config.labels.PRESSED_LABEL),"undefined"==typeof tile.newPosition)return!1;if("undefined"!=typeof tile.newPosition.left.newValue.pixels)if(game.config.pushMultiple&&"undefined"!=typeof tile.canPush.tiles){for(var i=tile.canPush.tiles.length;i>0;i--)tile.canPush.tiles[0].revert!==!0&&game.moveTile(tile.canPush.tiles[i-1],{transitions:!0,force:!1,refresh:!1}),game.utils.removeClass(tile.canPush.tiles[i-1].htmlElement,game.config.labels.SELECTED_LABEL);(Math.abs(tile.newPosition.left.newValue.pixels-tile.oldPosition.left.pixels)>=game.metrics.tileWidth/3||Math.abs(tile.newPosition.top.newValue.pixels-tile.oldPosition.top.pixels)>=game.metrics.tileHeight/3)&&game.moveTile(tile,{transitions:!0,force:!1,refresh:!1}),game.runtime.selectedTile=null,game.refresh({saveGame:!0})}else null!=tile.newPosition.left.newValue.pixels&&(Math.abs(tile.newPosition.left.newValue.pixels-tile.oldPosition.left.pixels)>=game.metrics.tileWidth/3||Math.abs(tile.newPosition.top.newValue.pixels-tile.oldPosition.top.pixels)>=game.metrics.tileHeight/3)?game.moveTile(tile,{transitions:!0,force:!1,refresh:!0}):game.refresh();game.runtime.selectedTile=null,game.runtime.dragging=!1},game.dragTile=function(event){if(!game.runtime.running)return game.deselectTile(),!1;var direction,newPosY,otherTile,otherTileNewPos,tile=game.isTile(game.runtime.selectedTile),CSSstyleDeclaration=null;if(!tile||!tile.canMove&&!tile.canPush.n||"undefined"==typeof tile.offset||"undefined"==typeof tile.newPosition)return game.deselectTile(),!1;if(newPosX=event.pageX-game.metrics.borderSize.pixels-game.metrics.left-tile.offset.left,newPosY=event.pageY-game.metrics.borderSize.pixels-game.metrics.top-tile.offset.top,direction=game.config.pushMultiple&&tile.canPush?tile.canPush.direction:tile.canMove,newPosY<tile.newPosition.top.min.pixels&&(newPosY=tile.newPosition.top.min.pixels),newPosY>tile.newPosition.top.max.pixels&&(newPosY=tile.newPosition.top.max.pixels),newPosX<tile.newPosition.left.min.pixels&&(newPosX=tile.newPosition.left.min.pixels),newPosX>tile.newPosition.left.max.pixels&&(newPosX=tile.newPosition.left.max.pixels),event.pageX-game.metrics.left-game.metrics.borderSize.pixels+game.metrics.tileWidth*game.config.touchTolerance<newPosX||event.pageX-game.metrics.left-game.metrics.borderSize.pixels-game.metrics.tileWidth*(1+game.config.touchTolerance)>newPosX||event.pageY-game.metrics.top-game.metrics.borderSize.pixels+game.metrics.tileHeight*game.config.touchTolerance<newPosY||event.pageY-game.metrics.top-game.metrics.borderSize.pixels-game.metrics.tileHeight*(1+game.config.touchTolerance)>newPosY)return game.deselectTile(),!1;var prefix="";switch(direction){case game.config.labels.LEFT:case game.config.labels.RIGHT:tile.newPosition.top.newValue.pixels=tile.oldPosition.top.pixels,tile.newPosition.left.newValue.pixels=newPosX,tile.newPosition.left.newValue.percent=100*newPosX/game.metrics.tileWidth;for(var p=0;p<game.config.CSSprefixes.length;p++)prefix=game.config.CSSprefixes[p],CSSstyleDeclaration+=prefix+"transform:translate"+game.metrics.transforms3Dsupport[0]+"("+tile.newPosition.left.newValue.percent+"%,"+tile.oldPosition.top.percent+"%"+game.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";tile.htmlElement.style.cssText=CSSstyleDeclaration;break;case game.config.labels.UP:case game.config.labels.DOWN:tile.newPosition.top.newValue.pixels=newPosY,tile.newPosition.left.newValue.pixels=tile.oldPosition.left.pixels,tile.newPosition.top.newValue.percent=100*newPosY/game.metrics.tileHeight;for(var p=0;p<game.config.CSSprefixes.length;p++)prefix=game.config.CSSprefixes[p],CSSstyleDeclaration+=prefix+"transform:translate"+game.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+tile.newPosition.top.newValue.percent+"%"+game.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";tile.htmlElement.style.cssText=CSSstyleDeclaration}if(game.config.pushMultiple&&"undefined"!=typeof tile.canPush.tiles)for(var i=0;i<tile.canPush.tiles.length;i++){otherTile=tile.canPush.tiles[i];var prefix="";switch(direction){case game.config.labels.UP:if(otherTileNewPos=tile.newPosition.top.newValue.pixels-game.metrics.tileHeight*(i+1),!(otherTileNewPos<tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;tile.canPush.tiles[i].max=otherTileNewPos;for(var p=0;p<game.config.CSSprefixes.length;p++)prefix=game.config.CSSprefixes[p],CSSstyleDeclaration+=prefix+"transform:translate"+game.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+otherTileNewPos+"px"+game.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case game.config.labels.RIGHT:if(otherTileNewPos=tile.newPosition.left.newValue.pixels+game.metrics.tileWidth*(i+1),!(otherTileNewPos>tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;tile.canPush.tiles[i].max=otherTileNewPos;for(var p=0;p<game.config.CSSprefixes.length;p++)prefix=game.config.CSSprefixes[p],CSSstyleDeclaration+=prefix+"transform:translate"+game.metrics.transforms3Dsupport[0]+"("+otherTileNewPos+"px,"+tile.oldPosition.top.percent+"%"+game.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case game.config.labels.DOWN:if(otherTileNewPos=tile.newPosition.top.newValue.pixels+game.metrics.tileHeight*(i+1),!(otherTileNewPos>tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;tile.canPush.tiles[i].max=otherTileNewPos;for(var p=0;p<game.config.CSSprefixes.length;p++)prefix=game.config.CSSprefixes[p],CSSstyleDeclaration+=prefix+"transform:translate"+game.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+otherTileNewPos+"px"+game.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case game.config.labels.LEFT:if(otherTileNewPos=tile.newPosition.left.newValue.pixels-game.metrics.tileWidth*(i+1),!(otherTileNewPos<tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;tile.canPush.tiles[i].max=otherTileNewPos;for(var p=0;p<game.config.CSSprefixes.length;p++)prefix=game.config.CSSprefixes[p],CSSstyleDeclaration+=prefix+"transform:translate"+game.metrics.transforms3Dsupport[0]+"("+otherTileNewPos+"px,"+tile.oldPosition.top.percent+"%"+game.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; "}otherTile.htmlElement.style.cssText=CSSstyleDeclaration,Math.abs(tile.oldPosition.left.pixels-tile.newPosition.left.newValue.pixels)>game.metrics.tileWidth/4||Math.abs(tile.oldPosition.top.pixels-tile.newPosition.top.newValue.pixels)>game.metrics.tileHeight/4?otherTile.revert=!1:otherTile.revert=!0}},game.getMovableTiles=function(params){var t,direction=params.direction,pushing=params.pushing,moving=params.moving;if(game.runtime.movableTiles=[],game.runtime.running||params.force===!0)for(var i=0;i<game.config.size.n;i++)t=game.runtime.tiles["tile-"+i],t.canMove&&moving&&("undefined"==typeof direction||direction==t.canMove)&&game.runtime.movableTiles.push(game.getTile(game.config.labels.TILE_PREFIX+t.i)),game.config.pushMultiple&&pushing&&t.canPush&&!t.canMove&&("undefined"==typeof direction||direction==t.canPush.direction)&&game.runtime.movableTiles.push(game.getTile(game.config.labels.TILE_PREFIX+t.i));return game.runtime.movableTiles},game.getTile=function(param){var target=null,maxLevels=5,tiles=game.runtime.tiles,col=parseInt(param.col),row=parseInt(param.row),prefix=game.config.labels.TILE_PREFIX;switch(typeof param){case"object":if(param.srcElement)target=param.srcElement;else{if(!param.pageX||!param.pageY){if(isNaN(parseInt(param.col))||isNaN(parseInt(param.row)))return!1;for(var i=0;i<game.config.size.n;i++)if(tiles[prefix+i].col==col&&tiles[prefix+i].row==row)return tiles[prefix+i];return!1}target=document.elementFromPoint(param.pageX,param.pageY)}if(null===target)return!1;for(i=0;maxLevels>i;i++){if("undefined"==typeof target||"undefined"==typeof target.parentNode||null===target||null===target.parentNode)return!1;if(target.parentNode.id==game.config.labels.BOARD_ID)return game.runtime.tiles[target.id];target=target.parentNode}return!1;case"string":return 0===param.indexOf(prefix)?tiles[param]:!1;case"number":return param<game.config.size.n?tiles[prefix+param]:!1}},game.init=function(){"use strict";game.runtime={started:!1,running:!1,ended:!1,timePlaying:0,movesCount:!1,dragging:!1,resizeTimer:-1,selectedTile:null,tiles:{},latestSelection:0,eventListeners:{}},game.checkFeatures(),game.createBoard(),game.metricsUpdate(),game.initListeners(),game.refresh({transitions:!1}),game.loadGame()?(game.animate({element:document.getElementById(game.config.labels.GAME_ID),animation:"load",duration:1e3}),game.start()):game.newGame()},game.initListeners=function(){game.utils.listenTo(document.getElementById(game.config.labels.BOARD_ID),game.config.useTouch?"touchstart":"mousedown",function(event){return event.timeStamp-game.runtime.latestSelection<300?!1:(game.runtime.latestSelection=event.timeStamp,void game.selectTile(game.getTile(event),event))},game.runtime.eventListeners),game.utils.listenTo(document.getElementById(game.config.labels.BOARD_ID),game.config.useTouch?"touchmove":"mousemove",function(event){if(game.runtime.selectedTile)game.dragTile(event);else if("mousemove"!=event.type){if(event.timeStamp-game.runtime.latestSelection<300)return!1;game.runtime.latestSelection=event.timeStamp,game.selectTile(game.getTile(event),event)}},game.runtime.eventListeners),game.utils.listenTo(document.getElementById(game.config.labels.WRAPPER_ID),game.config.useTouch?"touchend":"mouseup",function(event){return"undefined"==typeof game.runtime.selectedTile||null===game.runtime.selectedTile?!1:void game.deselectTile()},game.runtime.eventListeners),game.utils.listenTo(document.getElementById(game.config.labels.GAME_ID),"mouseout",function(e){e=e?e:window.event;var from=e.relatedTarget||e.toElement;from&&"HTML"!=from.nodeName||game.deselectTile()},game.runtime.eventListeners),game.config.useKeyboard&&game.utils.listenTo(document.body,"keyup",function(e){switch(e.which){case game.config.keycodes.KEY_ARROW_LEFT:game.moveAnyTile({direction:game.config.labels.LEFT,pushing:e.ctrlKey});break;case game.config.keycodes.KEY_ARROW_UP:game.moveAnyTile({direction:game.config.labels.UP,pushing:e.ctrlKey});break;case game.config.keycodes.KEY_ARROW_RIGHT:game.moveAnyTile({direction:game.config.labels.RIGHT,pushing:e.ctrlKey});break;case game.config.keycodes.KEY_ARROW_DOWN:game.moveAnyTile({direction:game.config.labels.DOWN,pushing:e.ctrlKey})}},game.runtime.eventListeners),game.utils.listenTo(window,"resize",function(e){-1!=game.runtime.resizeTimer&&clearTimeout(game.runtime.resizeTimer),game.runtime.resizeTimer=window.setTimeout(function(){game.deselectTile(),game.metricsUpdate(),game.refresh()},100)},game.runtime.eventListeners)},game.isTile=function(tile){if(null==tile||void 0==tile)return!1;switch(typeof tile){case"object":if(tile.id.indexOf(game.config.labels.TILE_PREFIX)<0)return!1;break;case"string":if(tile=game.runtime.tiles[tile],"undefined"==typeof tile)return!1;if(tile.id.indexOf(game.config.labels.TILE_PREFIX)<0)return!1;break;default:return!1}return tile},game.loadGame=function(type){if(!game.config.useLstorage)return!1;"undefined"==typeof type&&(type=game.config.labels.AUTOSAVE_LABEL);var loadedGames=JSON.parse(localStorage.getItem(game.config.labels.SAVEDGAMES_LABEL)),loadedGame=null;if(null!=loadedGames){if("undefined"!=typeof loadedGames[type]&&null!=loadedGames[type]){if(loadedGame=loadedGames[type],loadedGame.saveDate=new Date(Date.UTC.apply(this,loadedGame.saveDate.match(/\d+\.{0,1}\d+/g))),loadedGame.startedDate&&(loadedGame.startedDate=new Date(Date.UTC.apply(this,loadedGame.startedDate.match(/\d+\.{0,1}\d+/g)))),loadedGame.size!=game.config.size.n)return console.log("cannot load game: different sizes:",loadedGame.tiles.length,game.config.size.n),!1;game.runtime.tiles=loadedGame.tiles;for(var i=0;i<game.config.size.n;i++)tileID=game.config.labels.TILE_PREFIX+i,loadedGame.tiles[tileID].htmlElement=document.getElementById(tileID);return game.runtime.started=loadedGame.startedDate,game.runtime.movesCount=parseInt(loadedGame.movesCount),game.refresh({transitions:"user"==type}),console.log("game loaded"),!0}return console.log("cannot find saved game '"+type+"'"),!1}return console.log("cannot find any saved game"),!1},game.metricsUpdate=function(){game.metrics=game.metrics||{};var wrapperHTML=document.getElementById(game.config.labels.WRAPPER_ID),gameHTML=document.getElementById(game.config.labels.GAME_ID),wrapperWidth=(document.getElementById(game.config.labels.BOARD_ID),wrapperHTML.offsetWidth);wrapperHeight=wrapperHTML.offsetHeight,windowWidth=window.innerWidth,windowHeight=window.innerHeight,game.metrics.transforms3Dsupport=game.config.use3Dtransforms?["3d",",0"]:["",""],game.metrics.wrapperOrientation=wrapperWidth>=wrapperHeight?game.config.labels.LANDSCAPE:game.config.labels.PORTRAIT,game.metrics.wrapperRatio=wrapperWidth/wrapperHeight,game.metrics.pixelRatio=window.devicePixelRatio>1?window.devicePixelRatio:1,"undefined"==typeof game.metrics.wrapperSize&&(game.metrics.wrapperSize={}),game.metrics.wrapperSize[game.metrics.wrapperOrientation]={width:wrapperWidth,height:wrapperHeight},game.metrics.boardLayout=game.config.size.h>=game.config.size.v?game.config.labels.LANDSCAPE:game.config.labels.PORTRAIT,game.metrics.boardRatio=game.config.size.h/game.config.size.v,game.metrics.fontSize=parseInt((document.body.currentStyle||window.getComputedStyle&&getComputedStyle(document.body,null)||document.body.style).fontSize),game.metrics.marginH={percent:game.config.margin.h,pixels:0},game.metrics.marginV={percent:game.config.margin.v,pixels:0},game.metrics.borderSize={percent:game.config.borderSize,pixels:0},game.metrics.wrapperOrientation===game.config.labels.LANDSCAPE?(game.metrics.height=game.utils.roundTo(wrapperHeight/100*(100-2*game.config.borderSize-2*game.metrics.marginV.percent),game.config.size.h),game.metrics.width=game.metrics.height,game.metrics.borderSize.pixels=Math.round(wrapperHeight/100*game.config.borderSize),game.metrics.marginH.pixels=Math.round(wrapperHeight/100*game.metrics.marginH.percent),game.metrics.marginV.pixels=Math.round(wrapperHeight/100*game.metrics.marginV.percent),game.metrics.left=Math.round((wrapperWidth-game.metrics.width-game.metrics.borderSize.pixels-game.metrics.marginH.pixels)/2),game.metrics.top=Math.round((game.metrics.wrapperSize[game.metrics.wrapperOrientation].height-game.metrics.height-game.metrics.borderSize.pixels-game.metrics.marginV.pixels)/2)):(game.metrics.width=game.utils.roundTo(wrapperWidth/100*(100-2*game.config.borderSize-2*game.metrics.marginH.percent),game.config.size.v),game.metrics.height=game.metrics.width,game.metrics.borderSize.pixels=Math.round(wrapperWidth/100*game.config.borderSize),game.metrics.marginH.pixels=Math.round(wrapperWidth/100*game.metrics.marginH.percent),game.metrics.marginV.pixels=Math.round(wrapperWidth/100*game.metrics.marginV.percent),game.metrics.left=Math.round((wrapperWidth-game.metrics.width-game.metrics.borderSize.pixels-game.metrics.marginH.pixels)/2),game.metrics.top=Math.round((game.metrics.wrapperSize[game.metrics.wrapperOrientation].height-game.metrics.height-game.metrics.borderSize.pixels-game.metrics.marginV.pixels)/2)),game.metrics.tileWidth=Math.round(game.metrics.width/game.config.size.h),game.metrics.tileHeight=Math.round(game.metrics.height/game.config.size.v),wrapperHTML.style.visibility="hidden";var CSSstyleDeclaration="padding:"+Math.round(game.metrics.borderSize.pixels)+"px;width:"+game.metrics.width+"px; height:"+game.metrics.height+"px; left:"+game.metrics.left+"px; top:"+game.metrics.top+"px; ";gameHTML.style.cssText=CSSstyleDeclaration,game.utils.createCSSClass(".tile","width: "+100/game.config.size.h+"%; height: "+100/game.config.size.v+"%; "),game.utils.createCSSClass(".tile > .inner","background-size: auto "+game.metrics.height+"px;"),game.utils.createCSSClass(".tile > .inner > .number","font-size: "+document.getElementById(game.config.labels.BOARD_ID).offsetHeight/game.config.size.v/2/10+"em;"),window.scrollTo(0,1),wrapperHTML.style.visibility="visible"},game.moveAnyTile=function(params){for(var tiles=1==params.pushing?game.getMovableTiles({pushing:!1,moving:!0,direction:params.direction}).concat(game.getMovableTiles({pushing:!0,moving:!1,direction:params.direction}).sort(function(t1,t2){return t1.canPush.n-t2.canPush.n})):game.getMovableTiles({pushing:!1,moving:!0,direction:params.direction}),i=0;i<tiles.length;i++)game.moveTile(tiles[i],{transitions:!1,force:!1,refresh:!1});return game.refresh({transitionDuration:game.config.transitionDuration.byKeyboard}),tiles},game.moveTile=function(tile,params){if(tile=game.isTile(tile),!tile)return!1;var hole=game.runtime.tiles[game.config.labels.TILE_PREFIX+game.config.labels.HOLE_INDEX],temp={};if(!game.canMove(tile))return!1;if(params.force!==!0){if(!game.runtime.running)return!1;game.countMove()}return temp.col=tile.col,temp.row=tile.row,tile.col=hole.col,tile.row=hole.row,hole.col=temp.col,hole.row=temp.row,params.refresh===!0&&game.refresh({transitions:params.transitions,saveGame:!params.force,redraw:!params.force}),!0},game.newGame=function(){var animationDuration=2e3;game.runtime.running?(console.log("user reset"),game.stop(),setTimeout(function(){game.loadGame(game.config.labels.SORTEDSAVE_LABEL),game.refresh({transitions:!1}),game.saveGame(game.config.labels.SORTEDSAVE_LABEL)},.34*animationDuration),game.animate({element:document.getElementById(game.config.labels.GAME_ID),animation:"resetboard",duration:animationDuration,easing:"ease-in-out"})):(console.log("first launch"),game.refresh({transitions:!1}),game.saveGame(game.config.labels.SORTEDSAVE_LABEL),game.animate({element:document.getElementById(game.config.labels.GAME_ID),animation:"intro",duration:animationDuration})),setTimeout(function(){
game.shuffle(game.config.size.n*game.config.size.n),game.saveGame(game.config.labels.SHUFFLEDSAVE_LABEL),game.start()},.85*animationDuration)},game.refresh=function(params){var tileID,tile,CSSstyleDeclaration="",win=!0;"undefined"==typeof params&&(params={transitions:!0,saveGame:!1}),params.transitions===!1?params.transitionDuration=0:"number"!=typeof params.transitionDuration&&(params.transitionDuration=game.config.transitionDuration.generic);for(var i=0;i<game.config.size.n;i++){tileID=game.config.labels.TILE_PREFIX+i,tile=game.runtime.tiles[tileID];for(var prefix="",p=0;p<game.config.CSSprefixes.length;p++)prefix=game.config.CSSprefixes[p],CSSstyleDeclaration+=prefix+"transform:translate"+game.metrics.transforms3Dsupport[0]+"("+100*tile.col+"%,"+100*tile.row+"%"+game.metrics.transforms3Dsupport[1]+"); ",CSSstyleDeclaration+=prefix+"transition-property:"+prefix+"transform;",CSSstyleDeclaration+=prefix+"transition-duration:"+parseInt(Math.abs(params.transitionDuration))+"ms !important;",CSSstyleDeclaration+=prefix+"transition-timing-function:"+game.config.easings.EASING_TILES_MOVEMENT+";";params.redraw!==!1&&(tile.htmlElement.style.cssText=CSSstyleDeclaration),tile.htmlElement.childNodes[0].style.backgroundPosition="-"+tile.correctCol*game.metrics.tileWidth+"px -"+tile.correctRow*game.metrics.tileHeight+"px",tile.canMove=game.canMove(tileID),tile.canPush=game.canPush(tileID),delete tile.offset,delete tile.newPosition,delete tile.oldPosition,delete tile.timeStamp,delete tile.revert,delete tile.max,(tile.correctCol!=tile.col||tile.correctRow!=tile.row)&&(win=!1)}game.runtime.running&&win&&(setTimeout(function(){alert("Hai vinto!")},500),game.stop()),params.saveGame===!0&&game.saveGame()},game.saveGame=function(type){if(!game.config.useLstorage)return!1;if(0!=game.runtime.ended)return!1;"undefined"==typeof type&&(type="automatic");var savedGames={},savedGame={saveDate:(new Date).toUTCString(),type:type,size:game.config.size.n,tiles:{},movesCount:game.runtime.movesCount};null!=JSON.parse(localStorage.getItem(game.config.labels.SAVEDGAMES_LABEL))&&(savedGames=JSON.parse(localStorage.getItem(game.config.labels.SAVEDGAMES_LABEL))),game.runtime.started&&(savedGame.startedDate=game.runtime.started.toUTCString());for(var i=0;i<game.config.size.n;i++)tileID=game.config.labels.TILE_PREFIX+i,savedGame.tiles[tileID]=game.utils.cloneObj(game.runtime.tiles[tileID]);savedGames[type]=savedGame,localStorage.setItem(game.config.labels.SAVEDGAMES_LABEL,JSON.stringify(savedGames)),console.log("game saved ("+type+")")},game.selectTile=function(tile,event){if(!game.runtime.running)return!1;if(tile=game.isTile(tile),!tile)return!1;var direction=game.config.pushMultiple&&tile.canPush?tile.canPush.direction:tile.canMove;if(game.runtime.selectedTile=tile,game.canMove(tile)||game.config.pushMultiple){switch(game.runtime.selectedTile.timeStamp="undefined"!=typeof event?event.timeStamp:new Date,game.runtime.selectedTile.oldPosition={left:{percent:100*tile.col,pixels:game.metrics.tileWidth*tile.col},top:{percent:100*tile.row,pixels:game.metrics.tileHeight*tile.row}},game.runtime.selectedTile.offset="undefined"!=typeof event?{top:(event.pageY-game.metrics.top-game.metrics.borderSize.pixels)%game.metrics.tileHeight,left:(event.pageX-game.metrics.left-game.metrics.borderSize.pixels)%game.metrics.tileWidth}:{top:game.metrics.tileHeight/2,left:game.metrics.tileWidth/2},game.runtime.selectedTile.newPosition={top:{min:{pixels:null,percent:null},newValue:{pixels:null,percent:null},max:{pixels:null,percent:null}},left:{min:{pixels:null,percent:null},newValue:{pixels:null,percent:null},max:{pixels:null,percent:null}}},direction){case game.config.labels.UP:game.runtime.selectedTile.newPosition.top.min.pixels=Math.round(game.runtime.selectedTile.oldPosition.top.pixels-game.metrics.tileHeight),game.runtime.selectedTile.newPosition.top.max.pixels=Math.round(game.runtime.selectedTile.oldPosition.top.pixels),game.runtime.selectedTile.newPosition.left.min.pixels=Math.round(game.runtime.selectedTile.oldPosition.left.pixels),game.runtime.selectedTile.newPosition.left.max.pixels=Math.round(game.runtime.selectedTile.oldPosition.left.pixels);break;case game.config.labels.DOWN:game.runtime.selectedTile.newPosition.top.min.pixels=Math.round(game.runtime.selectedTile.oldPosition.top.pixels),game.runtime.selectedTile.newPosition.top.max.pixels=Math.round(game.runtime.selectedTile.oldPosition.top.pixels+game.metrics.tileHeight),game.runtime.selectedTile.newPosition.left.min.pixels=Math.round(game.runtime.selectedTile.oldPosition.left.pixels),game.runtime.selectedTile.newPosition.left.max.pixels=Math.round(game.runtime.selectedTile.oldPosition.left.pixels);break;case game.config.labels.LEFT:game.runtime.selectedTile.newPosition.left.min.pixels=Math.round(game.runtime.selectedTile.oldPosition.left.pixels-game.metrics.tileWidth),game.runtime.selectedTile.newPosition.left.max.pixels=Math.round(game.runtime.selectedTile.oldPosition.left.pixels),game.runtime.selectedTile.newPosition.top.min.pixels=Math.round(game.runtime.selectedTile.oldPosition.top.pixels),game.runtime.selectedTile.newPosition.top.max.pixels=Math.round(game.runtime.selectedTile.oldPosition.top.pixels);break;case game.config.labels.RIGHT:game.runtime.selectedTile.newPosition.left.min.pixels=Math.round(game.runtime.selectedTile.oldPosition.left.pixels),game.runtime.selectedTile.newPosition.left.max.pixels=Math.round(game.runtime.selectedTile.oldPosition.left.pixels+game.metrics.tileWidth),game.runtime.selectedTile.newPosition.top.min.pixels=Math.round(game.runtime.selectedTile.oldPosition.top.pixels),game.runtime.selectedTile.newPosition.top.max.pixels=Math.round(game.runtime.selectedTile.oldPosition.top.pixels)}if(game.runtime.dragging||game.utils.addClass(tile.htmlElement,game.config.labels.PRESSED_LABEL+" "+game.config.labels.SELECTED_LABEL),game.config.pushMultiple){tile.canPush.tiles=[];for(var i=1;i<=tile.canPush.n;i++){switch(tile.canPush.direction){case game.config.labels.UP:tile.canPush.tiles.push(game.getTile({col:tile.col,row:tile.row-i}));break;case game.config.labels.RIGHT:tile.canPush.tiles.push(game.getTile({col:tile.col+i,row:tile.row}));break;case game.config.labels.DOWN:tile.canPush.tiles.push(game.getTile({col:tile.col,row:tile.row+i}));break;case game.config.labels.LEFT:tile.canPush.tiles.push(game.getTile({col:tile.col-i,row:tile.row}))}tile.canPush.tiles[i-1].max=null,game.runtime.dragging||game.utils.addClass(tile.canPush.tiles[i-1].htmlElement,game.config.labels.SELECTED_LABEL)}}game.runtime.dragging=!0}},game.shuffle=function(n,refresh){console.log("shuffle"),"undefined"==typeof n&&(n=10*game.config.size.n),"undefined"==typeof refresh&&(refresh=!0);for(var d,directions=["up","right","down","left"],movableTiles=[],i=0;n>i;i++)d=directions[Math.round(Math.random()*(directions.length-1))],movableTiles=game.getMovableTiles({direction:d,pushing:!1,moving:!0,force:!0}),game.moveTile(movableTiles[0],{transitions:!1,force:!0,refresh:!0});refresh&&game.refresh({transitions:!0,transitionDuration:100}),t1=new Date},game.start=function(){game.runtime.started=new Date,game.runtime.ended=!1,game.runtime.running=!0,game.runtime.movesCount=0,console.log("game started")},game.stop=function(){game.runtime.ended=new Date,game.runtime.running=!1,console.log("game stopped")};
//# sourceMappingURL=app.min.js.map