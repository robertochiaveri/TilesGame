function getClosestColor(inputColor,palette){"use strict";function isValidColor(color){return"string"==typeof color&&!!/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(color)}function normalizedColor(color){return isValidColor(color)&&7!==color.length&&(color=color[0]+color[1]+color[1]+color[2]+color[2]+color[3]+color[3]),color.toUpperCase()}function isValidPalette(palette){if("object"!=typeof palette||!(palette instanceof Array))return!1;if(0===palette.length)return!1;for(var i=0;i<palette.length;i++){if(!isValidColor(palette[i]))return!1;palette[i]=normalizedColor(palette[i])}return!0}function normalizedPalette(palette){if(isValidPalette(palette))for(var i=0;i<palette.length;i++)palette[i]=normalizedColor(palette[i]);return palette}function hex2dec(hex){return parseInt(hex,16)}function getComponents(color){function rgbToXyz(r,g,b){var _r=r/255,_g=g/255,_b=b/255;return _r>.04045?_r=Math.pow((_r+.055)/1.055,2.4):_r/=12.92,_g>.04045?_g=Math.pow((_g+.055)/1.055,2.4):_g/=12.92,_b>.04045?_b=Math.pow((_b+.055)/1.055,2.4):_b/=12.92,_r*=100,_g*=100,_b*=100,[.4124*_r+.3576*_g+.1805*_b,.2126*_r+.7152*_g+.0722*_b,.0193*_r+.1192*_g+.9505*_b]}function xyzToLab(x,y,z){var ref_X=95.047,ref_Y=100,ref_Z=108.883,_X=x/ref_X,_Y=y/ref_Y,_Z=z/ref_Z;return _X=_X>.008856?Math.pow(_X,1/3):7.787*_X+16/116,_Y=_Y>.008856?Math.pow(_Y,1/3):7.787*_Y+16/116,_Z=_Z>.008856?Math.pow(_Z,1/3):7.787*_Z+16/116,[116*_Y-16,500*(_X-_Y),200*(_Y-_Z)]}function rgbToLab(r,g,b){var xyz=rgbToXyz(r,g,b);return xyzToLab(xyz[0],xyz[1],xyz[2])}var r=hex2dec(color.substr(1,2)),g=hex2dec(color.substr(3,2)),b=hex2dec(color.substr(5,2));return{hex:color,rgb:[r,g,b],lab:rgbToLab(r,g,b)}}function colorDifference(color1,color2){var lab1=getComponents(color1).lab,lab2=getComponents(color2).lab;return Math.sqrt(Math.pow(lab2[0]-lab1[0],2)+Math.pow(lab2[1]-lab1[1],2)+Math.pow(lab2[2]-lab1[2],2))}if(palette=normalizedPalette(palette),!(inputColor=normalizedColor(inputColor)))throw"error: invalid input color";if(!palette)throw"error: invalid input palette";for(var closestColor=palette[0],i=0;i<palette.length;i++)colorDifference(inputColor,palette[i])<colorDifference(inputColor,closestColor)&&(closestColor=palette[i]);return closestColor}function jsonpCall(url,callback){"use strict";var callbackName="jsonp_callback_"+Math.round(1e5*Math.random());window[callbackName]=function(data){delete window[callbackName],document.body.removeChild(jsonpCallScript),callback(data)};var jsonpCallScript=document.createElement("script");jsonpCallScript.src=url+(url.indexOf("?")>=0?"&":"?")+"callback="+callbackName,document.body.appendChild(jsonpCallScript)}var game={utils:{},config:{},metrics:{}};window.Modernizr=function(e,t,n){function C(e){f.cssText=e}function L(e,t){return typeof e===t}function A(e,t){return!!~(""+e).indexOf(t)}function O(e,t){for(var r in e){var i=e[r];if(!A(i,"-")&&f[i]!==n)return"pfx"!=t||i}return!1}function M(e,t,r){for(var i in e){var s=t[e[i]];if(s!==n)return!1===r?e[i]:L(s,"function")?s.bind(r||t):s}return!1}function _(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+" "+d.join(r+" ")+r).split(" ");return L(t,"string")||L(t,"undefined")?O(i,t):(i=(e+" "+v.join(r+" ")+r).split(" "),M(i,t,n))}var E,N,r="2.8.3",i={},s=!0,o=t.documentElement,u="modernizr",a=t.createElement(u),f=a.style,h=" -webkit- -moz- -o- -ms- ".split(" "),p="Webkit Moz O ms",d=p.split(" "),v=p.toLowerCase().split(" "),m={},b=[],w=b.slice,S=function(e,n,r,i){var s,a,f,l,c=t.createElement("div"),h=t.body,p=h||t.createElement("body");if(parseInt(r,10))for(;r--;)f=t.createElement("div"),f.id=i?i[r]:u+(r+1),c.appendChild(f);return s=["&#173;",'<style id="s',u,'">',e,"</style>"].join(""),c.id=u,(h?c:p).innerHTML+=s,p.appendChild(c),h||(p.style.background="",p.style.overflow="hidden",l=o.style.overflow,o.style.overflow="hidden",o.appendChild(p)),a=n(c,e),h?c.parentNode.removeChild(c):(p.parentNode.removeChild(p),o.style.overflow=l),!!a},x=function(t){var n=e.matchMedia||e.msMatchMedia;if(n)return n(t)&&n(t).matches||!1;var r;return S("@media "+t+" { #"+u+" { position: absolute; } }",function(t){r="absolute"==(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle).position}),r},T={}.hasOwnProperty;N=L(T,"undefined")||L(T.call,"undefined")?function(e,t){return t in e&&L(e.constructor.prototype[t],"undefined")}:function(e,t){return T.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if("function"!=typeof n)throw new TypeError;var r=w.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(w.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(w.call(arguments)))};return i}),m.touch=function(){var n;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:S(["@media (",h.join("touch-enabled),("),u,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){n=9===e.offsetTop}),n},m.cssanimations=function(){return _("animationName")},m.csstransforms3d=function(){var e=!!_("perspective");return e&&"webkitPerspective"in o.style&&S("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t,n){e=9===t.offsetLeft&&3===t.offsetHeight}),e},m.csstransitions=function(){return _("transition")},m.localstorage=function(){try{return localStorage.setItem(u,u),localStorage.removeItem(u),!0}catch(e){return!1}};for(var D in m)N(m,D)&&(E=D.toLowerCase(),i[E]=m[D](),b.push((i[E]?"":"no-")+E));return i.addTest=function(e,t){if("object"==typeof e)for(var r in e)N(e,r)&&i.addTest(r,e[r]);else{if(e=e.toLowerCase(),i[e]!==n)return i;t="function"==typeof t?t():t,void 0!==s&&s&&(o.className+=" "+(t?"":"no-")+e),i[e]=t}return i},C(""),a=null,i._version=r,i._prefixes=h,i._domPrefixes=v,i._cssomPrefixes=d,i.mq=x,i.testProp=function(e){return O([e])},i.testAllProps=_,i.testStyles=S,o.className=o.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(s?" js "+b.join(" "):""),i}(this,this.document),function(){"use strict";for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)}(),game.utils.addClass=function(element,cls){"use strict";return-1===(" "+element.className+" ").indexOf(" "+cls+" ")&&(element.className=element.className+" "+cls),element.className.replace(/  +/g," ")},game.utils.checkBrowser=function(){return!(/MSIE\s/.test(navigator.userAgent)&&parseFloat(navigator.appVersion.split("MSIE")[1])<11)},game.utils.cloneObj=function(obj){"use strict";if(null===obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&"htmlElement"!==attr&&(copy[attr]=obj[attr]);return copy},game.utils.createCSSClass=function(selector,style){"use strict";if(!document.styleSheets)return!1;if(0===document.getElementsByTagName("head").length)return!1;var styleSheet,mediaType,media,i;if(document.styleSheets.length>0)for(i=0;i<document.styleSheets.length&&(document.styleSheets[i].disabled||(media=document.styleSheets[i].media,mediaType=typeof media,"string"===mediaType?""!==media&&-1===media.indexOf("screen")||(styleSheet=document.styleSheets[i]):"object"===mediaType&&(""!==media.mediaText&&-1===media.mediaText.indexOf("screen")||(styleSheet=document.styleSheets[i])),void 0===styleSheet));i++);if(void 0===styleSheet){var styleSheetElement=document.createElement("style");for(styleSheetElement.type="text/css",document.getElementsByTagName("head")[0].appendChild(styleSheetElement),i=0;i<document.styleSheets.length;i++)document.styleSheets[i].disabled||(styleSheet=document.styleSheets[i]);media=styleSheet.media,mediaType=typeof media}if("string"===mediaType){for(i=0;i<styleSheet.rules.length;i++)if(styleSheet.rules[i].selectorText.toLowerCase()===selector.toLowerCase())return void(styleSheet.rules[i].style.cssText=style);styleSheet.addRule(selector,style)}else if("object"===mediaType){for(i=0;i<styleSheet.cssRules.length;i++)if(styleSheet.cssRules[i].selectorText.toLowerCase()===selector.toLowerCase())return void(styleSheet.cssRules[i].style.cssText=style);styleSheet.insertRule(selector+"{"+style+"}",0)}},game.utils.detectFullscreen=function(){"use strict";return!!("standalone"in window.navigator&&window.navigator.standalone)},game.utils.editCSSRule=function(ruleClass,property,newValue){"use strict";for(var s=0;s<document.styleSheets.length;s++){var sheet=document.styleSheets[s],rules=sheet.cssRules?sheet.cssRules:sheet.rules;if(null==rules)return"null";for(var i=0;i<rules.length;i++)if(rules[i].selectorText===ruleClass)return void 0!==newValue?rules[i].style[property]=newValue:rules[i].style[property]}return null},game.utils.getAverageRGB=function(img){"use strict";var imageData,data,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),width=canvas.width=img.naturalWidth,height=canvas.height=img.naturalHeight,defaultRGB={r:200,g:200,b:200};ctx.drawImage(img,0,0);try{imageData=ctx.getImageData(0,0,width,height)}catch(e){return console.log("Problem parsing this image",e),defaultRGB}data=imageData.data;for(var r=0,g=0,b=0,i=0,l=data.length;i<l;i+=4)r+=data[i],g+=data[i+1],b+=data[i+2];return r=Math.floor(r/(data.length/4)),g=Math.floor(g/(data.length/4)),b=Math.floor(b/(data.length/4)),{r:r,g:g,b:b}},game.utils.getBrowserPrefix=function(){"use strict";var styles=window.getComputedStyle(document.documentElement,""),pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1];return{dom:["WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1]],lowercase:[pre],css:["-"+pre+"-"],js:[pre[0].toUpperCase()+pre.substr(1)]}},game.utils.hasClass=function(element,cls){"use strict";return(" "+element.className+" ").indexOf(" "+cls+" ")>-1},game.utils.listenTo=function(element,eventType,fn,listenersList,context){"use strict";if(listenersList=listenersList||{},!element)return console.log("can't find this element: "+element),!1;var id=element.id;if(void 0===id||""===id)if(element===document.body)id="body";else if(element===document.documentElement)id="html";else{if(element!==window)return console.log("better not add a listener to elements witout id: ",element),!1;id="window"}if(void 0===listenersList[id]&&(listenersList[id]={}),void 0!==listenersList[id][eventType])return console.log("cannot add another listener for "+eventType+" to ",element),!1;listenersList[id][eventType]=fn,element.addEventListener?element.addEventListener&&(0===eventType.indexOf("touch")?element.addEventListener(eventType,function(event){if(event.preventDefault(),0===event.touches.length)fn(event,context);else for(var i=0;i<event.touches.length;i++)event.touches[i].timeStamp=event.timeStamp,event.touches[i].type=event.type,event.touches[i].multiTouchEvent=event,fn(event.touches[i],context)},!0):element.addEventListener(eventType,function(event){fn(event,context)},!1)):element.attachEvent("on"+eventType,fn)},game.utils.removeClass=function(element,cls){"use strict";var regexp=new RegExp("\\b"+cls+"\\b","g");return element.className=" "+element.className+" ",element.className=element.className.replace(regexp,""),element.className.replace(/  +/g," ")},game.utils.roundTo=function(input,num){"use strict";var resto=input%num;return resto<=num/2?input-resto:input+num-resto},game.utils.stopListeningTo=function(element,eventType,listenersList){"use strict";if(void 0===listenersList)return console.log("no registered listeners in ",listenersList),!1;var id=element.id;if(void 0===element.id||""===element.id)if(element===document.body)id="body";else if(element===document.documentElement)id="html";else{if(element!==window)return console.log("better not add a listener to elements witout id: ",element),!1;id="window"}return void 0!==listenersList[id][eventType]&&(element.removeEventListener(eventType,listenersList[id][eventType]),listenersList[id][eventType]=void 0,!0)},game.utils.trim=function(str){"use strict";str=str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");for(var ws=/\s/,i=str.length;ws.test(str.charAt(--i)););return str.slice(0,i+1)},game.config={size:{h:4,v:4},margin:{h:4,v:4},borderSize:4,pushMultiple:!0,minDistanceToMoveTile:.25,clickToMove:!0,maxTimeForClickMove:200,touchTolerance:.2,transitionDuration:{generic:60,byKeyboard:100},useKeyboard:!0},game.config.easings={EASING_TILES_MOVEMENT:"cubic-bezier(0.403, 0.543, 0.754, 1)"},game.config.keycodes={KEY_ARROW_LEFT:37,KEY_ARROW_UP:38,KEY_ARROW_RIGHT:39,KEY_ARROW_DOWN:40,KEY_ESCAPE:2,KEY_RETURN:13},game.config.labels={WRAPPER_ID:"game-wrapper",GAME_ID:"game",BOARD_ID:"board",TOOLBAR_ID:"toolbar",BACKGROUND_CONTAINER_ID:"bg",BACKGROUND_IMAGE_ID:"bg-img",TILE_PREFIX:"tile-",TILE_CLASS:"tile",TILE_INNER_CLASS:"inner",TILE_NUMBER_CLASS:"number",TBUTTON_PREFIX:"btn-",SELECTED_LABEL:"selected",PRESSED_LABEL:"pressed",ANIMATED_LABEL:"animationInProgress",USETOUCH_LABEL:"touch",NO_TOUCH_LABEL:"no-touch",UP:"up",RIGHT:"right",DOWN:"down",LEFT:"left",LANDSCAPE:"landscape",PORTRAIT:"portrait",SAVEDGAMES_LABEL:"savedGames",AUTOSAVE_LABEL:"automatic",USERSAVE_LABEL:"user",SORTEDSAVE_LABEL:"sorted",SHUFFLEDSAVE_LABEL:"shuffled"},game.config.toolbarButtons=[{id:"new",description:"New game",handler:function(){window.confirm("Start a new game?")&&this.newGame()}},{id:"save",description:"Save the board",handler:function(){this.saveGame(this.config.labels.USERSAVE_LABEL),this.utils.addClass(document.getElementById("btn-save"),"on")}},{id:"load",description:"Load the saved board",handler:function(){window.confirm("Load the saved game?")&&this.loadGame(this.config.labels.USERSAVE_LABEL),this.animate({element:document.getElementById(this.config.labels.GAME_ID),animation:"load",duration:1e3})}},{id:"settings",description:"change your preferences",handler:function(){}},{id:"info",description:"About this game",handler:function(){}}],game.ajaxCall=function(url){"use strict";var xmlhttp;if(!window.XMLHttpRequest)return!1;xmlhttp=new XMLHttpRequest,xmlhttp.onreadystatechange=function(){console.log(xmlhttp.status),4===xmlhttp.readyState&&200===xmlhttp.status&&console.log(xmlhttp.responseText)},xmlhttp.open("GET",url,!0),xmlhttp.send()},game.animate=function(params){"use strict";if(void 0===params||!params.element||"string"!=typeof params.animation)return console.log("wrong parameters in animate call",params),!1;"number"!=typeof params.duration&&(params.duration=this.config.transitionDuration.generic);for(var CSSstyleDeclaration,prefix="",p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"animation-fill-mode:both;",CSSstyleDeclaration+=prefix+"animation-duration:"+params.duration+"ms;",CSSstyleDeclaration+=prefix+"animation-name:"+params.animation+";",void 0!==params.iterations&&(CSSstyleDeclaration+=prefix+"animation-iteration-count:"+params.iteration+";"),"number"==typeof params.delay&&(CSSstyleDeclaration+=prefix+"animation-delay:"+params.delay+"ms;"),"string"==typeof params.easing&&(CSSstyleDeclaration+=prefix+"animation-timing-function:"+params.easing+";"),p<0?this.utils.listenTo(params.element,"animationend",function(event,context){context.utils.stopListeningTo(params.element,"animationend",context.runtime.eventListeners),event.target.style["animation-name"]=""},this.runtime.eventListeners,this):this.utils.listenTo(params.element,this.config.browserPrefixes.lowercase[p]+"AnimationEnd",function(event,context){context.utils.stopListeningTo(params.element,event.type,context.runtime.eventListeners),event.target.style[event.type.replace("End","Name")]="",context.utils.removeClass(params.element,context.config.labels.ANIMATED_LABEL)},this.runtime.eventListeners,this);game.utils.addClass(params.element,game.config.labels.ANIMATED_LABEL),params.element.style.cssText+=CSSstyleDeclaration},game.canMove=function(tile){"use strict";tile=this.isTile(tile)||null;var hole=this.runtime.tiles[this.config.labels.TILE_PREFIX+this.config.labels.HOLE_INDEX],holePosition=hole.col+"-"+hole.row;return!!tile&&(holePosition===tile.col+"-"+(tile.row-1)?this.config.labels.UP:holePosition===tile.col+1+"-"+tile.row?this.config.labels.RIGHT:holePosition===tile.col+"-"+(tile.row+1)?this.config.labels.DOWN:holePosition===tile.col-1+"-"+tile.row&&this.config.labels.LEFT)},game.canPush=function(tile){"use strict";tile=this.isTile(tile)||!1;var hole=this.runtime.tiles[this.config.labels.TILE_PREFIX+this.config.labels.HOLE_INDEX],tilesToPush=0,pushableTiles=0;return!!tile&&(!(!this.config.pushMultiple||tile.col!==hole.col&&tile.row!==hole.row)&&(tilesToPush=tile.col-hole.col==0?hole.row-tile.row:hole.col-tile.col,pushableTiles=Math.abs(tilesToPush)-1,0!==tilesToPush&&0!==pushableTiles&&(tile.col===hole.col?tilesToPush>0?{n:pushableTiles,direction:this.config.labels.DOWN}:{n:pushableTiles,direction:this.config.labels.UP}:tilesToPush>0?{n:pushableTiles,direction:this.config.labels.RIGHT}:{n:pushableTiles,direction:this.config.labels.LEFT})))},game.changeBg=function(params){"use strict";try{this.setBgImage({imgUrl:"https://source.unsplash.com/random/"+this.metrics.width+"x"+this.metrics.height})}catch(e){console.log("error loading a bg image",e)}},game.checkFeatures=function(){"use strict";if(this.config.browserOK=game.utils.checkBrowser(),!this.config.browserOK)return console.log("Browser not supported"),alert("this browser version isn't supported"),!1;this.config.useTouch=Modernizr.touch,this.utils.addClass(document.getElementById(this.config.labels.GAME_ID),this.config.useTouch?this.config.labels.USETOUCH_LABEL:this.config.labels.NO_TOUCH_LABEL),this.config.useCSStransitions=Modernizr.csstransitions,this.config.useCSStransitions||(console.log("css transitions are disabled"),this.utils.createCSSClass("#"+this.config.labels.GAME_ID+" * ","transition: none !important;")),this.config.use3Dtransforms=Modernizr.csstransforms3d,this.config.useLstorage=Modernizr.localstorage,this.config.useVibration=!0,this.config.useCssAnimations=Modernizr.cssanimations,this.config.launchedAsApp=this.utils.detectFullscreen(),this.config.browserPrefixes=this.utils.getBrowserPrefix(),this.config.useReqAnimFrame=!!window.requestAnimationFrame},game.countMove=function(){"use strict";this.runtime.movesCount++},game.createBoard=function(){"use strict";var boardHTML,tile,row=0,col=0;null===document.getElementById(this.config.labels.BOARD_ID)?(boardHTML=document.createElement("div"),boardHTML.setAttribute("id",this.config.labels.BOARD_ID),document.getElementById(this.config.labels.GAME_ID).appendChild(boardHTML)):document.getElementById(this.config.labels.BOARD_ID).innerHTML="",this.config.size.n=this.config.size.h*this.config.size.v,this.config.labels.HOLE_INDEX=this.config.size.n-1;for(var i=0;i<this.config.size.n;i++)tile={i:i,id:this.config.labels.TILE_PREFIX+i,col:col,row:row,correctCol:col,correctRow:row,even:i%2==0,evenCol:col%2==0,evenRow:row%2==0},tile.htmlElement=document.createElement("div"),tile.htmlElement.setAttribute("id",this.config.labels.TILE_PREFIX+i),tile.htmlElement.setAttribute("tabindex",i),tile.htmlElement.setAttribute("class"," tile"+(tile.evenRow?" even-row":" odd-row")+(tile.evenCol?" even-col":" odd-col")+(tile.even?" even":" odd")+(i===this.config.labels.HOLE_INDEX?" hole":"")+" col-"+col+" row-"+row),tile.htmlElement.innerHTML='<div class="'+this.config.labels.TILE_INNER_CLASS+'"><div class="'+this.config.labels.TILE_NUMBER_CLASS+'">'+(i+1)+"</div></div>",this.runtime.tiles[this.config.labels.TILE_PREFIX+i]=tile,document.getElementById(this.config.labels.BOARD_ID).appendChild(tile.htmlElement),++col>=this.config.size.h&&(row++,col=0);this.saveGame(this.config.labels.SORTEDSAVE_LABEL)},game.deselectTile=function(){"use strict";var tile=this.isTile(this.runtime.selectedTile),tilesMoved=0;if(!tile)return!1;if(console.log("de-selecting"),this.runtime.selectedTile=null,this.utils.removeClass(tile.htmlElement,this.config.labels.SELECTED_LABEL),this.utils.removeClass(tile.htmlElement,this.config.labels.PRESSED_LABEL),this.runtime.dragging=!1,this.vibrate("deselect"),void 0===tile.newPosition)return!1;if(null!==tile.newPosition.left.newValue.pixels){if(console.log("the tile has been moved."),this.config.pushMultiple&&tile.canPush){console.log("the tile could push other tiles, so it must have pushed them.");for(var i=tile.canPush.tiles.length;i>0;i--)tile.canPush.tiles[0].revert||(tilesMoved++,this.moveTile(tile.canPush.tiles[i-1],{transitions:!0,force:!1,refresh:!1}))}console.log("now, the tile has been released far enough to its original position in order to move it?"),Math.abs(tile.newPosition.left.newValue.pixels-tile.oldPosition.left.pixels)>=this.metrics.tileWidth*this.config.minDistanceToMoveTile||Math.abs(tile.newPosition.top.newValue.pixels-tile.oldPosition.top.pixels)>=this.metrics.tileHeight*this.config.minDistanceToMoveTile?(console.log("yes, it's far enough. "),tilesMoved++,this.moveTile(tile,{transitions:!0,force:!1,refresh:!1})):console.log("nope, snapping back ")}else if(console.log("tile has not been moved at all."),this.config.clickToMove&&(tile.canMove||this.config.pushMultiple&&tile.canPush)){for(var i=tile.canPush.tiles.length;i>0;i--)tilesMoved++,this.moveTile(tile.canPush.tiles[i-1],{transitions:!0,force:!1,refresh:!1});tilesMoved++,this.moveTile(tile,{transitions:!0,force:!1,refresh:!1})}console.log("tiles moved: "+tilesMoved),this.refresh({saveGame:!!tilesMoved})},game.dragTile=function(event){"use strict";if(!this.runtime.running)return this.deselectTile(),!1;var direction,newPosX,newPosY,otherTile,otherTileNewPos,p,tile=this.isTile(this.runtime.selectedTile),CSSstyleDeclaration="";if(!tile||!tile.canMove&&!tile.canPush.n||void 0===tile.offset||void 0===tile.newPosition)return this.deselectTile(),!1;if(newPosX=event.pageX-this.metrics.borderSize.pixels-this.metrics.left-tile.offset.left,newPosY=event.pageY-this.metrics.borderSize.pixels-this.metrics.top-tile.offset.top,direction=this.config.pushMultiple&&tile.canPush?tile.canPush.direction:tile.canMove,newPosY<tile.newPosition.top.min.pixels&&(newPosY=tile.newPosition.top.min.pixels),newPosY>tile.newPosition.top.max.pixels&&(newPosY=tile.newPosition.top.max.pixels),newPosX<tile.newPosition.left.min.pixels&&(newPosX=tile.newPosition.left.min.pixels),newPosX>tile.newPosition.left.max.pixels&&(newPosX=tile.newPosition.left.max.pixels),event.pageX-this.metrics.left-this.metrics.borderSize.pixels+this.metrics.tileWidth*this.config.touchTolerance<newPosX||event.pageX-this.metrics.left-this.metrics.borderSize.pixels-this.metrics.tileWidth*(1+this.config.touchTolerance)>newPosX||event.pageY-this.metrics.top-this.metrics.borderSize.pixels+this.metrics.tileHeight*this.config.touchTolerance<newPosY||event.pageY-this.metrics.top-this.metrics.borderSize.pixels-this.metrics.tileHeight*(1+this.config.touchTolerance)>newPosY)return this.deselectTile(),!1;var prefix="";switch(direction){case this.config.labels.LEFT:case this.config.labels.RIGHT:for(tile.newPosition.top.newValue.pixels=tile.oldPosition.top.pixels,tile.newPosition.left.newValue.pixels=newPosX,tile.newPosition.left.newValue.percent=100*newPosX/game.metrics.tileWidth,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+tile.newPosition.left.newValue.percent+"%,"+tile.oldPosition.top.percent+"%"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case this.config.labels.UP:case this.config.labels.DOWN:for(tile.newPosition.top.newValue.pixels=newPosY,tile.newPosition.left.newValue.pixels=tile.oldPosition.left.pixels,tile.newPosition.top.newValue.percent=100*newPosY/this.metrics.tileHeight,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+tile.newPosition.top.newValue.percent+"%"+game.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; "}if(this.config.useReqAnimFrame?(this.addMovingTile(tile,CSSstyleDeclaration),window.requestAnimationFrame(game.renderMovingTiles)):tile.htmlElement.style.cssText=CSSstyleDeclaration,this.config.pushMultiple&&void 0!==tile.canPush.tiles)for(var i=0;i<tile.canPush.tiles.length;i++){switch(otherTile=tile.canPush.tiles[i],prefix="",direction){case this.config.labels.UP:if(!((otherTileNewPos=tile.newPosition.top.newValue.pixels-this.metrics.tileHeight*(i+1))<tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;for(tile.canPush.tiles[i].max=otherTileNewPos,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+otherTileNewPos+"px"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case this.config.labels.RIGHT:if(!((otherTileNewPos=tile.newPosition.left.newValue.pixels+this.metrics.tileWidth*(i+1))>tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;for(tile.canPush.tiles[i].max=otherTileNewPos,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+otherTileNewPos+"px,"+tile.oldPosition.top.percent+"%"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case this.config.labels.DOWN:if(!((otherTileNewPos=tile.newPosition.top.newValue.pixels+game.metrics.tileHeight*(i+1))>tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;for(tile.canPush.tiles[i].max=otherTileNewPos,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+otherTileNewPos+"px"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case this.config.labels.LEFT:if(!((otherTileNewPos=tile.newPosition.left.newValue.pixels-this.metrics.tileWidth*(i+1))<tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;for(tile.canPush.tiles[i].max=otherTileNewPos,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+otherTileNewPos+"px,"+tile.oldPosition.top.percent+"%"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; "}this.config.useReqAnimFrame?(this.addMovingTile(otherTile,CSSstyleDeclaration),window.requestAnimationFrame(game.renderMovingTiles)):otherTile.htmlElement.style.cssText=CSSstyleDeclaration,Math.abs(tile.newPosition.left.newValue.pixels-tile.oldPosition.left.pixels)>=this.metrics.tileWidth*this.config.minDistanceToMoveTile||Math.abs(tile.newPosition.top.newValue.pixels-tile.oldPosition.top.pixels)>=this.metrics.tileHeight*this.config.minDistanceToMoveTile?otherTile.revert=!1:otherTile.revert=!0}},game.getMovableTiles=function(params){"use strict";var t,direction=params.direction,pushing=params.pushing,moving=params.moving;if(this.runtime.movableTiles=[],this.runtime.running||!0===params.force)for(var i=0;i<this.config.size.n;i++)t=this.runtime.tiles["tile-"+i],t.canMove&&moving&&(void 0===direction||direction===t.canMove)&&this.runtime.movableTiles.push(this.getTile(this.config.labels.TILE_PREFIX+t.i)),this.config.pushMultiple&&pushing&&t.canPush&&!t.canMove&&(void 0===direction||direction===t.canPush.direction)&&this.runtime.movableTiles.push(this.getTile(this.config.labels.TILE_PREFIX+t.i));return this.runtime.movableTiles},game.getTile=function(param){"use strict";var i,target=null,maxLevels=5,tiles=this.runtime.tiles,col=parseInt(param.col),row=parseInt(param.row),prefix=this.config.labels.TILE_PREFIX;switch(typeof param){case"object":if(param.srcElement)target=param.srcElement;else{if(!param.pageX||!param.pageY){if(isNaN(parseInt(param.col))||isNaN(parseInt(param.row)))return!1;for(i=0;i<this.config.size.n;i++)if(tiles[prefix+i].col===col&&tiles[prefix+i].row===row)return tiles[prefix+i];return!1}target=document.elementFromPoint(param.pageX,param.pageY)}if(null===target)return!1;for(i=0;i<maxLevels;i++){if(void 0===target||void 0===target.parentNode||null===target||null===target.parentNode)return!1;if(target.parentNode.id===this.config.labels.BOARD_ID)return this.runtime.tiles[target.id];target=target.parentNode}return!1;case"string":return 0===param.indexOf(prefix)&&tiles[param];case"number":return param<this.config.size.n&&tiles[prefix+param]}},game.init=function(){"use strict";this.runtime={started:!1,running:!1,ended:!1,timePlaying:0,movesCount:!1,dragging:!1,resizeTimer:-1,selectedTile:null,tiles:{},latestSelection:0,eventListeners:{}},this.checkFeatures(),this.createBoard(),this.changeBg(),this.metricsUpdate(),this.initListeners(),this.refresh({transitions:!1}),this.loadGame()?(this.animate({element:document.getElementById(this.config.labels.GAME_ID),animation:"load",duration:1e3}),this.start()):this.newGame()},game.initListeners=function(){"use strict";this.utils.listenTo(document.getElementById(this.config.labels.BOARD_ID),this.config.useTouch?"touchstart":"mousedown",function(event,context){if(event.timeStamp-context.runtime.latestSelection<300)return!1;context.runtime.latestSelection=event.timeStamp,context.selectTile(context.getTile(event),event)},this.runtime.eventListeners,this),this.utils.listenTo(document.getElementById(this.config.labels.WRAPPER_ID),this.config.useTouch?"touchmove":"mousemove",function(event,context){return!1},this.runtime.eventListeners,this),this.utils.listenTo(document.getElementById(this.config.labels.BOARD_ID),this.config.useTouch?"touchmove":"mousemove",function(event,context){if(context.runtime.selectedTile)context.dragTile(event);else if("mousemove"!==event.type){if(event.timeStamp-context.runtime.latestSelection<300)return!1;context.runtime.latestSelection=event.timeStamp,context.selectTile(context.getTile(event),event)}},this.runtime.eventListeners,this),this.utils.listenTo(document.getElementById(this.config.labels.WRAPPER_ID),this.config.useTouch?"touchend":"mouseup",function(event,context){if(void 0===context.runtime.selectedTile||null===context.runtime.selectedTile)return!1;context.config.useTouch&&event.timeStamp-context.runtime.selectedTile.timeStamp>context.config.maxTimeForClickMove&&null===context.runtime.selectedTile.newPosition.top.newValue.pixels&&null===context.runtime.selectedTile.newPosition.left.newValue.pixels&&(context.runtime.selectedTile.newPosition=void 0),context.deselectTile()},this.runtime.eventListeners,this),this.utils.listenTo(document.getElementById(this.config.labels.GAME_ID),"mouseout",function(event,context){event=event||window.event;var from=event.relatedTarget||event.toElement;from&&"HTML"!==from.nodeName||context.deselectTile()},this.runtime.eventListeners,this),this.config.useKeyboard&&this.utils.listenTo(document.body,"keyup",function(event,context){switch(event.which){case context.config.keycodes.KEY_ARROW_LEFT:context.moveAnyTile({direction:context.config.labels.LEFT,pushing:event.ctrlKey});break;case context.config.keycodes.KEY_ARROW_UP:context.moveAnyTile({direction:context.config.labels.UP,pushing:event.ctrlKey});break;case context.config.keycodes.KEY_ARROW_RIGHT:context.moveAnyTile({direction:context.config.labels.RIGHT,pushing:event.ctrlKey});break;case context.config.keycodes.KEY_ARROW_DOWN:context.moveAnyTile({direction:context.config.labels.DOWN,pushing:event.ctrlKey})}},this.runtime.eventListeners,this),this.utils.listenTo(window,"resize",function(event,context){var event=new Event("layoutChange");window.dispatchEvent(event)},this.runtime.eventListeners,this),
this.utils.listenTo(window,"orientationchange",function(event,context){var event=new Event("layoutChange");window.dispatchEvent(event)},this.runtime.eventListeners,this),this.utils.listenTo(window,"layoutChange",function(event,context){context.optimizeRedraws("on"),-1!==context.runtime.resizeTimer&&clearTimeout(context.runtime.resizeTimer),context.runtime.resizeTimer=window.setTimeout(function(context){void 0!==context&&(context.deselectTile(),context.metricsUpdate(),context.refresh(),context.optimizeRedraws("off"))},500,context)},this.runtime.eventListeners,this)},game.isTile=function(tile){"use strict";if(null===tile||void 0===tile)return!1;switch(typeof tile){case"object":if(tile.id.indexOf(this.config.labels.TILE_PREFIX)<0)return!1;break;case"string":if(void 0===(tile=this.runtime.tiles[tile]))return!1;if(tile.id.indexOf(this.config.labels.TILE_PREFIX)<0)return!1;break;default:return!1}return tile},game.loadGame=function(type){"use strict";if(!this.config.useLstorage)return!1;void 0===type&&(type=this.config.labels.AUTOSAVE_LABEL);var tileID,loadedGames=JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL)),loadedGame=null;if(null!==loadedGames){if(void 0!==loadedGames[type]&&null!==loadedGames[type]){if(loadedGame=loadedGames[type],loadedGame.saveDate=new Date(Date.UTC.apply(this,loadedGame.saveDate.match(/\d+\.{0,1}\d+/g))),loadedGame.startedDate&&(loadedGame.startedDate=new Date(Date.UTC.apply(this,loadedGame.startedDate.match(/\d+\.{0,1}\d+/g)))),loadedGame.size!==this.config.size.n)return console.log("cannot load game: different sizes:",loadedGame.size,this.config.size.n),!1;this.runtime.tiles=loadedGame.tiles;for(var i=0;i<this.config.size.n;i++)tileID=this.config.labels.TILE_PREFIX+i,loadedGame.tiles[tileID].htmlElement=document.getElementById(tileID);return this.runtime.started=loadedGame.startedDate,this.runtime.movesCount=parseInt(loadedGame.movesCount),this.refresh({transitions:"user"===type}),console.log("game loaded"),!0}return console.log("cannot find saved game '"+type+"'"),!1}return console.log("cannot find any saved game"),!1},game.metricsUpdate=function(){"use strict";this.metrics=this.metrics||{};var wrapperHTML=document.getElementById(this.config.labels.WRAPPER_ID),gameHTML=document.getElementById(this.config.labels.GAME_ID),wrapperWidth=wrapperHTML.offsetWidth,wrapperHeight=wrapperHTML.offsetHeight,cssPrefix="#"+this.config.labels.BOARD_ID;this.metrics.transforms3Dsupport=this.config.use3Dtransforms?["3d",",0"]:["",""],this.metrics.wrapperOrientation=wrapperWidth>=wrapperHeight?this.config.labels.LANDSCAPE:this.config.labels.PORTRAIT,this.metrics.wrapperRatio=wrapperWidth/wrapperHeight,this.metrics.pixelRatio=window.devicePixelRatio>1?window.devicePixelRatio:1,void 0===this.metrics.wrapperSize&&(this.metrics.wrapperSize={}),this.metrics.wrapperSize[this.metrics.wrapperOrientation]={width:wrapperWidth,height:wrapperHeight},this.metrics.boardLayout=this.config.size.h>=this.config.size.v?this.config.labels.LANDSCAPE:this.config.labels.PORTRAIT,this.metrics.boardRatio=this.config.size.h/this.config.size.v,this.metrics.fontSize=parseInt((document.body.currentStyle||window.getComputedStyle&&getComputedStyle(document.body,null)||document.body.style).fontSize),this.metrics.marginH={percent:this.config.margin.h,pixels:0},this.metrics.marginV={percent:this.config.margin.v,pixels:0},this.metrics.borderSize={percent:this.config.borderSize,pixels:0},this.metrics.wrapperOrientation===this.config.labels.LANDSCAPE?(this.metrics.height=this.utils.roundTo(wrapperHeight/100*(100-2*this.config.borderSize-2*this.metrics.marginV.percent),this.config.size.h),this.metrics.width=this.metrics.height,this.metrics.borderSize.pixels=Math.round(wrapperHeight/100*this.config.borderSize),this.metrics.marginH.pixels=Math.round(wrapperHeight/100*this.metrics.marginH.percent),this.metrics.marginV.pixels=Math.round(wrapperHeight/100*this.metrics.marginV.percent),this.metrics.left=Math.round((wrapperWidth-this.metrics.width-this.metrics.borderSize.pixels-this.metrics.marginH.pixels)/2),this.metrics.top=Math.round((this.metrics.wrapperSize[this.metrics.wrapperOrientation].height-this.metrics.height-this.metrics.borderSize.pixels-this.metrics.marginV.pixels)/2)):(this.metrics.width=this.utils.roundTo(wrapperWidth/100*(100-2*this.config.borderSize-2*this.metrics.marginH.percent),this.config.size.v),this.metrics.height=this.metrics.width,this.metrics.borderSize.pixels=Math.round(wrapperWidth/100*this.config.borderSize),this.metrics.marginH.pixels=Math.round(wrapperWidth/100*this.metrics.marginH.percent),this.metrics.marginV.pixels=Math.round(wrapperWidth/100*this.metrics.marginV.percent),this.metrics.left=Math.round((wrapperWidth-this.metrics.width-this.metrics.borderSize.pixels-this.metrics.marginH.pixels)/2),this.metrics.top=Math.round((this.metrics.wrapperSize[this.metrics.wrapperOrientation].height-this.metrics.height-this.metrics.borderSize.pixels-this.metrics.marginV.pixels)/2)),this.metrics.tileWidth=Math.round(this.metrics.width/this.config.size.h),this.metrics.tileHeight=Math.round(this.metrics.height/this.config.size.v);var CSSstyleDeclaration="padding:"+Math.round(this.metrics.borderSize.pixels)+"px;width:"+this.metrics.width+"px; height:"+this.metrics.height+"px; left:"+this.metrics.left+"px; top:"+this.metrics.top+"px; ";if(void 0!==game.runtime.backgroundImage){var rgb=game.runtime.backgroundImage.averageRGB_brighter;"object"==typeof rgb&&(CSSstyleDeclaration+="background-color: rgb("+rgb.r+","+rgb.g+","+rgb.b+");")}gameHTML.style.cssText=CSSstyleDeclaration,document.getElementById(this.config.labels.GAME_ID).style.fontSize=document.getElementById(this.config.labels.BOARD_ID).offsetHeight/this.config.size.v/2+"px";var tileWpc=100/this.config.size.h+"%",tileHpc=100/this.config.size.v+"%";null===this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_CLASS)?this.utils.createCSSClass(cssPrefix+" ."+this.config.labels.TILE_CLASS,"width: "+tileWpc+"; height: "+tileHpc+";"):(this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_CLASS,"width",tileWpc),this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_CLASS,"height",tileHpc));var bgSize="auto "+this.metrics.height+"px";null===this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_INNER_CLASS)?this.utils.createCSSClass(cssPrefix+"."+this.config.labels.TILE_INNER_CLASS,"background-size: "+bgSize+";"):this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_INNER_CLASS,"backgroundSize",bgSize)},game.moveAnyTile=function(params){"use strict";for(var tiles=!0===params.pushing?this.getMovableTiles({pushing:!1,moving:!0,direction:params.direction}).concat(this.getMovableTiles({pushing:!0,moving:!1,direction:params.direction}).sort(function(t1,t2){return t1.canPush.n-t2.canPush.n})):this.getMovableTiles({pushing:!1,moving:!0,direction:params.direction}),i=0;i<tiles.length;i++)this.moveTile(tiles[i],{transitions:!1,force:!1,refresh:!1});return this.refresh({transitionDuration:this.config.transitionDuration.byKeyboard}),tiles},game.moveTile=function(tile,params){"use strict";if(!(tile=this.isTile(tile)))return!1;var hole=this.runtime.tiles[this.config.labels.TILE_PREFIX+this.config.labels.HOLE_INDEX],temp={};if(!this.canMove(tile))return!1;if(!0!==params.force){if(!this.runtime.running)return!1;this.countMove()}return temp.col=tile.col,temp.row=tile.row,tile.col=hole.col,tile.row=hole.row,hole.col=temp.col,hole.row=temp.row,!0===params.refresh&&this.refresh({transitions:params.transitions,saveGame:!params.force,redraw:!params.force}),!0},game.newGame=function(){"use strict";var animationDuration=2e3;this.runtime.running?(console.log("user reset"),this.stop(),setTimeout(function(context){context.loadGame(context.config.labels.SORTEDSAVE_LABEL),context.refresh({transitions:!1}),context.saveGame(context.config.labels.SORTEDSAVE_LABEL)},.34*animationDuration,this),this.animate({element:document.getElementById(this.config.labels.GAME_ID),animation:"resetboard",duration:animationDuration,easing:"ease-in-out"})):(console.log("first launch"),this.refresh({transitions:!1}),this.saveGame(this.config.labels.SORTEDSAVE_LABEL),this.animate({element:document.getElementById(this.config.labels.GAME_ID),animation:"intro",duration:animationDuration})),setTimeout(function(context){context.shuffle(context.config.size.n*context.config.size.n),context.saveGame(context.config.labels.SHUFFLEDSAVE_LABEL),context.start()},.85*animationDuration,this)},game.optimizeRedraws=function(state){"use strict";var elements=[this.config.labels.WRAPPER_ID,this.config.labels.BACKGROUND_CONTAINER_ID,this.config.labels.GAME_ID],i=0;if("on"==state)for(console.log("hiding elements during layout change..."),i=0;i<elements.length;i++)document.getElementById(elements[i]).style.visibility="hidden";else for(console.log("...showing back again elements after layout change"),i=0;i<elements.length;i++)document.getElementById(elements[i]).style.visibility="visible"},game.refresh=function(params){"use strict";var tileID,tile,CSSstyleDeclaration="",win=!0;void 0===params&&(params={transitions:!0,saveGame:!1}),!1===params.transitions?params.transitionDuration=0:"number"!=typeof params.transitionDuration&&(params.transitionDuration=this.config.transitionDuration.generic),console.log("refresh",params),game.runtime.movingTiles={};for(var i=0;i<this.config.size.n;i++){tileID=this.config.labels.TILE_PREFIX+i,tile=this.runtime.tiles[tileID];for(var prefix="",p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+100*tile.col+"%,"+100*tile.row+"%"+this.metrics.transforms3Dsupport[1]+"); ",CSSstyleDeclaration+=prefix+"transition-property:"+prefix+"transform;",CSSstyleDeclaration+=prefix+"transition-duration:"+parseInt(Math.abs(params.transitionDuration))+"ms !important;",CSSstyleDeclaration+=prefix+"transition-timing-function:"+this.config.easings.EASING_TILES_MOVEMENT+";";!1!==params.redraw&&(tile.htmlElement.style.cssText=CSSstyleDeclaration),tile.htmlElement.childNodes[0].style.backgroundPosition="-"+tile.correctCol*this.metrics.tileWidth+"px -"+tile.correctRow*this.metrics.tileHeight+"px",tile.canMove=this.canMove(tileID),tile.canPush=this.canPush(tileID),tile.offse=void 0,tile.newPosition=void 0,tile.oldPosition=void 0,tile.timeStamp=void 0,tile.revert=void 0,tile.max=void 0,tile.correctCol===tile.col&&tile.correctRow===tile.row||(win=!1)}this.runtime.running&&win&&(setTimeout(function(){window.alert("Hai vinto!")},500),this.stop(),this.newGame()),!0===params.saveGame&&this.saveGame()},game.addMovingTile=function(tileObj,cssString){"use strict";return"object"!=typeof this.runtime.movingTiles&&(this.runtime.movingTiles={}),this.runtime.movingTiles[tileObj.id]=cssString,this.runtime.movingTiles},game.renderMovingTiles=function(){var movingTiles=game.runtime.movingTiles;for(tileId in movingTiles)movingTiles[tileId]&&(console.log("--- moving "+tileId),game.runtime.tiles[tileId].htmlElement.style.cssText=movingTiles[tileId]);return game.runtime.movingTiles={},game.runtime.movingTiles},game.saveGame=function(type){"use strict";if(!this.config.useLstorage)return!1;if(!1!==this.runtime.ended)return!1;void 0===type&&(type=this.config.labels.AUTOSAVE_LABEL);var tileID,savedGames={},savedGame={saveDate:(new Date).toUTCString(),type:type,size:this.config.size.n,tiles:{},movesCount:this.runtime.movesCount};null!=JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL))&&(savedGames=JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL))),this.runtime.started&&(savedGame.startedDate=this.runtime.started.toUTCString());for(var i=0;i<this.config.size.n;i++)tileID=this.config.labels.TILE_PREFIX+i,savedGame.tiles[tileID]=this.utils.cloneObj(this.runtime.tiles[tileID]);savedGames[type]=savedGame,localStorage.setItem(this.config.labels.SAVEDGAMES_LABEL,JSON.stringify(savedGames)),console.log("game saved ("+type+")")},game.selectTile=function(tile,event){"use strict";if(!this.runtime.running)return!1;if(!(tile=this.isTile(tile)))return!1;var direction=this.config.pushMultiple&&tile.canPush?tile.canPush.direction:tile.canMove;if(this.runtime.selectedTile=tile,this.canMove(tile)||this.config.pushMultiple){switch(this.runtime.selectedTile.timeStamp=void 0!==event?event.timeStamp:new Date,this.runtime.selectedTile.oldPosition={left:{percent:100*tile.col,pixels:this.metrics.tileWidth*tile.col},top:{percent:100*tile.row,pixels:this.metrics.tileHeight*tile.row}},this.runtime.selectedTile.offset=void 0!==event?{top:(event.pageY-this.metrics.top-this.metrics.borderSize.pixels)%this.metrics.tileHeight,left:(event.pageX-this.metrics.left-this.metrics.borderSize.pixels)%this.metrics.tileWidth}:{top:this.metrics.tileHeight/2,left:this.metrics.tileWidth/2},this.runtime.selectedTile.newPosition={top:{min:{pixels:null,percent:null},newValue:{pixels:null,percent:null},max:{pixels:null,percent:null}},left:{min:{pixels:null,percent:null},newValue:{pixels:null,percent:null},max:{pixels:null,percent:null}}},direction){case this.config.labels.UP:this.runtime.selectedTile.newPosition.top.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels-this.metrics.tileHeight),this.runtime.selectedTile.newPosition.top.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels),this.runtime.selectedTile.newPosition.left.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels),this.runtime.selectedTile.newPosition.left.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels);break;case this.config.labels.DOWN:this.runtime.selectedTile.newPosition.top.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels),this.runtime.selectedTile.newPosition.top.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels+this.metrics.tileHeight),this.runtime.selectedTile.newPosition.left.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels),this.runtime.selectedTile.newPosition.left.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels);break;case this.config.labels.LEFT:this.runtime.selectedTile.newPosition.left.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels-this.metrics.tileWidth),this.runtime.selectedTile.newPosition.left.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels),this.runtime.selectedTile.newPosition.top.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels),this.runtime.selectedTile.newPosition.top.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels);break;case this.config.labels.RIGHT:this.runtime.selectedTile.newPosition.left.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels),this.runtime.selectedTile.newPosition.left.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels+this.metrics.tileWidth),this.runtime.selectedTile.newPosition.top.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels),this.runtime.selectedTile.newPosition.top.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels)}if(this.runtime.dragging||this.utils.addClass(tile.htmlElement,this.config.labels.PRESSED_LABEL+" "+this.config.labels.SELECTED_LABEL),!1!==tile.canPush&&this.config.pushMultiple){tile.canPush.tiles=[];for(var i=1;i<=tile.canPush.n;i++){switch(tile.canPush.direction){case this.config.labels.UP:tile.canPush.tiles.push(this.getTile({col:tile.col,row:tile.row-i}));break;case this.config.labels.RIGHT:tile.canPush.tiles.push(this.getTile({col:tile.col+i,row:tile.row}));break;case this.config.labels.DOWN:tile.canPush.tiles.push(this.getTile({col:tile.col,row:tile.row+i}));break;case this.config.labels.LEFT:tile.canPush.tiles.push(this.getTile({col:tile.col-i,row:tile.row}))}tile.canPush.tiles[i-1].max=null}}this.vibrate("select"),(tile.canMove||tile.canPush)&&(this.runtime.dragging=!0)}},game.getClosestColor=getClosestColor,game.setBgImage=function(params){"use strict";if(!document.createElement||"string"!=typeof params.imgUrl)return!1;var img=document.getElementById(this.config.labels.BACKGROUND_IMAGE_ID)||document.createElement("img");return console.log("loading image "+params.imgUrl+"..."),img.crossOrigin="",img.src=params.imgUrl,img.crossOrigin="",img.id=this.config.labels.BACKGROUND_IMAGE_ID,this.utils.listenTo(img,"load",function(event,context){console.log("background image loading complete",img),context.applyBgImage(event.target)},this.runtime.eventListeners,this),!0},game.applyBgImage=function(img){"use strict";var i,tileName,tile,averageRGB;this.runtime.backgroundImage=this.runtime.backgroundImage||{},this.runtime.backgroundImage.src=img.src;for(tileName in this.runtime.tiles)for(tile=this.getTile(tileName).htmlElement,i=0;i<tile.childNodes.length;i++)if(tile.childNodes[i].className===this.config.labels.TILE_INNER_CLASS){tile.childNodes[i].style.backgroundImage="url("+img.src+")";break}document.getElementById(this.config.labels.BACKGROUND_CONTAINER_ID).appendChild(img),averageRGB=this.utils.getAverageRGB(img),console.log("The average color for this image is ",averageRGB),this.applyBgColor(averageRGB),this.utils.stopListeningTo(img,"load",this.runtime.eventListeners)},game.adjustColor=function(rgb,mode,amount){"use strict";function limit(n,min,max){return n=Math.round(n),n<min?min:n>max?max:n}if(void 0===rgb)return console.log("which color?"),!1;switch("number"!=typeof amount&&(amount=.25),mode){case"brighter":return{r:limit(rgb.r*(1+amount),0,255),g:limit(rgb.g*(1+amount),0,255),b:limit(rgb.b*(1+amount),0,255)};case"darker":return{r:limit(rgb.r*(1-amount),0,255),g:limit(rgb.g*(1-amount),0,255),b:limit(rgb.b*(1-amount),0,255)};default:return console.log("color not changed",rgb),rgb}},game.applyBgColor=function(rgb){"use strict";var rgbVal="rgb("+rgb.r+","+rgb.g+","+rgb.b+")",hexVal="#"+rgb.r.toString(16)+rgb.g.toString(16)+rgb.b.toString(16),rgbDark=this.adjustColor(rgb,"darker",.65),rgbDarkVal="rgb("+rgbDark.r+","+rgbDark.g+","+rgbDark.b+")",hexDarkVal="#"+rgbDark.r.toString(16)+rgbDark.g.toString(16)+rgbDark.b.toString(16),rgbBright=this.adjustColor(rgb,"brighter",.2),rgbBrightVal="rgb("+rgbBright.r+","+rgbBright.g+","+rgbBright.b+")",hexBrightVal="#"+rgbBright.r.toString(16)+rgbBright.g.toString(16)+rgbBright.b.toString(16);this.runtime.backgroundImage=this.runtime.backgroundImage||{},this.runtime.backgroundImage.averageRGB=rgbVal,this.runtime.backgroundImage.averageRGB_darker=rgbDarkVal,this.runtime.backgroundImage.averageRGB_brighter=rgbBrightVal,this.runtime.backgroundImage.averageHEX=hexVal,this.runtime.backgroundImage.averageHEX_darker=hexDarkVal,this.runtime.backgroundImage.averageHEX_brighter=hexBrightVal,this.runtime.backgroundImage.blackish="#000"==getClosestColor(hexVal,["#000","#FFF"]),this.runtime.backgroundImage.whiteish=!this.runtime.backgroundImage.blackish,document.getElementById(this.config.labels.BACKGROUND_CONTAINER_ID).style.backgroundColor=rgbVal,document.getElementById(this.config.labels.GAME_ID).style.backgroundColor=hexBrightVal;var currentBoxShadow=this.utils.editCSSRule("#"+this.config.labels.BOARD_ID+" ."+this.config.labels.TILE_INNER_CLASS,"boxShadow");if(currentBoxShadow){for(var boxShadowProps=currentBoxShadow.replace(/,\s+/g,",").split(" "),i=0;i<boxShadowProps.length;i++){(boxShadowProps[i].indexOf("rgb")>-1||boxShadowProps[i].indexOf("#")>-1)&&(boxShadowProps[i]=rgbDarkVal);break}this.utils.editCSSRule("#"+this.config.labels.BOARD_ID+" ."+this.config.labels.TILE_INNER_CLASS,"boxShadow",boxShadowProps.join(" ")),document.getElementById(this.config.labels.BOARD_ID).style.backgroundColor=hexDarkVal}},game.shuffle=function(n,refresh){"use strict";console.log("shuffle"),this.vibrate("shuffle"),void 0===n&&(n=10*this.config.size.n),void 0===refresh&&(refresh=!0);for(var d,directions=[this.config.labels.UP,this.config.labels.RIGHT,this.config.labels.DOWN,this.config.labels.LEFT],movableTiles=[],i=0;i<n;i++)d=directions[Math.round(Math.random()*(directions.length-1))],movableTiles=this.getMovableTiles({direction:d,pushing:!1,moving:!0,force:!0}),this.moveTile(movableTiles[0],{transitions:!1,force:!0,refresh:!0});refresh&&this.refresh({transitions:!0,transitionDuration:100})},game.start=function(){"use strict";this.runtime.started=new Date,this.runtime.ended=!1,this.runtime.running=!0,this.runtime.movesCount=0,console.log("game started")},game.stop=function(){"use strict";this.runtime.ended=new Date,this.runtime.running=!1,console.log("game stopped")},game.vibrate=function(reasonToVibrate){"use strict";return!1};
//# sourceMappingURL=app.min.js.map