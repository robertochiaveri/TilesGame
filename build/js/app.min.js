function getClosestColor(inputColor,palette){"use strict";function isValidColor(color){return"string"!=typeof color?!1:/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(color)?!0:!1}function normalizedColor(color){return isValidColor(color)&&7!==color.length&&(color=color[0]+color[1]+color[1]+color[2]+color[2]+color[3]+color[3]),color.toUpperCase()}function isValidPalette(palette){if("object"!=typeof palette||!(palette instanceof Array))return!1;if(0===palette.length)return!1;for(var i=0;i<palette.length;i++){if(!isValidColor(palette[i]))return!1;palette[i]=normalizedColor(palette[i])}return!0}function normalizedPalette(palette){if(isValidPalette(palette))for(var i=0;i<palette.length;i++)palette[i]=normalizedColor(palette[i]);return palette}function hex2dec(hex){return parseInt(hex,16)}function getComponents(color){function rgbToXyz(r,g,b){var _r=r/255,_g=g/255,_b=b/255;_r>.04045?_r=Math.pow((_r+.055)/1.055,2.4):_r/=12.92,_g>.04045?_g=Math.pow((_g+.055)/1.055,2.4):_g/=12.92,_b>.04045?_b=Math.pow((_b+.055)/1.055,2.4):_b/=12.92,_r=100*_r,_g=100*_g,_b=100*_b;var X=.4124*_r+.3576*_g+.1805*_b,Y=.2126*_r+.7152*_g+.0722*_b,Z=.0193*_r+.1192*_g+.9505*_b;return[X,Y,Z]}function xyzToLab(x,y,z){var ref_X=95.047,ref_Y=100,ref_Z=108.883,_X=x/ref_X,_Y=y/ref_Y,_Z=z/ref_Z;_X=_X>.008856?Math.pow(_X,1/3):7.787*_X+16/116,_Y=_Y>.008856?Math.pow(_Y,1/3):7.787*_Y+16/116,_Z=_Z>.008856?Math.pow(_Z,1/3):7.787*_Z+16/116;var CIE_L=116*_Y-16,CIE_a=500*(_X-_Y),CIE_b=200*(_Y-_Z);return[CIE_L,CIE_a,CIE_b]}function rgbToLab(r,g,b){var xyz=rgbToXyz(r,g,b),lab=xyzToLab(xyz[0],xyz[1],xyz[2]);return lab}var r=hex2dec(color.substr(1,2)),g=hex2dec(color.substr(3,2)),b=hex2dec(color.substr(5,2));return{hex:color,rgb:[r,g,b],lab:rgbToLab(r,g,b)}}function colorDifference(color1,color2){var lab1=getComponents(color1).lab,lab2=getComponents(color2).lab,deltaE=Math.sqrt(Math.pow(lab2[0]-lab1[0],2)+Math.pow(lab2[1]-lab1[1],2)+Math.pow(lab2[2]-lab1[2],2));return deltaE}if(palette=normalizedPalette(palette),inputColor=normalizedColor(inputColor),!inputColor)throw"error: invalid input color";if(!palette)throw"error: invalid input palette";for(var closestColor=palette[0],i=0;i<palette.length;i++)colorDifference(inputColor,palette[i])<colorDifference(inputColor,closestColor)&&(closestColor=palette[i]);return closestColor}function jsonpCall(url,callback){"use strict";var callbackName="jsonp_callback_"+Math.round(1e5*Math.random());window[callbackName]=function(data){delete window[callbackName],document.body.removeChild(jsonpCallScript),callback(data)};var jsonpCallScript=document.createElement("script");jsonpCallScript.src=url+(url.indexOf("?")>=0?"&":"?")+"callback="+callbackName,document.body.appendChild(jsonpCallScript)}var game={utils:{},config:{},metrics:{}};!function(e,t,n){function r(e,t){return typeof e===t}function o(){var e,t,n,o,i,a,s;for(var l in E)if(E.hasOwnProperty(l)){if(e=[],t=E[l],t.name&&(e.push(t.name.toLowerCase()),t.options&&t.options.aliases&&t.options.aliases.length))for(n=0;n<t.options.aliases.length;n++)e.push(t.options.aliases[n].toLowerCase());for(o=r(t.fn,"function")?t.fn():t.fn,i=0;i<e.length;i++)a=e[i],s=a.split("."),1===s.length?Modernizr[s[0]]=o:(!Modernizr[s[0]]||Modernizr[s[0]]instanceof Boolean||(Modernizr[s[0]]=new Boolean(Modernizr[s[0]])),Modernizr[s[0]][s[1]]=o),_.push((o?"":"no-")+s.join("-"))}}function i(e){var t=x.className,n=Modernizr._config.classPrefix||"";if(T&&(t=t.baseVal),Modernizr._config.enableJSClass){var r=new RegExp("(^|\\s)"+n+"no-js(\\s|$)");t=t.replace(r,"$1"+n+"js$2")}Modernizr._config.enableClasses&&(t+=" "+n+e.join(" "+n),T?x.className.baseVal=t:x.className=t)}function a(e,t){if("object"==typeof e)for(var n in e)b(e,n)&&a(n,e[n]);else{e=e.toLowerCase();var r=e.split("."),o=Modernizr[r[0]];if(2==r.length&&(o=o[r[1]]),"undefined"!=typeof o)return Modernizr;t="function"==typeof t?t():t,1==r.length?Modernizr[r[0]]=t:(!Modernizr[r[0]]||Modernizr[r[0]]instanceof Boolean||(Modernizr[r[0]]=new Boolean(Modernizr[r[0]])),Modernizr[r[0]][r[1]]=t),i([(t&&0!=t?"":"no-")+r.join("-")]),Modernizr._trigger(e,t)}return Modernizr}function s(e,t){return!!~(""+e).indexOf(t)}function l(){return"function"!=typeof t.createElement?t.createElement(arguments[0]):T?t.createElementNS.call(t,"http://www.w3.org/2000/svg",arguments[0]):t.createElement.apply(t,arguments)}function u(){var e=t.body;return e||(e=l(T?"svg":"body"),e.fake=!0),e}function c(e,n,r,o){var i,a,s,c,f="modernizr",d=l("div"),p=u();if(parseInt(r,10))for(;r--;)s=l("div"),s.id=o?o[r]:f+(r+1),d.appendChild(s);return i=l("style"),i.type="text/css",i.id="s"+f,(p.fake?p:d).appendChild(i),p.appendChild(d),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(t.createTextNode(e)),d.id=f,p.fake&&(p.style.background="",p.style.overflow="hidden",c=x.style.overflow,x.style.overflow="hidden",x.appendChild(p)),a=n(d,e),p.fake?(p.parentNode.removeChild(p),x.style.overflow=c,x.offsetHeight):d.parentNode.removeChild(d),!!a}function f(e){return e.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-")}function d(t,n,r){var o;if("getComputedStyle"in e){o=getComputedStyle.call(e,t,n);var i=e.console;if(null!==o)r&&(o=o.getPropertyValue(r));else if(i){var a=i.error?"error":"log";i[a].call(i,"getComputedStyle returning null, its possible modernizr test results are inaccurate")}}else o=!n&&t.currentStyle&&t.currentStyle[r];return o}function p(t,r){var o=t.length;if("CSS"in e&&"supports"in e.CSS){for(;o--;)if(e.CSS.supports(f(t[o]),r))return!0;return!1}if("CSSSupportsRule"in e){for(var i=[];o--;)i.push("("+f(t[o])+":"+r+")");return i=i.join(" or "),c("@supports ("+i+") { #modernizr { position: absolute; } }",function(e){return"absolute"==d(e,null,"position")})}return n}function m(e){return e.replace(/([a-z])-([a-z])/g,function(e,t,n){return t+n.toUpperCase()}).replace(/^-/,"")}function h(e,t,o,i){function a(){c&&(delete N.style,delete N.modElem)}if(i=r(i,"undefined")?!1:i,!r(o,"undefined")){var u=p(e,o);if(!r(u,"undefined"))return u}for(var c,f,d,h,v,g=["modernizr","tspan","samp"];!N.style&&g.length;)c=!0,N.modElem=l(g.shift()),N.style=N.modElem.style;for(d=e.length,f=0;d>f;f++)if(h=e[f],v=N.style[h],s(h,"-")&&(h=m(h)),N.style[h]!==n){if(i||r(o,"undefined"))return a(),"pfx"==t?h:!0;try{N.style[h]=o}catch(y){}if(N.style[h]!=v)return a(),"pfx"==t?h:!0}return a(),!1}function v(e,t){return function(){return e.apply(t,arguments)}}function g(e,t,n){var o;for(var i in e)if(e[i]in t)return n===!1?e[i]:(o=t[e[i]],r(o,"function")?v(o,n||t):o);return!1}function y(e,t,n,o,i){var a=e.charAt(0).toUpperCase()+e.slice(1),s=(e+" "+z.join(a+" ")+a).split(" ");return r(t,"string")||r(t,"undefined")?h(s,t,o,i):(s=(e+" "+k.join(a+" ")+a).split(" "),g(s,t,n))}function S(e,t,r){return y(e,n,n,t,r)}var E=[],C={_version:"3.6.0",_config:{classPrefix:"",enableClasses:!0,enableJSClass:!0,usePrefixes:!0},_q:[],on:function(e,t){var n=this;setTimeout(function(){t(n[e])},0)},addTest:function(e,t,n){E.push({name:e,fn:t,options:n})},addAsyncTest:function(e){E.push({name:null,fn:e})}},Modernizr=function(){};Modernizr.prototype=C,Modernizr=new Modernizr;var b,_=[],x=t.documentElement,T="svg"===x.nodeName.toLowerCase();!function(){var e={}.hasOwnProperty;b=r(e,"undefined")||r(e.call,"undefined")?function(e,t){return t in e&&r(e.constructor.prototype[t],"undefined")}:function(t,n){return e.call(t,n)}}(),C._l={},C.on=function(e,t){this._l[e]||(this._l[e]=[]),this._l[e].push(t),Modernizr.hasOwnProperty(e)&&setTimeout(function(){Modernizr._trigger(e,Modernizr[e])},0)},C._trigger=function(e,t){if(this._l[e]){var n=this._l[e];setTimeout(function(){var e,r;for(e=0;e<n.length;e++)(r=n[e])(t)},0),delete this._l[e]}},Modernizr._q.push(function(){C.addTest=a}),T||!function(e,t){function n(e,t){var n=e.createElement("p"),r=e.getElementsByTagName("head")[0]||e.documentElement;return n.innerHTML="x<style>"+t+"</style>",r.insertBefore(n.lastChild,r.firstChild)}function r(){var e=x.elements;return"string"==typeof e?e.split(" "):e}function o(e,t){var n=x.elements;"string"!=typeof n&&(n=n.join(" ")),"string"!=typeof e&&(e=e.join(" ")),x.elements=n+" "+e,u(t)}function i(e){var t=_[e[C]];return t||(t={},b++,e[C]=b,_[b]=t),t}function a(e,n,r){if(n||(n=t),v)return n.createElement(e);r||(r=i(n));var o;return o=r.cache[e]?r.cache[e].cloneNode():E.test(e)?(r.cache[e]=r.createElem(e)).cloneNode():r.createElem(e),!o.canHaveChildren||S.test(e)||o.tagUrn?o:r.frag.appendChild(o)}function s(e,n){if(e||(e=t),v)return e.createDocumentFragment();n=n||i(e);for(var o=n.frag.cloneNode(),a=0,s=r(),l=s.length;l>a;a++)o.createElement(s[a]);return o}function l(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(n){return x.shivMethods?a(n,e,t):t.createElem(n)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+r().join().replace(/[\w\-:]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(x,t.frag)}function u(e){e||(e=t);var r=i(e);return!x.shivCSS||h||r.hasCSS||(r.hasCSS=!!n(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),v||l(e,r),e}function c(e){for(var t,n=e.getElementsByTagName("*"),o=n.length,i=RegExp("^(?:"+r().join("|")+")$","i"),a=[];o--;)t=n[o],i.test(t.nodeName)&&a.push(t.applyElement(f(t)));return a}function f(e){for(var t,n=e.attributes,r=n.length,o=e.ownerDocument.createElement(w+":"+e.nodeName);r--;)t=n[r],t.specified&&o.setAttribute(t.nodeName,t.nodeValue);return o.style.cssText=e.style.cssText,o}function d(e){for(var t,n=e.split("{"),o=n.length,i=RegExp("(^|[\\s,>+~])("+r().join("|")+")(?=[[\\s,>+~#.:]|$)","gi"),a="$1"+w+"\\:$2";o--;)t=n[o]=n[o].split("}"),t[t.length-1]=t[t.length-1].replace(i,a),n[o]=t.join("}");return n.join("{")}function p(e){for(var t=e.length;t--;)e[t].removeNode()}function m(e){function t(){clearTimeout(a._removeSheetTimer),r&&r.removeNode(!0),r=null}var r,o,a=i(e),s=e.namespaces,l=e.parentWindow;return!N||e.printShived?e:("undefined"==typeof s[w]&&s.add(w),l.attachEvent("onbeforeprint",function(){t();for(var i,a,s,l=e.styleSheets,u=[],f=l.length,p=Array(f);f--;)p[f]=l[f];for(;s=p.pop();)if(!s.disabled&&T.test(s.media)){try{i=s.imports,a=i.length}catch(m){a=0}for(f=0;a>f;f++)p.push(i[f]);try{u.push(s.cssText)}catch(m){}}u=d(u.reverse().join("")),o=c(e),r=n(e,u)}),l.attachEvent("onafterprint",function(){p(o),clearTimeout(a._removeSheetTimer),a._removeSheetTimer=setTimeout(t,500)}),e.printShived=!0,e)}var h,v,g="3.7.3",y=e.html5||{},S=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,E=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,C="_html5shiv",b=0,_={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",h="hidden"in e,v=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(n){h=!0,v=!0}}();var x={elements:y.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output picture progress section summary template time video",version:g,shivCSS:y.shivCSS!==!1,supportsUnknownElements:v,shivMethods:y.shivMethods!==!1,type:"default",shivDocument:u,createElement:a,createDocumentFragment:s,addElements:o};e.html5=x,u(t);var T=/^$|\b(?:all|print)\b/,w="html5shiv",N=!v&&function(){var n=t.documentElement;return!("undefined"==typeof t.namespaces||"undefined"==typeof t.parentWindow||"undefined"==typeof n.applyElement||"undefined"==typeof n.removeNode||"undefined"==typeof e.attachEvent)}();x.type+=" print",x.shivPrint=m,m(t),"object"==typeof module&&module.exports&&(module.exports=x)}("undefined"!=typeof e?e:this,t);var w={elem:l("modernizr")};Modernizr._q.push(function(){delete w.elem});var N={style:w.elem.style};Modernizr._q.unshift(function(){delete N.style});var j=(C.testProp=function(e,t,r){return h([e],n,t,r)},C._config.usePrefixes?" -webkit- -moz- -o- -ms- ".split(" "):["",""]);C._prefixes=j;var P="Moz O ms Webkit",z=C._config.usePrefixes?P.split(" "):[];C._cssomPrefixes=z;var k=C._config.usePrefixes?P.toLowerCase().split(" "):[];C._domPrefixes=k,C.testAllProps=y,C.testAllProps=S;var F="CSS"in e&&"supports"in e.CSS,M="supportsCSS"in e;Modernizr.addTest("supports",F||M),Modernizr.addTest("cssfilters",function(){if(Modernizr.supports)return S("filter","blur(2px)");var e=l("a");return e.style.cssText=j.join("filter:blur(2px); "),!!e.style.length&&(t.documentMode===n||t.documentMode>9)}),Modernizr.addTest("cssanimations",S("animationName","a",!0)),Modernizr.addTest("csstransforms3d",function(){return!!S("perspective","1px",!0)}),Modernizr.addTest("csstransitions",S("transition","all",!0)),Modernizr.addTest("localstorage",function(){var e="modernizr";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(t){return!1}}),o(),i(_),delete C.addTest,delete C.addAsyncTest;for(var $=0;$<Modernizr._q.length;$++)Modernizr._q[$]();e.Modernizr=Modernizr}(window,document),function(){"use strict";for(var method,noop=function(){},methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],length=methods.length,console=window.console=window.console||{};length--;)method=methods[length],console[method]||(console[method]=noop)}(),game.utils.addClass=function(element,cls){"use strict";return-1===(" "+element.className+" ").indexOf(" "+cls+" ")&&(element.className=element.className+" "+cls),element.className.replace(/  +/g," ")},game.utils.checkBrowser=function(){return!(/MSIE\s/.test(navigator.userAgent)&&parseFloat(navigator.appVersion.split("MSIE")[1])<11)},game.utils.cloneObj=function(obj){"use strict";if(null===obj||"object"!=typeof obj)return obj;var copy=obj.constructor();for(var attr in obj)obj.hasOwnProperty(attr)&&"htmlElement"!==attr&&(copy[attr]=obj[attr]);return copy},game.utils.createCSSClass=function(selector,style){"use strict";if(!document.styleSheets)return!1;if(0===document.getElementsByTagName("head").length)return!1;var styleSheet,mediaType,media,i;if(document.styleSheets.length>0)for(i=0;i<document.styleSheets.length&&(document.styleSheets[i].disabled||(media=document.styleSheets[i].media,mediaType=typeof media,"string"===mediaType?(""===media||-1!==media.indexOf("screen"))&&(styleSheet=document.styleSheets[i]):"object"===mediaType&&(""===media.mediaText||-1!==media.mediaText.indexOf("screen"))&&(styleSheet=document.styleSheets[i]),"undefined"==typeof styleSheet));i++);if("undefined"==typeof styleSheet){var styleSheetElement=document.createElement("style");for(styleSheetElement.type="text/css",document.getElementsByTagName("head")[0].appendChild(styleSheetElement),i=0;i<document.styleSheets.length;i++)document.styleSheets[i].disabled||(styleSheet=document.styleSheets[i]);media=styleSheet.media,mediaType=typeof media}if("string"===mediaType){for(i=0;i<styleSheet.rules.length;i++)if(styleSheet.rules[i].selectorText.toLowerCase()===selector.toLowerCase())return void(styleSheet.rules[i].style.cssText=style);styleSheet.addRule(selector,style)}else if("object"===mediaType){for(i=0;i<styleSheet.cssRules.length;i++)if(styleSheet.cssRules[i].selectorText.toLowerCase()===selector.toLowerCase())return void(styleSheet.cssRules[i].style.cssText=style);styleSheet.insertRule(selector+"{"+style+"}",0)}},game.utils.detectFullscreen=function(){"use strict";return"standalone"in window.navigator&&window.navigator.standalone?!0:!1},game.utils.editCSSRule=function(ruleClass,property,newValue){"use strict";for(var s=0;s<document.styleSheets.length;s++){var sheet=document.styleSheets[s],rules=sheet.cssRules?sheet.cssRules:sheet.rules;if(null==rules)return"null";for(var i=0;i<rules.length;i++)if(rules[i].selectorText===ruleClass)return"undefined"!=typeof newValue?rules[i].style[property]=newValue:rules[i].style[property]}return null},game.utils.getAverageRGB=function(img){"use strict";var imageData,data,canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),width=canvas.width=img.naturalWidth,height=canvas.height=img.naturalHeight,defaultRGB={r:200,g:200,b:200};ctx.drawImage(img,0,0);try{imageData=ctx.getImageData(0,0,width,height)}catch(e){return console.log("Problem parsing this image",e),defaultRGB}data=imageData.data;for(var r=0,g=0,b=0,i=0,l=data.length;l>i;i+=4)r+=data[i],g+=data[i+1],b+=data[i+2];return r=Math.floor(r/(data.length/4)),g=Math.floor(g/(data.length/4)),b=Math.floor(b/(data.length/4)),{r:r,g:g,b:b}},game.utils.getBrowserPrefix=function(){"use strict";var styles=window.getComputedStyle(document.documentElement,""),pre=(Array.prototype.slice.call(styles).join("").match(/-(moz|webkit|ms)-/)||""===styles.OLink&&["","o"])[1],dom="WebKit|Moz|MS|O".match(new RegExp("("+pre+")","i"))[1];return{dom:[dom],lowercase:[pre],css:["-"+pre+"-"],js:[pre[0].toUpperCase()+pre.substr(1)]}},game.utils.hasClass=function(element,cls){"use strict";return(" "+element.className+" ").indexOf(" "+cls+" ")>-1},game.utils.listenTo=function(element,eventType,fn,listenersList,context){"use strict";if(listenersList=listenersList||{},!element)return console.log("can't find this element: "+element),!1;var id=element.id;if("undefined"==typeof id||""===id)if(element===document.body)id="body";else if(element===document.documentElement)id="html";else{if(element!==window)return console.log("better not add a listener to elements witout id: ",element),!1;id="window"}return"undefined"==typeof listenersList[id]&&(listenersList[id]={}),"undefined"!=typeof listenersList[id][eventType]?(console.log("cannot add another listener for "+eventType+" to ",element),!1):(listenersList[id][eventType]=fn,void(element.addEventListener?element.addEventListener&&(0===eventType.indexOf("touch")?element.addEventListener(eventType,function(event){if(event.preventDefault(),0===event.touches.length)fn(event,context);else for(var i=0;i<event.touches.length;i++)event.touches[i].timeStamp=event.timeStamp,event.touches[i].type=event.type,event.touches[i].multiTouchEvent=event,fn(event.touches[i],context)},!0):element.addEventListener(eventType,function(event){fn(event,context)},!1)):element.attachEvent("on"+eventType,fn)))},game.utils.removeClass=function(element,cls){"use strict";var regexp=new RegExp("\\b"+cls+"\\b","g");return element.className=" "+element.className+" ",element.className=element.className.replace(regexp,""),element.className.replace(/  +/g," ")},game.utils.roundTo=function(input,num){"use strict";var resto=input%num;return num/2>=resto?input-resto:input+num-resto},game.utils.stopListeningTo=function(element,eventType,listenersList){"use strict";if("undefined"==typeof listenersList)return console.log("no registered listeners in ",listenersList),!1;var id=element.id;if("undefined"==typeof element.id||""===element.id)if(element===document.body)id="body";else if(element===document.documentElement)id="html";else{if(element!==window)return console.log("better not add a listener to elements witout id: ",element),!1;id="window"}return"undefined"!=typeof listenersList[id][eventType]?(element.removeEventListener(eventType,listenersList[id][eventType]),listenersList[id][eventType]=void 0,!0):!1},game.utils.trim=function(str){"use strict";str=str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");for(var ws=/\s/,i=str.length;ws.test(str.charAt(--i)););return str.slice(0,i+1)},game.config={size:{h:4,v:4},margin:{h:4,v:4},borderSize:4,pushMultiple:!0,minDistanceToMoveTile:.25,clickToMove:!0,maxTimeForClickMove:200,touchTolerance:.2,transitionDuration:{generic:60,byKeyboard:100},useKeyboard:!0},game.config.easings={EASING_TILES_MOVEMENT:"cubic-bezier(0.403, 0.543, 0.754, 1)"},game.config.keycodes={KEY_ARROW_LEFT:37,KEY_ARROW_UP:38,KEY_ARROW_RIGHT:39,KEY_ARROW_DOWN:40,KEY_ESCAPE:2,KEY_RETURN:13},game.config.labels={WRAPPER_ID:"game-wrapper",GAME_ID:"game",BOARD_ID:"board",TOOLBAR_ID:"toolbar",BACKGROUND_CONTAINER_ID:"bg",BACKGROUND_IMAGE_ID:"bg-img",TILE_PREFIX:"tile-",TILE_CLASS:"tile",TILE_INNER_CLASS:"inner",TILE_NUMBER_CLASS:"number",TBUTTON_PREFIX:"btn-",SELECTED_LABEL:"selected",PRESSED_LABEL:"pressed",ANIMATED_LABEL:"animationInProgress",USETOUCH_LABEL:"touch",NO_TOUCH_LABEL:"no-touch",UP:"up",RIGHT:"right",DOWN:"down",LEFT:"left",LANDSCAPE:"landscape",PORTRAIT:"portrait",SAVEDGAMES_LABEL:"savedGames",AUTOSAVE_LABEL:"automatic",USERSAVE_LABEL:"user",SORTEDSAVE_LABEL:"sorted",SHUFFLEDSAVE_LABEL:"shuffled"},game.config.toolbarButtons=[{id:"new",description:"New game",handler:function(){window.confirm("Start a new game?")&&this.newGame()}},{id:"save",description:"Save the board",handler:function(){this.saveGame(this.config.labels.USERSAVE_LABEL),this.utils.addClass(document.getElementById("btn-save"),"on")}},{id:"load",description:"Load the saved board",handler:function(){window.confirm("Load the saved game?")&&this.loadGame(this.config.labels.USERSAVE_LABEL),this.animate({element:document.getElementById(this.config.labels.GAME_ID),animation:"load",duration:1e3})}},{id:"settings",description:"change your preferences",handler:function(){}},{id:"info",description:"About this game",handler:function(){}}],game.ajaxCall=function(url){"use strict";var xmlhttp;return window.XMLHttpRequest?(xmlhttp=new XMLHttpRequest,xmlhttp.onreadystatechange=function(){console.log(xmlhttp.status),4===xmlhttp.readyState&&200===xmlhttp.status&&console.log(xmlhttp.responseText)},xmlhttp.open("GET",url,!0),void xmlhttp.send()):!1},game.animate=function(params){"use strict";if("undefined"==typeof params||!params.element||"string"!=typeof params.animation)return console.log("wrong parameters in animate call",params),!1;"number"!=typeof params.duration&&(params.duration=this.config.transitionDuration.generic);for(var CSSstyleDeclaration,prefix="",p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"animation-fill-mode:both;",CSSstyleDeclaration+=prefix+"animation-duration:"+params.duration+"ms;",CSSstyleDeclaration+=prefix+"animation-name:"+params.animation+";","undefined"!=typeof params.iterations&&(CSSstyleDeclaration+=prefix+"animation-iteration-count:"+params.iteration+";"),"number"==typeof params.delay&&(CSSstyleDeclaration+=prefix+"animation-delay:"+params.delay+"ms;"),"string"==typeof params.easing&&(CSSstyleDeclaration+=prefix+"animation-timing-function:"+params.easing+";"),0>p?this.utils.listenTo(params.element,"animationend",function(event,context){context.utils.stopListeningTo(params.element,"animationend",context.runtime.eventListeners),event.target.style["animation-name"]=""},this.runtime.eventListeners,this):this.utils.listenTo(params.element,this.config.browserPrefixes.lowercase[p]+"AnimationEnd",function(event,context){context.utils.stopListeningTo(params.element,event.type,context.runtime.eventListeners),event.target.style[event.type.replace("End","Name")]="",context.utils.removeClass(params.element,context.config.labels.ANIMATED_LABEL)},this.runtime.eventListeners,this);game.utils.addClass(params.element,game.config.labels.ANIMATED_LABEL),params.element.style.cssText+=CSSstyleDeclaration},game.canMove=function(tile){"use strict";tile=this.isTile(tile)||null;var hole=this.runtime.tiles[this.config.labels.TILE_PREFIX+this.config.labels.HOLE_INDEX],holePosition=hole.col+"-"+hole.row;return tile?holePosition===tile.col+"-"+(tile.row-1)?this.config.labels.UP:holePosition===tile.col+1+"-"+tile.row?this.config.labels.RIGHT:holePosition===tile.col+"-"+(tile.row+1)?this.config.labels.DOWN:holePosition===tile.col-1+"-"+tile.row?this.config.labels.LEFT:!1:!1},game.canPush=function(tile){"use strict";tile=this.isTile(tile)||!1;var hole=this.runtime.tiles[this.config.labels.TILE_PREFIX+this.config.labels.HOLE_INDEX],tilesToPush=0,pushableTiles=0;return tile?!this.config.pushMultiple||tile.col!==hole.col&&tile.row!==hole.row?!1:(tilesToPush=tile.col-hole.col===0?hole.row-tile.row:hole.col-tile.col,pushableTiles=Math.abs(tilesToPush)-1,0===tilesToPush||0===pushableTiles?!1:tile.col===hole.col?tilesToPush>0?{n:pushableTiles,direction:this.config.labels.DOWN}:{n:pushableTiles,direction:this.config.labels.UP}:tilesToPush>0?{n:pushableTiles,direction:this.config.labels.RIGHT}:{n:pushableTiles,direction:this.config.labels.LEFT}):!1},game.changeBg=function(params){"use strict";try{this.setBgImage({imgUrl:"https://source.unsplash.com/random/"+this.metrics.width+"x"+this.metrics.height})}catch(e){console.log("error loading a bg image",e)}},game.checkFeatures=function(){"use strict";return this.config.browserOK=game.utils.checkBrowser(),this.config.browserOK?(this.config.useTouch=Modernizr.touch,this.utils.addClass(document.getElementById(this.config.labels.GAME_ID),this.config.useTouch?this.config.labels.USETOUCH_LABEL:this.config.labels.NO_TOUCH_LABEL),this.config.useCSStransitions=Modernizr.csstransitions,this.config.useCSStransitions||(console.log("css transitions are disabled"),this.utils.createCSSClass("#"+this.config.labels.GAME_ID+" * ","transition: none !important;")),this.config.use3Dtransforms=Modernizr.csstransforms3d,this.config.useLstorage=Modernizr.localstorage,this.config.useVibration=!0,this.config.useCssAnimations=Modernizr.cssanimations,this.config.launchedAsApp=this.utils.detectFullscreen(),this.config.browserPrefixes=this.utils.getBrowserPrefix(),void(this.config.useReqAnimFrame=!!window.requestAnimationFrame)):(console.log("Browser not supported"),alert("this browser version isn't supported"),!1)},game.countMove=function(){"use strict";this.runtime.movesCount++},game.createBoard=function(){"use strict";var boardHTML,tile,row=0,col=0;null===document.getElementById(this.config.labels.BOARD_ID)?(boardHTML=document.createElement("div"),boardHTML.setAttribute("id",this.config.labels.BOARD_ID),document.getElementById(this.config.labels.GAME_ID).appendChild(boardHTML)):document.getElementById(this.config.labels.BOARD_ID).innerHTML="",this.config.size.n=this.config.size.h*this.config.size.v,this.config.labels.HOLE_INDEX=this.config.size.n-1;for(var i=0;i<this.config.size.n;i++)tile={i:i,id:this.config.labels.TILE_PREFIX+i,col:col,row:row,correctCol:col,correctRow:row,even:i%2===0?!0:!1,evenCol:col%2===0?!0:!1,evenRow:row%2===0?!0:!1},tile.htmlElement=document.createElement("div"),tile.htmlElement.setAttribute("id",this.config.labels.TILE_PREFIX+i),tile.htmlElement.setAttribute("tabindex",i),tile.htmlElement.setAttribute("class"," tile"+(tile.evenRow?" even-row":" odd-row")+(tile.evenCol?" even-col":" odd-col")+(tile.even?" even":" odd")+(i===this.config.labels.HOLE_INDEX?" hole":"")+" col-"+col+" row-"+row),tile.htmlElement.innerHTML='<div class="'+this.config.labels.TILE_INNER_CLASS+'"><div class="'+this.config.labels.TILE_NUMBER_CLASS+'">'+(i+1)+"</div></div>",this.runtime.tiles[this.config.labels.TILE_PREFIX+i]=tile,document.getElementById(this.config.labels.BOARD_ID).appendChild(tile.htmlElement),col++,col>=this.config.size.h&&(row++,col=0);this.saveGame(this.config.labels.SORTEDSAVE_LABEL)},game.deselectTile=function(){"use strict";var tile=this.isTile(this.runtime.selectedTile),tilesMoved=0;if(!tile)return!1;if(console.log("de-selecting"),this.runtime.selectedTile=null,this.utils.removeClass(tile.htmlElement,this.config.labels.SELECTED_LABEL),this.utils.removeClass(tile.htmlElement,this.config.labels.PRESSED_LABEL),this.runtime.dragging=!1,this.vibrate("deselect"),"undefined"==typeof tile.newPosition)return!1;if(null!==tile.newPosition.left.newValue.pixels){if(console.log("the tile has been moved."),this.config.pushMultiple&&tile.canPush){console.log("the tile could push other tiles, so it must have pushed them.");for(var i=tile.canPush.tiles.length;i>0;i--)tile.canPush.tiles[0].revert||(tilesMoved++,this.moveTile(tile.canPush.tiles[i-1],{transitions:!0,force:!1,refresh:!1}))}console.log("now, the tile has been released far enough to its original position in order to move it?"),Math.abs(tile.newPosition.left.newValue.pixels-tile.oldPosition.left.pixels)>=this.metrics.tileWidth*this.config.minDistanceToMoveTile||Math.abs(tile.newPosition.top.newValue.pixels-tile.oldPosition.top.pixels)>=this.metrics.tileHeight*this.config.minDistanceToMoveTile?(console.log("yes, it's far enough. "),tilesMoved++,this.moveTile(tile,{transitions:!0,force:!1,refresh:!1})):console.log("nope, snapping back ")}else if(console.log("tile has not been moved at all."),this.config.clickToMove&&(tile.canMove||this.config.pushMultiple&&tile.canPush)){for(var i=tile.canPush.tiles.length;i>0;i--)tilesMoved++,this.moveTile(tile.canPush.tiles[i-1],{transitions:!0,force:!1,refresh:!1});tilesMoved++,this.moveTile(tile,{transitions:!0,force:!1,refresh:!1})}console.log("tiles moved: "+tilesMoved),this.refresh({saveGame:!!tilesMoved})},game.dragTile=function(event){"use strict";if(!this.runtime.running)return this.deselectTile(),!1;var direction,newPosX,newPosY,otherTile,otherTileNewPos,p,tile=this.isTile(this.runtime.selectedTile),CSSstyleDeclaration="";if(!tile||!tile.canMove&&!tile.canPush.n||"undefined"==typeof tile.offset||"undefined"==typeof tile.newPosition)return this.deselectTile(),!1;if(newPosX=event.pageX-this.metrics.borderSize.pixels-this.metrics.left-tile.offset.left,newPosY=event.pageY-this.metrics.borderSize.pixels-this.metrics.top-tile.offset.top,direction=this.config.pushMultiple&&tile.canPush?tile.canPush.direction:tile.canMove,newPosY<tile.newPosition.top.min.pixels&&(newPosY=tile.newPosition.top.min.pixels),newPosY>tile.newPosition.top.max.pixels&&(newPosY=tile.newPosition.top.max.pixels),newPosX<tile.newPosition.left.min.pixels&&(newPosX=tile.newPosition.left.min.pixels),newPosX>tile.newPosition.left.max.pixels&&(newPosX=tile.newPosition.left.max.pixels),event.pageX-this.metrics.left-this.metrics.borderSize.pixels+this.metrics.tileWidth*this.config.touchTolerance<newPosX||event.pageX-this.metrics.left-this.metrics.borderSize.pixels-this.metrics.tileWidth*(1+this.config.touchTolerance)>newPosX||event.pageY-this.metrics.top-this.metrics.borderSize.pixels+this.metrics.tileHeight*this.config.touchTolerance<newPosY||event.pageY-this.metrics.top-this.metrics.borderSize.pixels-this.metrics.tileHeight*(1+this.config.touchTolerance)>newPosY)return this.deselectTile(),!1;var prefix="";switch(direction){case this.config.labels.LEFT:case this.config.labels.RIGHT:for(tile.newPosition.top.newValue.pixels=tile.oldPosition.top.pixels,tile.newPosition.left.newValue.pixels=newPosX,tile.newPosition.left.newValue.percent=100*newPosX/game.metrics.tileWidth,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+tile.newPosition.left.newValue.percent+"%,"+tile.oldPosition.top.percent+"%"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case this.config.labels.UP:case this.config.labels.DOWN:for(tile.newPosition.top.newValue.pixels=newPosY,tile.newPosition.left.newValue.pixels=tile.oldPosition.left.pixels,tile.newPosition.top.newValue.percent=100*newPosY/this.metrics.tileHeight,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+tile.newPosition.top.newValue.percent+"%"+game.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; "}if(this.config.useReqAnimFrame?(this.addMovingTile(tile,CSSstyleDeclaration),window.requestAnimationFrame(game.renderMovingTiles)):tile.htmlElement.style.cssText=CSSstyleDeclaration,this.config.pushMultiple&&"undefined"!=typeof tile.canPush.tiles)for(var i=0;i<tile.canPush.tiles.length;i++){switch(otherTile=tile.canPush.tiles[i],
prefix="",direction){case this.config.labels.UP:if(otherTileNewPos=tile.newPosition.top.newValue.pixels-this.metrics.tileHeight*(i+1),!(otherTileNewPos<tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;for(tile.canPush.tiles[i].max=otherTileNewPos,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+otherTileNewPos+"px"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case this.config.labels.RIGHT:if(otherTileNewPos=tile.newPosition.left.newValue.pixels+this.metrics.tileWidth*(i+1),!(otherTileNewPos>tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;for(tile.canPush.tiles[i].max=otherTileNewPos,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+otherTileNewPos+"px,"+tile.oldPosition.top.percent+"%"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case this.config.labels.DOWN:if(otherTileNewPos=tile.newPosition.top.newValue.pixels+game.metrics.tileHeight*(i+1),!(otherTileNewPos>tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;for(tile.canPush.tiles[i].max=otherTileNewPos,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+tile.oldPosition.left.percent+"%,"+otherTileNewPos+"px"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; ";break;case this.config.labels.LEFT:if(otherTileNewPos=tile.newPosition.left.newValue.pixels-this.metrics.tileWidth*(i+1),!(otherTileNewPos<tile.canPush.tiles[i].max||null==tile.canPush.tiles[i].max))return!1;for(tile.canPush.tiles[i].max=otherTileNewPos,p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+otherTileNewPos+"px,"+tile.oldPosition.top.percent+"%"+this.metrics.transforms3Dsupport[1]+"); "+prefix+"transition:none; "}this.config.useReqAnimFrame?(this.addMovingTile(otherTile,CSSstyleDeclaration),window.requestAnimationFrame(game.renderMovingTiles)):otherTile.htmlElement.style.cssText=CSSstyleDeclaration,Math.abs(tile.newPosition.left.newValue.pixels-tile.oldPosition.left.pixels)>=this.metrics.tileWidth*this.config.minDistanceToMoveTile||Math.abs(tile.newPosition.top.newValue.pixels-tile.oldPosition.top.pixels)>=this.metrics.tileHeight*this.config.minDistanceToMoveTile?otherTile.revert=!1:otherTile.revert=!0}},game.getMovableTiles=function(params){"use strict";var t,direction=params.direction,pushing=params.pushing,moving=params.moving;if(this.runtime.movableTiles=[],this.runtime.running||params.force===!0)for(var i=0;i<this.config.size.n;i++)t=this.runtime.tiles["tile-"+i],t.canMove&&moving&&("undefined"==typeof direction||direction===t.canMove)&&this.runtime.movableTiles.push(this.getTile(this.config.labels.TILE_PREFIX+t.i)),this.config.pushMultiple&&pushing&&t.canPush&&!t.canMove&&("undefined"==typeof direction||direction===t.canPush.direction)&&this.runtime.movableTiles.push(this.getTile(this.config.labels.TILE_PREFIX+t.i));return this.runtime.movableTiles},game.getTile=function(param){"use strict";var i,target=null,maxLevels=5,tiles=this.runtime.tiles,col=parseInt(param.col),row=parseInt(param.row),prefix=this.config.labels.TILE_PREFIX;switch(typeof param){case"object":if(param.srcElement)target=param.srcElement;else{if(!param.pageX||!param.pageY){if(isNaN(parseInt(param.col))||isNaN(parseInt(param.row)))return!1;for(i=0;i<this.config.size.n;i++)if(tiles[prefix+i].col===col&&tiles[prefix+i].row===row)return tiles[prefix+i];return!1}target=document.elementFromPoint(param.pageX,param.pageY)}if(null===target)return!1;for(i=0;maxLevels>i;i++){if("undefined"==typeof target||"undefined"==typeof target.parentNode||null===target||null===target.parentNode)return!1;if(target.parentNode.id===this.config.labels.BOARD_ID)return this.runtime.tiles[target.id];target=target.parentNode}return!1;case"string":return 0===param.indexOf(prefix)?tiles[param]:!1;case"number":return param<this.config.size.n?tiles[prefix+param]:!1}},game.init=function(){"use strict";this.runtime={started:!1,running:!1,ended:!1,timePlaying:0,movesCount:!1,dragging:!1,resizeTimer:-1,selectedTile:null,tiles:{},latestSelection:0,eventListeners:{}},this.checkFeatures(),this.createBoard(),this.metricsUpdate(),this.changeBg(),this.initListeners(),this.refresh({transitions:!1}),this.loadGame()?(this.animate({element:document.getElementById(this.config.labels.GAME_ID),animation:"load",duration:1e3}),this.start()):this.newGame()},game.initListeners=function(){"use strict";this.utils.listenTo(document.getElementById(this.config.labels.BOARD_ID),this.config.useTouch?"touchstart":"mousedown",function(event,context){return event.timeStamp-context.runtime.latestSelection<300?!1:(context.runtime.latestSelection=event.timeStamp,void context.selectTile(context.getTile(event),event))},this.runtime.eventListeners,this),this.utils.listenTo(document.getElementById(this.config.labels.WRAPPER_ID),this.config.useTouch?"touchmove":"mousemove",function(event,context){return!1},this.runtime.eventListeners,this),this.utils.listenTo(document.getElementById(this.config.labels.BOARD_ID),this.config.useTouch?"touchmove":"mousemove",function(event,context){if(context.runtime.selectedTile)context.dragTile(event);else if("mousemove"!==event.type){if(event.timeStamp-context.runtime.latestSelection<300)return!1;context.runtime.latestSelection=event.timeStamp,context.selectTile(context.getTile(event),event)}},this.runtime.eventListeners,this),this.utils.listenTo(document.getElementById(this.config.labels.WRAPPER_ID),this.config.useTouch?"touchend":"mouseup",function(event,context){return"undefined"==typeof context.runtime.selectedTile||null===context.runtime.selectedTile?!1:(context.config.useTouch&&event.timeStamp-context.runtime.selectedTile.timeStamp>context.config.maxTimeForClickMove&&null===context.runtime.selectedTile.newPosition.top.newValue.pixels&&null===context.runtime.selectedTile.newPosition.left.newValue.pixels&&(context.runtime.selectedTile.newPosition=void 0),void context.deselectTile())},this.runtime.eventListeners,this),this.utils.listenTo(document.getElementById(this.config.labels.GAME_ID),"mouseout",function(event,context){event=event?event:window.event;var from=event.relatedTarget||event.toElement;from&&"HTML"!==from.nodeName||context.deselectTile()},this.runtime.eventListeners,this),this.config.useKeyboard&&this.utils.listenTo(document.body,"keyup",function(event,context){switch(event.which){case context.config.keycodes.KEY_ARROW_LEFT:context.moveAnyTile({direction:context.config.labels.LEFT,pushing:event.ctrlKey});break;case context.config.keycodes.KEY_ARROW_UP:context.moveAnyTile({direction:context.config.labels.UP,pushing:event.ctrlKey});break;case context.config.keycodes.KEY_ARROW_RIGHT:context.moveAnyTile({direction:context.config.labels.RIGHT,pushing:event.ctrlKey});break;case context.config.keycodes.KEY_ARROW_DOWN:context.moveAnyTile({direction:context.config.labels.DOWN,pushing:event.ctrlKey})}},this.runtime.eventListeners,this),this.utils.listenTo(window,"resize",function(event,context){var event=new Event("layoutChange");window.dispatchEvent(event)},this.runtime.eventListeners,this),this.utils.listenTo(window,"orientationchange",function(event,context){var event=new Event("layoutChange");window.dispatchEvent(event)},this.runtime.eventListeners,this),this.utils.listenTo(window,"layoutChange",function(event,context){context.optimizeRedraws("on"),-1!==context.runtime.resizeTimer&&clearTimeout(context.runtime.resizeTimer),context.runtime.resizeTimer=window.setTimeout(function(context){"undefined"!=typeof context&&(context.deselectTile(),context.metricsUpdate(),context.refresh(),context.optimizeRedraws("off"))},500,context)},this.runtime.eventListeners,this)},game.isTile=function(tile){"use strict";if(null===tile||void 0===tile)return!1;switch(typeof tile){case"object":if(tile.id.indexOf(this.config.labels.TILE_PREFIX)<0)return!1;break;case"string":if(tile=this.runtime.tiles[tile],"undefined"==typeof tile)return!1;if(tile.id.indexOf(this.config.labels.TILE_PREFIX)<0)return!1;break;default:return!1}return tile},game.loadGame=function(type){"use strict";if(!this.config.useLstorage)return!1;"undefined"==typeof type&&(type=this.config.labels.AUTOSAVE_LABEL);var tileID,loadedGames=JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL)),loadedGame=null;if(null!==loadedGames){if("undefined"!=typeof loadedGames[type]&&null!==loadedGames[type]){if(loadedGame=loadedGames[type],loadedGame.saveDate=new Date(Date.UTC.apply(this,loadedGame.saveDate.match(/\d+\.{0,1}\d+/g))),loadedGame.startedDate&&(loadedGame.startedDate=new Date(Date.UTC.apply(this,loadedGame.startedDate.match(/\d+\.{0,1}\d+/g)))),loadedGame.size!==this.config.size.n)return console.log("cannot load game: different sizes:",loadedGame.size,this.config.size.n),!1;this.runtime.tiles=loadedGame.tiles;for(var i=0;i<this.config.size.n;i++)tileID=this.config.labels.TILE_PREFIX+i,loadedGame.tiles[tileID].htmlElement=document.getElementById(tileID);return this.runtime.started=loadedGame.startedDate,this.runtime.movesCount=parseInt(loadedGame.movesCount),this.refresh({transitions:"user"===type}),console.log("game loaded"),!0}return console.log("cannot find saved game '"+type+"'"),!1}return console.log("cannot find any saved game"),!1},game.metricsUpdate=function(){"use strict";this.metrics=this.metrics||{};var wrapperHTML=document.getElementById(this.config.labels.WRAPPER_ID),gameHTML=document.getElementById(this.config.labels.GAME_ID),wrapperWidth=wrapperHTML.offsetWidth,wrapperHeight=wrapperHTML.offsetHeight,cssPrefix="#"+this.config.labels.BOARD_ID;this.metrics.transforms3Dsupport=this.config.use3Dtransforms?["3d",",0"]:["",""],this.metrics.wrapperOrientation=wrapperWidth>=wrapperHeight?this.config.labels.LANDSCAPE:this.config.labels.PORTRAIT,this.metrics.wrapperRatio=wrapperWidth/wrapperHeight,this.metrics.pixelRatio=window.devicePixelRatio>1?window.devicePixelRatio:1,"undefined"==typeof this.metrics.wrapperSize&&(this.metrics.wrapperSize={}),this.metrics.wrapperSize[this.metrics.wrapperOrientation]={width:wrapperWidth,height:wrapperHeight},this.metrics.boardLayout=this.config.size.h>=this.config.size.v?this.config.labels.LANDSCAPE:this.config.labels.PORTRAIT,this.metrics.boardRatio=this.config.size.h/this.config.size.v,this.metrics.fontSize=parseInt((document.body.currentStyle||window.getComputedStyle&&getComputedStyle(document.body,null)||document.body.style).fontSize),this.metrics.marginH={percent:this.config.margin.h,pixels:0},this.metrics.marginV={percent:this.config.margin.v,pixels:0},this.metrics.borderSize={percent:this.config.borderSize,pixels:0},this.metrics.wrapperOrientation===this.config.labels.LANDSCAPE?(this.metrics.height=this.utils.roundTo(wrapperHeight/100*(100-2*this.config.borderSize-2*this.metrics.marginV.percent),this.config.size.h),this.metrics.width=this.metrics.height,this.metrics.borderSize.pixels=Math.round(wrapperHeight/100*this.config.borderSize),this.metrics.marginH.pixels=Math.round(wrapperHeight/100*this.metrics.marginH.percent),this.metrics.marginV.pixels=Math.round(wrapperHeight/100*this.metrics.marginV.percent),this.metrics.left=Math.round((wrapperWidth-this.metrics.width-this.metrics.borderSize.pixels-this.metrics.marginH.pixels)/2),this.metrics.top=Math.round((this.metrics.wrapperSize[this.metrics.wrapperOrientation].height-this.metrics.height-this.metrics.borderSize.pixels-this.metrics.marginV.pixels)/2)):(this.metrics.width=this.utils.roundTo(wrapperWidth/100*(100-2*this.config.borderSize-2*this.metrics.marginH.percent),this.config.size.v),this.metrics.height=this.metrics.width,this.metrics.borderSize.pixels=Math.round(wrapperWidth/100*this.config.borderSize),this.metrics.marginH.pixels=Math.round(wrapperWidth/100*this.metrics.marginH.percent),this.metrics.marginV.pixels=Math.round(wrapperWidth/100*this.metrics.marginV.percent),this.metrics.left=Math.round((wrapperWidth-this.metrics.width-this.metrics.borderSize.pixels-this.metrics.marginH.pixels)/2),this.metrics.top=Math.round((this.metrics.wrapperSize[this.metrics.wrapperOrientation].height-this.metrics.height-this.metrics.borderSize.pixels-this.metrics.marginV.pixels)/2)),this.metrics.tileWidth=Math.round(this.metrics.width/this.config.size.h),this.metrics.tileHeight=Math.round(this.metrics.height/this.config.size.v);var CSSstyleDeclaration="padding:"+Math.round(this.metrics.borderSize.pixels)+"px;width:"+this.metrics.width+"px; height:"+this.metrics.height+"px; left:"+this.metrics.left+"px; top:"+this.metrics.top+"px; ";if("undefined"!=typeof game.runtime.backgroundImage){var rgb=game.runtime.backgroundImage.averageRGB_brighter;"object"==typeof rgb&&(CSSstyleDeclaration+="background-color: rgb("+rgb.r+","+rgb.g+","+rgb.b+");")}gameHTML.style.cssText=CSSstyleDeclaration,document.getElementById(this.config.labels.GAME_ID).style.fontSize=""+document.getElementById(this.config.labels.BOARD_ID).offsetHeight/this.config.size.v/2+"px";var tileWpc=100/this.config.size.h+"%",tileHpc=100/this.config.size.v+"%";null===this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_CLASS)?this.utils.createCSSClass(cssPrefix+" ."+this.config.labels.TILE_CLASS,"width: "+tileWpc+"; height: "+tileHpc+";"):(this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_CLASS,"width",tileWpc),this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_CLASS,"height",tileHpc));var bgSize="auto "+this.metrics.height+"px";null===this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_INNER_CLASS)?this.utils.createCSSClass(cssPrefix+"."+this.config.labels.TILE_INNER_CLASS,"background-size: "+bgSize+";"):this.utils.editCSSRule(cssPrefix+" ."+this.config.labels.TILE_INNER_CLASS,"backgroundSize",bgSize)},game.moveAnyTile=function(params){"use strict";for(var tiles=params.pushing===!0?this.getMovableTiles({pushing:!1,moving:!0,direction:params.direction}).concat(this.getMovableTiles({pushing:!0,moving:!1,direction:params.direction}).sort(function(t1,t2){return t1.canPush.n-t2.canPush.n})):this.getMovableTiles({pushing:!1,moving:!0,direction:params.direction}),i=0;i<tiles.length;i++)this.moveTile(tiles[i],{transitions:!1,force:!1,refresh:!1});return this.refresh({transitionDuration:this.config.transitionDuration.byKeyboard}),tiles},game.moveTile=function(tile,params){"use strict";if(tile=this.isTile(tile),!tile)return!1;params=params||{force:!1,refresh:!0};var hole=this.runtime.tiles[this.config.labels.TILE_PREFIX+this.config.labels.HOLE_INDEX],temp={};if(!this.canMove(tile))return!1;if(params.force!==!0){if(!this.runtime.running)return!1;this.countMove()}return temp.col=tile.col,temp.row=tile.row,tile.col=hole.col,tile.row=hole.row,hole.col=temp.col,hole.row=temp.row,params.refresh===!0&&this.refresh({transitions:params.transitions,saveGame:!params.force,redraw:!params.force}),!0},game.newGame=function(){"use strict";var animationDuration=2e3;this.runtime.running?(console.log("user reset"),this.stop(),setTimeout(function(context){context.loadGame(context.config.labels.SORTEDSAVE_LABEL),context.refresh({transitions:!1}),context.saveGame(context.config.labels.SORTEDSAVE_LABEL)},.34*animationDuration,this),this.animate({element:document.getElementById(this.config.labels.GAME_ID),animation:"resetboard",duration:animationDuration,easing:"ease-in-out"})):(console.log("first launch"),this.refresh({transitions:!1}),this.saveGame(this.config.labels.SORTEDSAVE_LABEL),this.animate({element:document.getElementById(this.config.labels.GAME_ID),animation:"intro",duration:animationDuration})),setTimeout(function(context){context.shuffle(context.config.size.n*context.config.size.n),context.saveGame(context.config.labels.SHUFFLEDSAVE_LABEL),context.start()},.85*animationDuration,this)},game.optimizeRedraws=function(state){"use strict";var elements=[this.config.labels.WRAPPER_ID,this.config.labels.BACKGROUND_CONTAINER_ID,this.config.labels.GAME_ID],i=0;if("on"==state)for(console.log("hiding elements during layout change..."),i=0;i<elements.length;i++)document.getElementById(elements[i]).style.visibility="hidden";else for(console.log("...showing back again elements after layout change"),i=0;i<elements.length;i++)document.getElementById(elements[i]).style.visibility="visible"},game.refresh=function(params){"use strict";var tileID,tile,CSSstyleDeclaration="",win=!0;"undefined"==typeof params&&(params={transitions:!0,saveGame:!1}),params.transitions===!1?params.transitionDuration=0:"number"!=typeof params.transitionDuration&&(params.transitionDuration=this.config.transitionDuration.generic),console.log("refresh",params),game.runtime.movingTiles={};for(var i=0;i<this.config.size.n;i++){tileID=this.config.labels.TILE_PREFIX+i,tile=this.runtime.tiles[tileID];for(var prefix="",p=0;p<this.config.browserPrefixes.css.length;p++)prefix=this.config.browserPrefixes.css[p],CSSstyleDeclaration+=prefix+"transform:translate"+this.metrics.transforms3Dsupport[0]+"("+100*tile.col+"%,"+100*tile.row+"%"+this.metrics.transforms3Dsupport[1]+"); ",CSSstyleDeclaration+=prefix+"transition-property:"+prefix+"transform;",CSSstyleDeclaration+=prefix+"transition-duration:"+parseInt(Math.abs(params.transitionDuration))+"ms !important;",CSSstyleDeclaration+=prefix+"transition-timing-function:"+this.config.easings.EASING_TILES_MOVEMENT+";";params.redraw!==!1&&(tile.htmlElement.style.cssText=CSSstyleDeclaration),tile.htmlElement.childNodes[0].style.backgroundPosition="-"+tile.correctCol*this.metrics.tileWidth+"px -"+tile.correctRow*this.metrics.tileHeight+"px",tile.canMove=this.canMove(tileID),tile.canPush=this.canPush(tileID),tile.offse=void 0,tile.newPosition=void 0,tile.oldPosition=void 0,tile.timeStamp=void 0,tile.revert=void 0,tile.max=void 0,(tile.correctCol!==tile.col||tile.correctRow!==tile.row)&&(win=!1)}this.runtime.running&&win&&(setTimeout(function(){window.alert("Hai vinto!")},500),this.stop(),this.newGame()),params.saveGame===!0&&this.saveGame()},game.addMovingTile=function(tileObj,cssString){"use strict";return"object"!=typeof this.runtime.movingTiles&&(this.runtime.movingTiles={}),this.runtime.movingTiles[tileObj.id]=cssString,this.runtime.movingTiles},game.renderMovingTiles=function(){var movingTiles=game.runtime.movingTiles;for(tileId in movingTiles)movingTiles[tileId]&&(console.log("--- moving "+tileId),game.runtime.tiles[tileId].htmlElement.style.cssText=movingTiles[tileId]);return game.runtime.movingTiles={},game.runtime.movingTiles},game.saveGame=function(type){"use strict";if(!this.config.useLstorage)return!1;if(this.runtime.ended!==!1)return!1;"undefined"==typeof type&&(type=this.config.labels.AUTOSAVE_LABEL);var tileID,savedGames={},savedGame={saveDate:(new Date).toUTCString(),type:type,size:this.config.size.n,tiles:{},movesCount:this.runtime.movesCount};null!=JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL))&&(savedGames=JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL))),this.runtime.started&&(savedGame.startedDate=this.runtime.started.toUTCString());for(var i=0;i<this.config.size.n;i++)tileID=this.config.labels.TILE_PREFIX+i,savedGame.tiles[tileID]=this.utils.cloneObj(this.runtime.tiles[tileID]);savedGames[type]=savedGame,localStorage.setItem(this.config.labels.SAVEDGAMES_LABEL,JSON.stringify(savedGames)),console.log("game saved ("+type+")")},game.selectTile=function(tile,event){"use strict";if(!this.runtime.running)return!1;if(tile=this.isTile(tile),!tile)return!1;var direction=this.config.pushMultiple&&tile.canPush?tile.canPush.direction:tile.canMove;if(this.runtime.selectedTile=tile,this.canMove(tile)||this.config.pushMultiple){switch(this.runtime.selectedTile.timeStamp="undefined"!=typeof event?event.timeStamp:new Date,this.runtime.selectedTile.oldPosition={left:{percent:100*tile.col,pixels:this.metrics.tileWidth*tile.col},top:{percent:100*tile.row,pixels:this.metrics.tileHeight*tile.row}},this.runtime.selectedTile.offset="undefined"!=typeof event?{top:(event.pageY-this.metrics.top-this.metrics.borderSize.pixels)%this.metrics.tileHeight,left:(event.pageX-this.metrics.left-this.metrics.borderSize.pixels)%this.metrics.tileWidth}:{top:this.metrics.tileHeight/2,left:this.metrics.tileWidth/2},this.runtime.selectedTile.newPosition={top:{min:{pixels:null,percent:null},newValue:{pixels:null,percent:null},max:{pixels:null,percent:null}},left:{min:{pixels:null,percent:null},newValue:{pixels:null,percent:null},max:{pixels:null,percent:null}}},direction){case this.config.labels.UP:this.runtime.selectedTile.newPosition.top.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels-this.metrics.tileHeight),this.runtime.selectedTile.newPosition.top.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels),this.runtime.selectedTile.newPosition.left.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels),this.runtime.selectedTile.newPosition.left.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels);break;case this.config.labels.DOWN:this.runtime.selectedTile.newPosition.top.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels),this.runtime.selectedTile.newPosition.top.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels+this.metrics.tileHeight),this.runtime.selectedTile.newPosition.left.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels),this.runtime.selectedTile.newPosition.left.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels);break;case this.config.labels.LEFT:this.runtime.selectedTile.newPosition.left.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels-this.metrics.tileWidth),this.runtime.selectedTile.newPosition.left.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels),this.runtime.selectedTile.newPosition.top.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels),this.runtime.selectedTile.newPosition.top.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels);break;case this.config.labels.RIGHT:this.runtime.selectedTile.newPosition.left.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels),this.runtime.selectedTile.newPosition.left.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.left.pixels+this.metrics.tileWidth),this.runtime.selectedTile.newPosition.top.min.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels),this.runtime.selectedTile.newPosition.top.max.pixels=Math.round(this.runtime.selectedTile.oldPosition.top.pixels)}if(this.runtime.dragging||this.utils.addClass(tile.htmlElement,this.config.labels.PRESSED_LABEL+" "+this.config.labels.SELECTED_LABEL),tile.canPush!==!1&&this.config.pushMultiple){tile.canPush.tiles=[];for(var i=1;i<=tile.canPush.n;i++){switch(tile.canPush.direction){case this.config.labels.UP:tile.canPush.tiles.push(this.getTile({col:tile.col,row:tile.row-i}));break;case this.config.labels.RIGHT:tile.canPush.tiles.push(this.getTile({col:tile.col+i,row:tile.row}));break;case this.config.labels.DOWN:tile.canPush.tiles.push(this.getTile({col:tile.col,row:tile.row+i}));break;case this.config.labels.LEFT:tile.canPush.tiles.push(this.getTile({col:tile.col-i,row:tile.row}))}tile.canPush.tiles[i-1].max=null}}this.vibrate("select"),(tile.canMove||tile.canPush)&&(this.runtime.dragging=!0)}},game.getClosestColor=getClosestColor,game.setBgImage=function(params){"use strict";if(!document.createElement||"string"!=typeof params.imgUrl)return!1;var img=document.getElementById(this.config.labels.BACKGROUND_IMAGE_ID)||document.createElement("img");return console.log("loading image "+params.imgUrl+"..."),img.crossOrigin="",img.src=params.imgUrl,img.crossOrigin="",img.id=this.config.labels.BACKGROUND_IMAGE_ID,this.utils.listenTo(img,"load",function(event,context){console.log("background image loading complete",img),context.applyBgImage(event.target)},this.runtime.eventListeners,this),!0},game.applyBgImage=function(img){"use strict";var i,tileName,tile,averageRGB;this.runtime.backgroundImage=this.runtime.backgroundImage||{},this.runtime.backgroundImage.src=img.src;for(tileName in this.runtime.tiles)for(tile=this.getTile(tileName).htmlElement,i=0;i<tile.childNodes.length;i++)if(tile.childNodes[i].className===this.config.labels.TILE_INNER_CLASS){tile.childNodes[i].style.backgroundImage="url("+img.src+")";break}document.getElementById(this.config.labels.BACKGROUND_CONTAINER_ID).appendChild(img),averageRGB=this.utils.getAverageRGB(img),console.log("The average color for this image is ",averageRGB),this.applyBgColor(averageRGB),this.utils.stopListeningTo(img,"load",this.runtime.eventListeners)},game.adjustColor=function(rgb,mode,amount){"use strict";function limit(n,min,max){return n=Math.round(n),min>n?min:n>max?max:n}if("undefined"==typeof rgb)return console.log("which color?"),!1;switch("number"!=typeof amount&&(amount=.25),mode){case"brighter":return{r:limit(rgb.r*(1+amount),0,255),g:limit(rgb.g*(1+amount),0,255),b:limit(rgb.b*(1+amount),0,255)};case"darker":return{r:limit(rgb.r*(1-amount),0,255),g:limit(rgb.g*(1-amount),0,255),b:limit(rgb.b*(1-amount),0,255)};default:return console.log("color not changed",rgb),rgb}},game.applyBgColor=function(rgb){"use strict";var rgbVal="rgb("+rgb.r+","+rgb.g+","+rgb.b+")",hexVal="#"+rgb.r.toString(16)+rgb.g.toString(16)+rgb.b.toString(16),rgbDark=this.adjustColor(rgb,"darker",.65),rgbDarkVal="rgb("+rgbDark.r+","+rgbDark.g+","+rgbDark.b+")",hexDarkVal="#"+rgbDark.r.toString(16)+rgbDark.g.toString(16)+rgbDark.b.toString(16),rgbBright=this.adjustColor(rgb,"brighter",.2),rgbBrightVal="rgb("+rgbBright.r+","+rgbBright.g+","+rgbBright.b+")",hexBrightVal="#"+rgbBright.r.toString(16)+rgbBright.g.toString(16)+rgbBright.b.toString(16);this.runtime.backgroundImage=this.runtime.backgroundImage||{},this.runtime.backgroundImage.averageRGB=rgbVal,this.runtime.backgroundImage.averageRGB_darker=rgbDarkVal,this.runtime.backgroundImage.averageRGB_brighter=rgbBrightVal,this.runtime.backgroundImage.averageHEX=hexVal,this.runtime.backgroundImage.averageHEX_darker=hexDarkVal,this.runtime.backgroundImage.averageHEX_brighter=hexBrightVal,this.runtime.backgroundImage.blackish="#000"==getClosestColor(hexVal,["#000","#FFF"]),this.runtime.backgroundImage.whiteish=!this.runtime.backgroundImage.blackish,document.getElementById(this.config.labels.BACKGROUND_CONTAINER_ID).style.backgroundColor=rgbVal,document.getElementById(this.config.labels.GAME_ID).style.backgroundColor=hexBrightVal;var currentBoxShadow=this.utils.editCSSRule("#"+this.config.labels.BOARD_ID+" ."+this.config.labels.TILE_INNER_CLASS,"boxShadow");if(currentBoxShadow){for(var boxShadowProps=currentBoxShadow.replace(/,\s+/g,",").split(" "),i=0;i<boxShadowProps.length;i++){(boxShadowProps[i].indexOf("rgb")>-1||boxShadowProps[i].indexOf("#")>-1)&&(boxShadowProps[i]=rgbDarkVal);break}this.utils.editCSSRule("#"+this.config.labels.BOARD_ID+" ."+this.config.labels.TILE_INNER_CLASS,"boxShadow",boxShadowProps.join(" ")),document.getElementById(this.config.labels.BOARD_ID).style.backgroundColor=hexDarkVal}},game.shuffle=function(n,refresh){"use strict";console.log("shuffle"),this.vibrate("shuffle"),"undefined"==typeof n&&(n=10*this.config.size.n),"undefined"==typeof refresh&&(refresh=!0);for(var d,directions=[this.config.labels.UP,this.config.labels.RIGHT,this.config.labels.DOWN,this.config.labels.LEFT],movableTiles=[],i=0;n>i;i++)d=directions[Math.round(Math.random()*(directions.length-1))],movableTiles=this.getMovableTiles({direction:d,pushing:!1,moving:!0,force:!0}),this.moveTile(movableTiles[0],{transitions:!1,force:!0,refresh:!0});refresh&&this.refresh({transitions:!0,transitionDuration:100})},game.start=function(){"use strict";this.runtime.started=new Date,this.runtime.ended=!1,this.runtime.running=!0,this.runtime.movesCount=0,console.log("game started")},game.stop=function(){"use strict";this.runtime.ended=new Date,this.runtime.running=!1,console.log("game stopped")},game.vibrate=function(reasonToVibrate){"use strict";return!1};
//# sourceMappingURL=app.min.js.map