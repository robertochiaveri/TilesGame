{"version":3,"sources":["../../src/js/methods/ajaxCall.js","../../src/js/app.js","modernizr-custom.js","../../src/js/plugins/safeConsole.js","../../src/js/utils/addClass.js","../../src/js/utils/checkBrowser.js","../../src/js/utils/cloneObj.js","../../src/js/utils/createCSSClass.js","../../src/js/utils/detectFullscreen.js","../../src/js/utils/editCSSRule.js","../../src/js/utils/getAverageRGB.js","../../src/js/utils/getBrowserPrefix.js","../../src/js/utils/hasClass.js","../../src/js/utils/listenTo.js","../../src/js/utils/removeClass.js","../../src/js/utils/roundTo.js","../../src/js/utils/stopListeningTo.js","../../src/js/utils/trim.js","../../src/js/config.js","../../src/js/config/easings.js","../../src/js/config/keyCodes.js","../../src/js/config/labels.js","../../src/js/config/toolbarButtons.js","../../src/js/methods/animate.js","../../src/js/methods/canMove.js","../../src/js/methods/canPush.js","../../src/js/methods/checkFeatures.js","../../src/js/methods/countMove.js","../../src/js/methods/createBoard.js","../../src/js/methods/deselectTile.js","../../src/js/methods/dragTile.js","../../src/js/methods/getMovableTiles.js","../../src/js/methods/getTile.js","../../src/js/methods/init.js","../../src/js/methods/initListeners.js","../../src/js/methods/isTile.js","../../src/js/methods/loadGame.js","../../src/js/methods/metricsUpdate.js","../../src/js/methods/moveAnyTile.js","../../src/js/methods/moveTile.js","../../src/js/methods/newGame.js","../../src/js/methods/optimizeRedraws.js","../../src/js/methods/refresh.js","../../src/js/methods/saveGame.js","../../src/js/methods/selectTile.js","../../src/js/methods/setBg.js","../../src/js/methods/shuffle.js","../../src/js/methods/start.js","../../src/js/methods/stop.js","../../src/js/methods/vibrate.js"],"names":["jsonpCall","url","callback","callbackName","Math","round","random","window","data","document","body","removeChild","jsonpCallScript","createElement","src","indexOf","appendChild","game","utils","config","metrics","Modernizr","e","t","n","C","f","cssText","L","A","O","r","i","M","s","bind","_","charAt","toUpperCase","slice","d","join","split","v","E","N","o","documentElement","u","a","style","h","p","toLowerCase","m","b","w","S","l","c","parseInt","id","innerHTML","background","overflow","parentNode","x","matchMedia","msMatchMedia","matches","getComputedStyle","currentStyle","T","hasOwnProperty","call","constructor","prototype","Function","this","TypeError","arguments","apply","concat","Object","touch","DocumentTouch","offsetTop","cssanimations","csstransforms3d","offsetLeft","offsetHeight","csstransitions","localstorage","localStorage","setItem","removeItem","D","push","addTest","className","_version","_prefixes","_domPrefixes","_cssomPrefixes","mq","testProp","testAllProps","testStyles","replace","method","noop","methods","length","console","addClass","element","cls","checkBrowser","test","navigator","userAgent","parseFloat","appVersion","cloneObj","obj","copy","attr","createCSSClass","selector","styleSheets","getElementsByTagName","styleSheet","mediaType","media","disabled","mediaText","styleSheetElement","type","rules","selectorText","addRule","cssRules","insertRule","detectFullscreen","standalone","editCSSRule","ruleClass","property","newValue","sheet","getAverageRGB","img","imageData","canvas","ctx","getContext","width","naturalWidth","height","naturalHeight","defaultRGB","g","drawImage","getImageData","log","floor","getBrowserPrefix","styles","pre","Array","match","OLink","dom","RegExp","lowercase","css","js","substr","hasClass","listenTo","eventType","fn","listenersList","context","addEventListener","event","preventDefault","touches","timeStamp","multiTouchEvent","attachEvent","removeClass","regexp","roundTo","input","num","resto","stopListeningTo","removeEventListener","undefined","trim","str","ws","size","margin","borderSize","pushMultiple","minDistanceToMoveTile","clickToMove","maxTimeForClickMove","touchTolerance","transitionDuration","generic","byKeyboard","useKeyboard","easings","EASING_TILES_MOVEMENT","keycodes","KEY_ARROW_LEFT","KEY_ARROW_UP","KEY_ARROW_RIGHT","KEY_ARROW_DOWN","KEY_ESCAPE","KEY_RETURN","labels","WRAPPER_ID","GAME_ID","BOARD_ID","TOOLBAR_ID","BACKGROUND_CONTAINER_ID","BACKGROUND_IMAGE_ID","TILE_PREFIX","TILE_CLASS","TILE_INNER_CLASS","TILE_NUMBER_CLASS","TBUTTON_PREFIX","SELECTED_LABEL","PRESSED_LABEL","ANIMATED_LABEL","USETOUCH_LABEL","NO_TOUCH_LABEL","UP","RIGHT","DOWN","LEFT","LANDSCAPE","PORTRAIT","SAVEDGAMES_LABEL","AUTOSAVE_LABEL","USERSAVE_LABEL","SORTEDSAVE_LABEL","SHUFFLEDSAVE_LABEL","toolbarButtons","description","handler","confirm","newGame","saveGame","getElementById","loadGame","animate","animation","duration","ajaxCall","xmlhttp","XMLHttpRequest","onreadystatechange","status","readyState","responseText","open","send","params","CSSstyleDeclaration","prefix","browserPrefixes","iterations","iteration","delay","easing","runtime","eventListeners","target","canMove","tile","isTile","hole","tiles","HOLE_INDEX","holePosition","col","row","canPush","tilesToPush","pushableTiles","abs","direction","checkFeatures","browserOK","useTouch","useCSStransitions","use3Dtransforms","useLstorage","useVibration","useCssAnimations","launchedAsApp","countMove","movesCount","createBoard","boardHTML","setAttribute","correctCol","correctRow","even","evenCol","evenRow","htmlElement","deselectTile","selectedTile","tilesMoved","dragging","vibrate","newPosition","left","pixels","revert","moveTile","transitions","force","refresh","oldPosition","tileWidth","top","tileHeight","dragTile","running","newPosX","newPosY","otherTile","otherTileNewPos","offset","pageX","pageY","min","max","percent","transforms3Dsupport","getMovableTiles","pushing","moving","movableTiles","getTile","param","maxLevels","srcElement","isNaN","elementFromPoint","init","started","ended","timePlaying","resizeTimer","latestSelection","metricsUpdate","initListeners","start","setBgImage","imgUrl","selectTile","from","relatedTarget","toElement","nodeName","which","moveAnyTile","ctrlKey","optimizeRedraws","clearTimeout","setTimeout","tileID","loadedGames","JSON","parse","getItem","loadedGame","saveDate","Date","UTC","startedDate","wrapperHTML","gameHTML","wrapperWidth","offsetWidth","wrapperHeight","cssPrefix","wrapperOrientation","wrapperRatio","pixelRatio","devicePixelRatio","wrapperSize","boardLayout","boardRatio","fontSize","marginH","marginV","backgroundImage","rgb","averageRGB_brighter","tileWpc","tileHpc","bgSize","sort","t1","t2","temp","redraw","animationDuration","stop","shuffle","state","elements","visibility","win","childNodes","backgroundPosition","offse","alert","savedGames","savedGame","toUTCString","stringify","crossOrigin","applyBgImage","tileName","averageRGB","applyBgColor","adjustColor","mode","amount","limit","rgbVal","rgbDark","rgbDarkVal","rgbBright","rgbBrightVal","averageRGB_darker","backgroundColor","currentBoxShadow","boxShadowProps","directions","reasonToVibrate"],"mappings":"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","file":"app.min.js","sourcesContent":["game.ajaxCall = function(url) {\r\n  \"use strict\";\r\n\r\n  var xmlhttp;\r\n  if (window.XMLHttpRequest) {\r\n    xmlhttp = new XMLHttpRequest();\r\n  } else {\r\n    return false;\r\n  }\r\n\r\n  xmlhttp.onreadystatechange = function() {\r\n\r\n    console.log(xmlhttp.status);\r\n\r\n    if (xmlhttp.readyState === 4 && xmlhttp.status === 200) {\r\n      console.log(xmlhttp.responseText);\r\n    }\r\n\r\n  };\r\n\r\n  xmlhttp.open(\"GET\", url, true);\r\n  xmlhttp.send();\r\n\r\n\r\n};\r\n\r\n\r\nfunction jsonpCall(url, callback) {\r\n\r\n  \"use strict\";\r\n\r\n  var callbackName = \"jsonp_callback_\" + Math.round(100000 * Math.random());\r\n\r\n  window[callbackName] = function(data) {\r\n    delete window[callbackName];\r\n    document.body.removeChild(jsonpCallScript);\r\n    callback(data);\r\n  };\r\n\r\n  var jsonpCallScript = document.createElement(\"script\");\r\n  jsonpCallScript.src = url + (url.indexOf(\"?\") >= 0 ? \"&\" : \"?\") + \"callback=\" + callbackName;\r\n  document.body.appendChild(jsonpCallScript);\r\n}\r\n","var game = {\r\n  utils: {},\r\n  config: {},\r\n  metrics: {}\r\n};\r\n","/* Modernizr (Custom Build) | MIT & BSD\n * Build: http://modernizr.com/download/#-mq-cssclasses-csstransforms3d-cssanimations-csstransitions-touch-localstorage\n */\n;window.Modernizr=function(e,t,n){function C(e){f.cssText=e}function k(e,t){return C(h.join(e+\";\")+(t||\"\"))}function L(e,t){return typeof e===t}function A(e,t){return!!~(\"\"+e).indexOf(t)}function O(e,t){for(var r in e){var i=e[r];if(!A(i,\"-\")&&f[i]!==n)return t==\"pfx\"?i:!0}return!1}function M(e,t,r){for(var i in e){var s=t[e[i]];if(s!==n)return r===!1?e[i]:L(s,\"function\")?s.bind(r||t):s}return!1}function _(e,t,n){var r=e.charAt(0).toUpperCase()+e.slice(1),i=(e+\" \"+d.join(r+\" \")+r).split(\" \");return L(t,\"string\")||L(t,\"undefined\")?O(i,t):(i=(e+\" \"+v.join(r+\" \")+r).split(\" \"),M(i,t,n))}var r=\"2.8.3\",i={},s=!0,o=t.documentElement,u=\"modernizr\",a=t.createElement(u),f=a.style,l,c={}.toString,h=\" -webkit- -moz- -o- -ms- \".split(\" \"),p=\"Webkit Moz O ms\",d=p.split(\" \"),v=p.toLowerCase().split(\" \"),m={},g={},y={},b=[],w=b.slice,E,S=function(e,n,r,i){var s,a,f,l,c=t.createElement(\"div\"),h=t.body,p=h||t.createElement(\"body\");if(parseInt(r,10))while(r--)f=t.createElement(\"div\"),f.id=i?i[r]:u+(r+1),c.appendChild(f);return s=[\"&#173;\",'<style id=\"s',u,'\">',e,\"</style>\"].join(\"\"),c.id=u,(h?c:p).innerHTML+=s,p.appendChild(c),h||(p.style.background=\"\",p.style.overflow=\"hidden\",l=o.style.overflow,o.style.overflow=\"hidden\",o.appendChild(p)),a=n(c,e),h?c.parentNode.removeChild(c):(p.parentNode.removeChild(p),o.style.overflow=l),!!a},x=function(t){var n=e.matchMedia||e.msMatchMedia;if(n)return n(t)&&n(t).matches||!1;var r;return S(\"@media \"+t+\" { #\"+u+\" { position: absolute; } }\",function(t){r=(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle)[\"position\"]==\"absolute\"}),r},T={}.hasOwnProperty,N;!L(T,\"undefined\")&&!L(T.call,\"undefined\")?N=function(e,t){return T.call(e,t)}:N=function(e,t){return t in e&&L(e.constructor.prototype[t],\"undefined\")},Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;if(typeof n!=\"function\")throw new TypeError;var r=w.call(arguments,1),i=function(){if(this instanceof i){var e=function(){};e.prototype=n.prototype;var s=new e,o=n.apply(s,r.concat(w.call(arguments)));return Object(o)===o?o:s}return n.apply(t,r.concat(w.call(arguments)))};return i}),m.touch=function(){var n;return\"ontouchstart\"in e||e.DocumentTouch&&t instanceof DocumentTouch?n=!0:S([\"@media (\",h.join(\"touch-enabled),(\"),u,\")\",\"{#modernizr{top:9px;position:absolute}}\"].join(\"\"),function(e){n=e.offsetTop===9}),n},m.cssanimations=function(){return _(\"animationName\")},m.csstransforms3d=function(){var e=!!_(\"perspective\");return e&&\"webkitPerspective\"in o.style&&S(\"@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}\",function(t,n){e=t.offsetLeft===9&&t.offsetHeight===3}),e},m.csstransitions=function(){return _(\"transition\")},m.localstorage=function(){try{return localStorage.setItem(u,u),localStorage.removeItem(u),!0}catch(e){return!1}};for(var D in m)N(m,D)&&(E=D.toLowerCase(),i[E]=m[D](),b.push((i[E]?\"\":\"no-\")+E));return i.addTest=function(e,t){if(typeof e==\"object\")for(var r in e)N(e,r)&&i.addTest(r,e[r]);else{e=e.toLowerCase();if(i[e]!==n)return i;t=typeof t==\"function\"?t():t,typeof s!=\"undefined\"&&s&&(o.className+=\" \"+(t?\"\":\"no-\")+e),i[e]=t}return i},C(\"\"),a=l=null,i._version=r,i._prefixes=h,i._domPrefixes=v,i._cssomPrefixes=d,i.mq=x,i.testProp=function(e){return O([e])},i.testAllProps=_,i.testStyles=S,o.className=o.className.replace(/(^|\\s)no-js(\\s|$)/,\"$1$2\")+(s?' js '+b.join(' '):\"\"),i}(this,this.document);","// Avoid `console` errors in browsers that lack a console.\r\n(function() {\r\n  \"use strict\";\r\n  var method;\r\n  var noop = function() {};\r\n  var methods = [\r\n    'assert', 'clear', 'count', 'debug', 'dir', 'dirxml', 'error',\r\n    'exception', 'group', 'groupCollapsed', 'groupEnd', 'info', 'log',\r\n    'markTimeline', 'profile', 'profileEnd', 'table', 'time', 'timeEnd',\r\n    'timeStamp', 'trace', 'warn'\r\n  ];\r\n  var length = methods.length;\r\n  var console = (window.console = window.console || {});\r\n\r\n  while (length--) {\r\n    method = methods[length];\r\n\r\n    // Only stub undefined methods.\r\n    if (!console[method]) {\r\n      console[method] = noop;\r\n    }\r\n  }\r\n}());\r\n","game.utils.addClass = function(element, cls) {\r\n  \"use strict\";\r\n  if ((\" \" + element.className + \" \").indexOf(\" \" + cls + \" \") === -1) {\r\n    element.className = element.className + \" \" + cls;\r\n  }\r\n  return element.className.replace(/  +/g, \" \");\r\n};\r\n","game.utils.checkBrowser = function() {\r\n  return !(/MSIE\\s/.test(navigator.userAgent) && parseFloat(navigator.appVersion.split(\"MSIE\")[1]) < 11);\r\n}\r\n","game.utils.cloneObj = function(obj) {\r\n  \"use strict\";\r\n  if (null === obj || \"object\" !== typeof obj) return obj;\r\n  var copy = obj.constructor();\r\n  for (var attr in obj) {\r\n    if (obj.hasOwnProperty(attr) && attr !== \"htmlElement\") copy[\r\n      attr] = obj[attr];\r\n  }\r\n  return copy;\r\n};\r\n","game.utils.createCSSClass = function(selector, style) {\r\n  \"use strict\";\r\n  if (!document.styleSheets) {\r\n    return false;\r\n  }\r\n\r\n  if (document.getElementsByTagName(\"head\").length === 0) {\r\n    return false;\r\n  }\r\n\r\n  var styleSheet;\r\n  var mediaType;\r\n  var media;\r\n  var i;\r\n\r\n  if (document.styleSheets.length > 0) {\r\n    for (i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].disabled) {\r\n        continue;\r\n      }\r\n      media = document.styleSheets[i].media;\r\n      mediaType = typeof media;\r\n\r\n      if (mediaType === \"string\") {\r\n        if (media === \"\" || (media.indexOf(\"screen\") !== -1)) {\r\n          styleSheet = document.styleSheets[i];\r\n        }\r\n      } else if (mediaType === \"object\") {\r\n        if (media.mediaText === \"\" || (media.mediaText.indexOf(\"screen\") !== -1)) {\r\n          styleSheet = document.styleSheets[i];\r\n        }\r\n      }\r\n\r\n      if (typeof styleSheet !== \"undefined\") {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (typeof styleSheet === \"undefined\") {\r\n    var styleSheetElement = document.createElement(\"style\");\r\n    styleSheetElement.type = \"text/css\";\r\n\r\n    document.getElementsByTagName(\"head\")[0].appendChild(styleSheetElement);\r\n\r\n    for (i = 0; i < document.styleSheets.length; i++) {\r\n      if (document.styleSheets[i].disabled) {\r\n        continue;\r\n      }\r\n      styleSheet = document.styleSheets[i];\r\n    }\r\n\r\n    media = styleSheet.media;\r\n    mediaType = typeof media;\r\n  }\r\n\r\n  if (mediaType === \"string\") {\r\n    for (i = 0; i < styleSheet.rules.length; i++) {\r\n      if (styleSheet.rules[i].selectorText.toLowerCase() === selector.toLowerCase()) {\r\n        styleSheet.rules[i].style.cssText = style;\r\n        return;\r\n      }\r\n    }\r\n\r\n    styleSheet.addRule(selector, style);\r\n  } else if (mediaType === \"object\") {\r\n    for (i = 0; i < styleSheet.cssRules.length; i++) {\r\n      if (styleSheet.cssRules[i].selectorText.toLowerCase() === selector.toLowerCase()) {\r\n        styleSheet.cssRules[i].style.cssText = style;\r\n        return;\r\n      }\r\n    }\r\n\r\n    styleSheet.insertRule(selector + \"{\" + style + \"}\", 0);\r\n  }\r\n};\r\n","game.utils.detectFullscreen = function() {\r\n  \"use strict\";\r\n  if ((\"standalone\" in window.navigator) && window.navigator.standalone) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n","game.utils.editCSSRule = function(ruleClass, property, newValue) {\r\n\r\n  \"use strict\";\r\n\r\n  for (var s = 0; s < document.styleSheets.length; s++) {\r\n    var sheet = document.styleSheets[s];\r\n    var rules = sheet.cssRules ? sheet.cssRules : sheet.rules;\r\n\r\n    if (rules == null) return \"null\";\r\n\r\n    for (var i = 0; i < rules.length; i++) {\r\n      if (rules[i].selectorText === ruleClass) {\r\n        if (typeof newValue !== \"undefined\") {\r\n          return rules[i].style[property] = newValue;\r\n        } else {\r\n          return rules[i].style[property];\r\n        };\r\n\r\n      }\r\n    }\r\n\r\n  }\r\n  return null;\r\n};\r\n","game.utils.getAverageRGB = function(img) {\r\n  \"use strict\";\r\n\r\n  var canvas = document.createElement('canvas');\r\n  var ctx = canvas.getContext('2d');\r\n  var width = canvas.width = img.naturalWidth;\r\n  var height = canvas.height = img.naturalHeight;\r\n  var imageData, data;\r\n  var defaultRGB = {\r\n    r: 200,\r\n    g: 200,\r\n    b: 200\r\n  };\r\n\r\n  ctx.drawImage(img, 0, 0);\r\n\r\n  try {\r\n    imageData = ctx.getImageData(0, 0, width, height);\r\n  } catch (e) {\r\n    console.log(\"Problem parsing this image\", e);\r\n    return defaultRGB;\r\n  }\r\n\r\n  data = imageData.data;\r\n\r\n  var r = 0;\r\n  var g = 0;\r\n  var b = 0;\r\n\r\n  for (var i = 0, l = data.length; i < l; i += 4) {\r\n    r += data[i];\r\n    g += data[i + 1];\r\n    b += data[i + 2];\r\n  }\r\n\r\n  r = Math.floor(r / (data.length / 4));\r\n  g = Math.floor(g / (data.length / 4));\r\n  b = Math.floor(b / (data.length / 4));\r\n\r\n  return {\r\n    r: r,\r\n    g: g,\r\n    b: b\r\n  };\r\n\r\n};\r\n","game.utils.getBrowserPrefix = function() {\r\n  \"use strict\";\r\n  var styles = window.getComputedStyle(document.documentElement, \"\"),\r\n    pre = (Array.prototype.slice\r\n      .call(styles)\r\n      .join(\"\")\r\n      .match(/-(moz|webkit|ms)-/) || (styles.OLink === \"\" && [\"\", \"o\"])\r\n    )[1],\r\n    dom = (\"WebKit|Moz|MS|O\").match(new RegExp(\"(\" + pre + \")\", \"i\"))[1];\r\n  return {\r\n    dom: [dom],\r\n    lowercase: [pre],\r\n    css: [\"-\" + pre + \"-\"],\r\n    js: [pre[0].toUpperCase() + pre.substr(1)]\r\n  };\r\n};\r\n","game.utils.hasClass = function(element, cls) {\r\n  \"use strict\";\r\n  return (\" \" + element.className + \" \").indexOf(\" \" + cls + \" \") > -1;\r\n};\r\n","game.utils.listenTo = function(element, eventType, fn, listenersList, context) {\r\n  \"use strict\";\r\n\r\n  listenersList = listenersList || {};\r\n\r\n  if (!element) {\r\n    console.log(\"can't find this element: \" + element);\r\n    return false;\r\n  }\r\n\r\n  var id = element.id;\r\n\r\n  if (typeof id === \"undefined\" || id === \"\") {\r\n\r\n    if (element === document.body) {\r\n      id = \"body\";\r\n    } else if (element === document.documentElement) {\r\n      id = \"html\";\r\n    } else if (element === window) {\r\n      id = \"window\";\r\n    } else {\r\n      console.log(\"better not add a listener to elements witout id: \",\r\n        element);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  if (typeof listenersList[id] === \"undefined\") {\r\n    listenersList[id] = {};\r\n  };\r\n\r\n  if (typeof listenersList[id][eventType] !== \"undefined\") {\r\n    console.log(\"cannot add another listener for \" + eventType + \" to \",\r\n      element);\r\n    return false;\r\n  };\r\n\r\n  listenersList[id][eventType] = fn;\r\n\r\n\r\n  if (!element.addEventListener) {\r\n    element.attachEvent(\"on\" + eventType, fn);\r\n  } else if (element.addEventListener) {\r\n\r\n    if (eventType.indexOf(\"touch\") === 0) {\r\n      element.addEventListener(eventType, function(event) {\r\n        event.preventDefault();\r\n        if (event.touches.length === 0) //touchend\r\n        {\r\n          fn(event, context);\r\n        } else {\r\n          for (var i = 0; i < event.touches.length; i++) {\r\n            event.touches[i].timeStamp = event.timeStamp;\r\n            event.touches[i].type = event.type;\r\n            event.touches[i].multiTouchEvent = event;\r\n            fn(event.touches[i], context);\r\n          }\r\n        }\r\n        return;\r\n      }, true);\r\n    } else {\r\n      element.addEventListener(eventType, function(event) {\r\n        fn(event, context);\r\n      }, false);\r\n    }\r\n  }\r\n};\r\n","game.utils.removeClass = function(element, cls) {\r\n  \"use strict\";\r\n\r\n  var regexp = new RegExp(\"\\\\b\" + cls + \"\\\\b\", \"g\");\r\n  element.className = \" \" + element.className + \" \";\r\n  element.className = element.className.replace(regexp, \"\");\r\n\r\n  return element.className.replace(/  +/g, \" \");\r\n};\r\n","game.utils.roundTo = function(input, num) {\r\n  \"use strict\";\r\n  var resto = input % num;\r\n  if (resto <= (num / 2)) {\r\n    return input - resto;\r\n  } else {\r\n    return input + num - resto;\r\n  }\r\n};\r\n","game.utils.stopListeningTo = function(element, eventType, listenersList) {\r\n  \"use strict\";\r\n\r\n  if (typeof listenersList === \"undefined\") {\r\n    console.log(\"no registered listeners in \", listenersList);\r\n    return false;\r\n  };\r\n\r\n  var id = element.id;\r\n\r\n  if (typeof element.id === \"undefined\" || element.id === \"\") {\r\n\r\n    if (element === document.body) {\r\n      id = \"body\";\r\n    } else if (element === document.documentElement) {\r\n      id = \"html\";\r\n    } else if (element === window) {\r\n      id = \"window\";\r\n    } else {\r\n      console.log(\"better not add a listener to elements witout id: \",\r\n        element);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  if (typeof listenersList[id][eventType] !== \"undefined\") {\r\n    element.removeEventListener(eventType, listenersList[id][eventType]);\r\n    listenersList[id][eventType] = undefined;\r\n    // console.log(\"removed event listener for \" + eventType + \" from \" + id);\r\n    return true;\r\n  }\r\n\r\n\r\n  return false;\r\n\r\n};\r\n","game.utils.trim = function(str) {\r\n  \"use strict\";\r\n  str = str.replace(/^[\\s\\uFEFF\\xA0]+|[\\s\\uFEFF\\xA0]+$/g, \"\");\r\n  var ws = /\\s/;\r\n  var i = str.length;\r\n  while (ws.test(str.charAt(--i)));\r\n  return str.slice(0, i + 1);\r\n};\r\n","game.config = {\r\n\r\n  /*\r\n    size of the board, in tiles \r\n    (h for columns, v for rows)\r\n   */\r\n  size: {\r\n    h: 4,\r\n    v: 4\r\n  },\r\n\r\n  /*\r\n    minimum space btw the board and the screen, in %\r\n   */\r\n  margin: {\r\n    h: 4,\r\n    v: 4\r\n  },\r\n\r\n  /*\r\n    thickness of the border around the board, in %\r\n   */\r\n  borderSize: 4,\r\n\r\n  /*\r\n    when true tiles near the hole can be pushed by dragged tiles    \r\n   */\r\n  pushMultiple: true,\r\n\r\n\r\n  /*\r\n    move tolerance; the percent of a tile size after which \r\n    the tile snaps into the new position. If it's moved less than\r\n    this, the tile snaps back.\r\n   */\r\n  minDistanceToMoveTile: 0.25,\r\n\r\n\r\n  /* \r\n    allow move by click (touching and shortly releasing a tile \r\n    but not dragging it)\r\n  */\r\n\r\n  clickToMove: true,\r\n\r\n\r\n  /*\r\n    time in ms after which releasing a tile won't trigger a movement\r\n   */\r\n  maxTimeForClickMove: 200,\r\n\r\n\r\n  /*\r\n    touch tolerance area around the tile considered draggable \r\n    during touch drag before dropping\r\n   */\r\n  touchTolerance: 0.2,\r\n\r\n  /*\r\n    transitonDurations\r\n   */\r\n  transitionDuration: {\r\n\r\n    /* for tile movements on clicks, drags and gestures */\r\n    generic: 60,\r\n\r\n    /* for tile movement initiated by keyboard events*/\r\n    byKeyboard: 100\r\n  },\r\n\r\n  /*\r\n    listen to keyboard events during game\r\n   */\r\n  useKeyboard: true\r\n\r\n\r\n};\r\n","/*\r\n  a collection of easing functions\r\n */\r\ngame.config.easings = {\r\n  EASING_TILES_MOVEMENT: \"cubic-bezier(0.403, 0.543, 0.754, 1)\"\r\n};\r\n","/* keycodes abstractions */\r\ngame.config.keycodes = {\r\n  KEY_ARROW_LEFT: 37,\r\n  KEY_ARROW_UP: 38,\r\n  KEY_ARROW_RIGHT: 39,\r\n  KEY_ARROW_DOWN: 40,\r\n  KEY_ESCAPE: 2,\r\n  KEY_RETURN: 13\r\n};\r\n","/*\r\n  abstraction for IDs, CLASSES and so on\r\n */\r\ngame.config.labels = {\r\n\r\n  /* \r\n    id of the main wrapper of the page \r\n  */\r\n  WRAPPER_ID: \"game-wrapper\",\r\n\r\n  /* html id of the game container */\r\n  GAME_ID: \"game\",\r\n\r\n  /* id of the board*/\r\n  BOARD_ID: \"board\",\r\n\r\n  /* id of the toolbar */\r\n  TOOLBAR_ID: \"toolbar\",\r\n\r\n  /* id of the background image container */\r\n  BACKGROUND_CONTAINER_ID: \"bg\",\r\n\r\n  /* id of the background image element */\r\n  BACKGROUND_IMAGE_ID: \"bg-img\",\r\n\r\n  /* prefix for all tiles ids */\r\n  TILE_PREFIX: \"tile-\",\r\n\r\n  /* className for tile element */\r\n  TILE_CLASS: \"tile\",\r\n\r\n  /* className for tile inner wrapper */\r\n  TILE_INNER_CLASS: \"inner\",\r\n\r\n  /* className for tile number element*/\r\n  TILE_NUMBER_CLASS: \"number\",\r\n\r\n  /* prefix for all toolbar buttons ids */\r\n  TBUTTON_PREFIX: \"btn-\",\r\n\r\n  /* class added to a tile when is being dragged */\r\n  SELECTED_LABEL: \"selected\",\r\n\r\n  /* class added to a tile when is being pressed */\r\n  PRESSED_LABEL: \"pressed\",\r\n\r\n\r\n  /* class added to a tile when is being animated */\r\n  ANIMATED_LABEL: \"animationInProgress\",\r\n\r\n\r\n  /* class added to the game main div when touch enabled */\r\n  USETOUCH_LABEL: \"touch\",\r\n\r\n  /* class added to the game main div when touch disabled */\r\n  NO_TOUCH_LABEL: \"no-touch\",\r\n\r\n\r\n  /* Directions Abstraction */\r\n  UP: \"up\",\r\n  RIGHT: \"right\",\r\n  DOWN: \"down\",\r\n  LEFT: \"left\",\r\n\r\n  /* Orientations Abstraction */\r\n  LANDSCAPE: \"landscape\",\r\n  PORTRAIT: \"portrait\",\r\n\r\n  /* Saved games localStorage index */\r\n  SAVEDGAMES_LABEL: \"savedGames\",\r\n\r\n\r\n  /* Savegame modes */\r\n  AUTOSAVE_LABEL: \"automatic\",\r\n  USERSAVE_LABEL: \"user\",\r\n  SORTEDSAVE_LABEL: \"sorted\",\r\n  SHUFFLEDSAVE_LABEL: \"shuffled\"\r\n\r\n};\r\n","/* keycodes abstractions */\r\ngame.config.toolbarButtons = [{\r\n  id: \"new\",\r\n  description: \"New game\",\r\n  handler: function() {\r\n    if (window.confirm(\"Start a new game?\")) {\r\n      this.newGame();\r\n    };\r\n  }\r\n}, {\r\n  id: \"save\",\r\n  description: \"Save the board\",\r\n  handler: function() {\r\n    this.saveGame(this.config.labels.USERSAVE_LABEL);\r\n    this.utils.addClass(document.getElementById(\"btn-save\"), \"on\");\r\n  }\r\n}, {\r\n  id: \"load\",\r\n  description: \"Load the saved board\",\r\n  handler: function() {\r\n    if (window.confirm(\"Load the saved game?\")) {\r\n      this.loadGame(this.config.labels.USERSAVE_LABEL);\r\n    };\r\n    this.animate({\r\n      element: document.getElementById(this.config.labels.GAME_ID),\r\n      animation: \"load\",\r\n      duration: 1000\r\n    });\r\n  },\r\n}, {\r\n  id: \"settings\",\r\n  description: \"change your preferences\",\r\n  handler: function() {}\r\n}, {\r\n  id: \"info\",\r\n  description: \"About this game\",\r\n  handler: function() {}\r\n}];\r\n","game.animate = function(params) {\r\n  \"use strict\";\r\n\r\n  if (\r\n    typeof params === \"undefined\" ||\r\n    !params.element ||\r\n    typeof params.animation !== \"string\") {\r\n    console.log(\"wrong parameters in animate call\", params);\r\n    return false;\r\n  }\r\n  if (typeof params.duration !== \"number\") {\r\n    params.duration = this.config.transitionDuration.generic;\r\n  }\r\n\r\n\r\n  var CSSstyleDeclaration;\r\n  var prefix = \"\";\r\n\r\n  for (var p = 0; p < this.config.browserPrefixes.css.length; p++) {\r\n\r\n    prefix = this.config.browserPrefixes.css[p];\r\n\r\n    CSSstyleDeclaration += prefix + \"animation-fill-mode:both;\";\r\n    CSSstyleDeclaration += prefix + \"animation-duration:\" + params.duration + \"ms;\";\r\n    CSSstyleDeclaration += prefix + \"animation-name:\" + params.animation + \";\";\r\n\r\n    if (typeof params.iterations !== \"undefined\") {\r\n      CSSstyleDeclaration += prefix + \"animation-iteration-count:\" + params.iteration + \";\";\r\n    }\r\n\r\n    if (typeof params.delay === \"number\") {\r\n      CSSstyleDeclaration += prefix + \"animation-delay:\" + params.delay + \"ms;\";\r\n    }\r\n\r\n    if (typeof params.easing === \"string\") {\r\n      CSSstyleDeclaration += prefix + \"animation-timing-function:\" + params.easing + \";\";\r\n    }\r\n\r\n    if (p < 0) {\r\n      this.utils.listenTo(\r\n        params.element,\r\n        \"animationend\",\r\n        function(event, context) {\r\n\r\n          context.utils.stopListeningTo(\r\n            params.element,\r\n            \"animationend\",\r\n            context.runtime.eventListeners\r\n          );\r\n\r\n          event.target.style[\"animation-name\"] = \"\";\r\n        },\r\n        this.runtime.eventListeners,\r\n        this);\r\n    } else {\r\n\r\n      this.utils.listenTo(params.element, this.config.browserPrefixes.lowercase[p] + \"AnimationEnd\",\r\n        function(event, context) {\r\n\r\n          context.utils.stopListeningTo(\r\n            params.element,\r\n            event.type,\r\n            context.runtime.eventListeners\r\n          );\r\n\r\n          event.target.style[event.type.replace(\"End\", \"Name\")] = \"\";\r\n\r\n          context.utils.removeClass(params.element, context.config.labels.ANIMATED_LABEL);\r\n\r\n        },\r\n        this.runtime.eventListeners,\r\n        this\r\n      );\r\n\r\n    }\r\n  }\r\n  game.utils.addClass(params.element, game.config.labels.ANIMATED_LABEL);\r\n  params.element.style.cssText += CSSstyleDeclaration;\r\n};\r\n","game.canMove = function(tile) {\r\n  \"use strict\";\r\n  tile = this.isTile(tile) || null;\r\n\r\n  var hole = this.runtime.tiles[this.config.labels.TILE_PREFIX + this.config.labels\r\n      .HOLE_INDEX],\r\n    holePosition = hole.col + \"-\" + hole.row;\r\n\r\n  if (!tile) {\r\n    return false;\r\n  };\r\n\r\n  if (holePosition === (tile.col) + \"-\" + (tile.row - 1)) {\r\n    return this.config.labels.UP;\r\n  }\r\n  if (holePosition === (tile.col + 1) + \"-\" + (tile.row)) {\r\n    return this.config.labels.RIGHT;\r\n  }\r\n  if (holePosition === (tile.col) + \"-\" + (tile.row + 1)) {\r\n    return this.config.labels.DOWN;\r\n  }\r\n  if (holePosition === (tile.col - 1) + \"-\" + (tile.row)) {\r\n    return this.config.labels.LEFT;\r\n  }\r\n\r\n  return false;\r\n};\r\n","game.canPush = function(tile) {\r\n  \"use strict\";\r\n  tile = this.isTile(tile) || false;\r\n\r\n  var hole = this.runtime.tiles[this.config.labels.TILE_PREFIX + this.config.labels.HOLE_INDEX];\r\n  var tilesToPush = 0;\r\n  var pushableTiles = 0;\r\n\r\n  if (!tile) {\r\n    return false;\r\n  };\r\n\r\n  if (this.config.pushMultiple) {\r\n    if (tile.col === hole.col || tile.row === hole.row) {\r\n\r\n      tilesToPush = (tile.col - hole.col === 0) ? hole.row - tile.row : hole.col - tile.col;\r\n      pushableTiles = Math.abs(tilesToPush) - 1;\r\n\r\n\r\n      if (tilesToPush === 0 || pushableTiles === 0) {\r\n        return false;\r\n      }\r\n\r\n\r\n      if (tile.col === hole.col) // up or down\r\n      {\r\n        if (tilesToPush > 0) // down\r\n        {\r\n          return ({\r\n            n: pushableTiles,\r\n            direction: this.config.labels.DOWN\r\n          });\r\n        } else // up\r\n        {\r\n          return ({\r\n            n: pushableTiles,\r\n            direction: this.config.labels.UP\r\n          });\r\n        }\r\n      } else // left or right\r\n      {\r\n        if (tilesToPush > 0) // right\r\n        {\r\n          return ({\r\n            n: pushableTiles,\r\n            direction: this.config.labels.RIGHT\r\n          });\r\n        } else // left\r\n        {\r\n          return ({\r\n            n: pushableTiles,\r\n            direction: this.config.labels.LEFT\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n  }\r\n\r\n  return false;\r\n};\r\n","game.checkFeatures = function() {\r\n  \"use strict\";\r\n\r\n\r\n  this.config.browserOK = game.utils.checkBrowser();\r\n\r\n  if (!this.config.browserOK) {\r\n    console.log(\"Browser non supportato\");\r\n    return false;\r\n  }\r\n\r\n  /*\r\n    if the device supports it listen for touch \r\n    events instead of mouse events      \r\n   */\r\n  this.config.useTouch = Modernizr.touch;\r\n\r\n  this.utils.addClass(document.getElementById(this.config.labels.GAME_ID),\r\n    this.config.useTouch ? this.config.labels.USETOUCH_LABEL : this.config.labels.NO_TOUCH_LABEL\r\n  );\r\n\r\n  /*\r\n    if the device supports it use 3D transforms \r\n    (which should be hardware accellerated) \r\n    instead of 2D transforms\r\n   */\r\n  this.config.useCSStransitions = Modernizr.csstransitions;\r\n\r\n  if (!this.config.useCSStransitions)  {\r\n\r\n    console.log(\"css transitions are disabled\");\r\n\r\n    this.utils.createCSSClass(\r\n      \"#\" + this.config.labels.GAME_ID + \" * \",\r\n      \"transition: none !important;\"\r\n    );\r\n\r\n  }\r\n\r\n  /*\r\n    if the device supports it use 3D transforms \r\n    (which should be hardware accellerated) \r\n    instead of 2D transforms\r\n   */\r\n  this.config.use3Dtransforms = Modernizr.csstransforms3d;\r\n\r\n\r\n  /*\r\n    if the devive supports it, use HTML5 \r\n    localStorage to save games\r\n   */\r\n  this.config.useLstorage = Modernizr.localstorage;\r\n\r\n\r\n  this.config.useVibration = true;\r\n\r\n\r\n  /*\r\n    if the devive supports it, use CSS3 \r\n    animations\r\n   */\r\n  this.config.useCssAnimations = Modernizr.cssanimations;\r\n\r\n\r\n  /*\r\n    detects Safari fullscreen mode (for ex. \r\n    launched as app from home screen)\r\n   */\r\n  this.config.launchedAsApp = this.utils.detectFullscreen();\r\n\r\n\r\n  /*\r\n    list of browser vendors prefixes to \r\n    support for CSS3 properties    \r\n   */\r\n  this.config.browserPrefixes = this.utils.getBrowserPrefix();\r\n\r\n\r\n};\r\n","game.countMove = function() {\r\n  \"use strict\";\r\n  this.runtime.movesCount++;\r\n};\r\n","game.createBoard = function() {\r\n  \"use strict\";\r\n  //    - creates the board, the tiles objects and the html \r\n\r\n  // local vars:\r\n  var boardHTML, //   - - the game main html element \r\n    tile, //    - - each tile object during a loop\r\n    row = 0, //   - - vertical position of each tile, starting from 0\r\n    col = 0; //   - - horizontal position of each tile, starting from 0\r\n\r\n  if (document.getElementById(this.config.labels.BOARD_ID) === null) {\r\n    // create the board html element, assigns it its id attribute and adds it to the game di\r\n    boardHTML = document.createElement(\"div\");\r\n    boardHTML.setAttribute(\"id\", this.config.labels.BOARD_ID);\r\n\r\n    document.getElementById(this.config.labels.GAME_ID).appendChild(boardHTML); // the board is now in the DOM  \r\n\r\n  } else {\r\n\r\n    document.getElementById(this.config.labels.BOARD_ID).innerHTML = \"\";\r\n\r\n  };\r\n\r\n\r\n  /**\r\n   * TODO: handle re-creation of the board with different sizes\r\n   */\r\n\r\n\r\n  // update game config with the total number of tiles\r\n  this.config.size.n = this.config.size.h * this.config.size.v;\r\n\r\n  // save the index of the last tile as the \"hole\" during the game\r\n  this.config.labels.HOLE_INDEX = this.config.size.n - 1;\r\n\r\n\r\n  // populates the board with the tiles\r\n  for (var i = 0; i < this.config.size.n; i++) // repeat until (n) are created\r\n  {\r\n    //  create a new tile \r\n    tile = {\r\n      i: i, // the index of the tile\r\n      id: this.config.labels.TILE_PREFIX + i, // the id of this tile in the html\r\n      col: col, // horizontal position during the game\r\n      row: row, // vertical position during the game\r\n      correctCol: col, // horizontal position when the game is won\r\n      correctRow: row, // vertical position when the game is won\r\n      even: (i % 2 === 0) ? true : false, //\r\n      evenCol: ((col % 2 === 0)) ? true : false,\r\n      evenRow: ((row % 2 === 0)) ? true : false\r\n    };\r\n\r\n    tile.htmlElement = document.createElement(\"div\");\r\n\r\n    tile.htmlElement.setAttribute(\"id\", this.config.labels.TILE_PREFIX + i);\r\n    tile.htmlElement.setAttribute(\"tabindex\", i);\r\n    tile.htmlElement.setAttribute(\"class\", \" tile\" +\r\n      ((tile.evenRow) ? \" even-row\" : \" odd-row\") +\r\n      ((tile.evenCol) ? \" even-col\" : \" odd-col\") +\r\n      ((tile.even) ? \" even\" : \" odd\") +\r\n      ((i === this.config.labels.HOLE_INDEX) ? \" hole\" : \"\") +\r\n      \" col-\" + col +\r\n      \" row-\" + row\r\n    );\r\n    tile.htmlElement.innerHTML = '<div class=\"' + this.config.labels.TILE_INNER_CLASS + '\"><div class=\"' + this.config.labels.TILE_NUMBER_CLASS + '\">' + (i + 1) + '</div></div>';\r\n\r\n    this.runtime.tiles[this.config.labels.TILE_PREFIX + i] = tile;\r\n\r\n    document.getElementById(this.config.labels.BOARD_ID).appendChild(tile.htmlElement);\r\n\r\n    col++;\r\n    if (col >= this.config.size.h) {\r\n      row++;\r\n      col = 0;\r\n    };\r\n  };\r\n\r\n  this.saveGame(this.config.labels.SORTEDSAVE_LABEL);\r\n\r\n};\r\n","game.deselectTile = function() {\r\n  \"use strict\";\r\n\r\n  var tile = this.isTile(this.runtime.selectedTile);\r\n  var tilesMoved = 0;\r\n\r\n  if (!tile) {\r\n    return false;\r\n  };\r\n\r\n  console.log(\"de-selecting\");\r\n  this.runtime.selectedTile = null;\r\n  this.utils.removeClass(tile.htmlElement, this.config.labels.SELECTED_LABEL);\r\n  this.utils.removeClass(tile.htmlElement, this.config.labels.PRESSED_LABEL);\r\n  this.runtime.dragging = false;\r\n  this.vibrate(\"deselect\");\r\n\r\n  if (typeof tile.newPosition === \"undefined\") {\r\n    return false;\r\n  };\r\n\r\n\r\n  // has the tile been moved?\r\n  if (tile.newPosition.left.newValue.pixels !== null) {\r\n\r\n    console.log(\"the tile has been moved.\")\r\n\r\n    if ((this.config.pushMultiple && !!tile.canPush)) {\r\n\r\n      console.log(\"the tile could push other tiles, so it must have pushed them.\");\r\n\r\n      for (var i = tile.canPush.tiles.length; i > 0; i--) {\r\n        if (!tile.canPush.tiles[0].revert) {\r\n          tilesMoved++;\r\n          this.moveTile(\r\n            tile.canPush.tiles[i - 1], {\r\n              transitions: true,\r\n              force: false,\r\n              refresh: false\r\n            }\r\n          );\r\n        };\r\n        //  this.utils.removeClass(tile.canPush.tiles[i - 1].htmlElement, this.config.labels.SELECTED_LABEL);\r\n      };\r\n\r\n    }\r\n\r\n    console.log(\"now, the tile has been released far enough to its original position in order to move it?\")\r\n\r\n    if (\r\n      (Math.abs(tile.newPosition.left.newValue.pixels - tile.oldPosition.left.pixels) >= this.metrics.tileWidth * this.config.minDistanceToMoveTile) ||\r\n      (Math.abs(tile.newPosition.top.newValue.pixels - tile.oldPosition.top.pixels) >= this.metrics.tileHeight * this.config.minDistanceToMoveTile)\r\n    ) {\r\n\r\n      console.log(\"yes, it's far enough. \")\r\n\r\n      tilesMoved++;\r\n\r\n      this.moveTile(\r\n        tile, {\r\n          transitions: true,\r\n          force: false,\r\n          refresh: false\r\n        }\r\n      );\r\n    } else {\r\n      console.log(\"nope, snapping back \")\r\n    };\r\n\r\n\r\n\r\n  } else {\r\n\r\n    console.log(\"tile has not been moved at all.\")\r\n\r\n    if (this.config.clickToMove) {\r\n\r\n      if (tile.canMove || (this.config.pushMultiple && !!tile.canPush)) {\r\n        for (var i = tile.canPush.tiles.length; i > 0; i--) {\r\n          tilesMoved++;\r\n          this.moveTile(\r\n            tile.canPush.tiles[i - 1], {\r\n              transitions: true,\r\n              force: false,\r\n              refresh: false\r\n            }\r\n          );\r\n          //    this.utils.removeClass(tile.canPush.tiles[i - 1].htmlElement, this.config.labels.SELECTED_LABEL);\r\n        };\r\n\r\n        tilesMoved++;\r\n        this.moveTile(\r\n          tile, {\r\n            transitions: true,\r\n            force: false,\r\n            refresh: false\r\n          }\r\n        );\r\n\r\n\r\n      };\r\n\r\n    }\r\n\r\n  };\r\n\r\n\r\n  console.log(\"tiles moved: \" + tilesMoved);\r\n\r\n  this.refresh({\r\n    saveGame: !!tilesMoved\r\n  });\r\n\r\n};\r\n","game.dragTile = function(event) {\r\n  \"use strict\";\r\n\r\n  if (!this.runtime.running) {\r\n    this.deselectTile();\r\n    return false;\r\n  }\r\n\r\n  var tile = this.isTile(this.runtime.selectedTile),\r\n    direction,\r\n    newPosX,\r\n    newPosY,\r\n    otherTile,\r\n    otherTileNewPos,\r\n    CSSstyleDeclaration = \"\",\r\n    p;\r\n\r\n  if (!tile ||\r\n    (!!!tile.canMove && !tile.canPush.n) ||\r\n    (typeof tile.offset === \"undefined\") ||\r\n    (typeof tile.newPosition === \"undefined\")\r\n  ) {\r\n    this.deselectTile();\r\n    return false;\r\n  };\r\n\r\n  newPosX = event.pageX - this.metrics.borderSize.pixels - this.metrics.left - tile.offset.left;\r\n  newPosY = event.pageY - this.metrics.borderSize.pixels - this.metrics.top - tile.offset.top;\r\n\r\n  direction = (this.config.pushMultiple && tile.canPush) ? tile.canPush.direction : tile.canMove;\r\n\r\n  if (newPosY < tile.newPosition.top.min.pixels) {\r\n    newPosY = tile.newPosition.top.min.pixels;\r\n  };\r\n  if (newPosY > tile.newPosition.top.max.pixels) {\r\n    newPosY = tile.newPosition.top.max.pixels;\r\n  };\r\n  if (newPosX < tile.newPosition.left.min.pixels) {\r\n    newPosX = tile.newPosition.left.min.pixels;\r\n  };\r\n  if (newPosX > tile.newPosition.left.max.pixels) {\r\n    newPosX = tile.newPosition.left.max.pixels;\r\n  };\r\n\r\n\r\n\r\n  if (\r\n    event.pageX - this.metrics.left - this.metrics.borderSize.pixels + this.metrics.tileWidth * (this.config.touchTolerance) < newPosX ||\r\n    event.pageX - this.metrics.left - this.metrics.borderSize.pixels - this.metrics.tileWidth * (1 + this.config.touchTolerance) > newPosX ||\r\n    event.pageY - this.metrics.top - this.metrics.borderSize.pixels + this.metrics.tileHeight * (this.config.touchTolerance) < newPosY ||\r\n    event.pageY - this.metrics.top - this.metrics.borderSize.pixels - this.metrics.tileHeight * (1 + this.config.touchTolerance) > newPosY\r\n  ) {\r\n\r\n    //    this.vibrate(\"bump\");\r\n    this.deselectTile();\r\n\r\n    // console.log(\"dropped!\");\r\n\r\n    return false;\r\n  }\r\n\r\n\r\n\r\n  var prefix = \"\";\r\n\r\n  switch (direction) {\r\n\r\n    case this.config.labels.LEFT:\r\n    case this.config.labels.RIGHT:\r\n\r\n      tile.newPosition.top.newValue.pixels = tile.oldPosition.top.pixels;\r\n      tile.newPosition.left.newValue.pixels = newPosX;\r\n\r\n      tile.newPosition.left.newValue.percent = newPosX * 100 / game.metrics.tileWidth;\r\n\r\n      // write the css for tile html element\r\n\r\n      for (p = 0; p < this.config.browserPrefixes.css.length; p++) {\r\n        prefix = this.config.browserPrefixes.css[p];\r\n        CSSstyleDeclaration += prefix + \"transform:translate\" + this.metrics.transforms3Dsupport[0] + \"(\" + tile.newPosition.left.newValue.percent + \"%,\" + tile.oldPosition.top.percent + \"%\" + this.metrics.transforms3Dsupport[1] + \"); \" + prefix + \"transition:none; \";\r\n      }\r\n      break;\r\n\r\n\r\n    case this.config.labels.UP:\r\n    case this.config.labels.DOWN:\r\n\r\n      tile.newPosition.top.newValue.pixels = newPosY;\r\n      tile.newPosition.left.newValue.pixels = tile.oldPosition.left.pixels;\r\n\r\n      tile.newPosition.top.newValue.percent = newPosY * 100 / this.metrics.tileHeight;\r\n\r\n      // write the css for tile html element\r\n      for (p = 0; p < this.config.browserPrefixes.css.length; p++) {\r\n        prefix = this.config.browserPrefixes.css[p];\r\n        CSSstyleDeclaration += prefix + \"transform:translate\" + this.metrics.transforms3Dsupport[0] + \"(\" + tile.oldPosition.left.percent + \"%,\" + tile.newPosition.top.newValue.percent + \"%\" + game.metrics.transforms3Dsupport[1] + \"); \" + prefix + \"transition:none; \";\r\n      }\r\n      break;\r\n\r\n  }\r\n\r\n  tile.htmlElement.style.cssText = CSSstyleDeclaration;\r\n\r\n  if (!this.config.pushMultiple || typeof tile.canPush.tiles === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  for (var i = 0; i < tile.canPush.tiles.length; i++) {\r\n\r\n    otherTile = tile.canPush.tiles[i];\r\n    prefix = \"\";\r\n\r\n    switch (direction) {\r\n      case this.config.labels.UP:\r\n\r\n        otherTileNewPos = (tile.newPosition.top.newValue.pixels - (this.metrics\r\n          .tileHeight * (i + 1)));\r\n\r\n        if (\r\n          otherTileNewPos < tile.canPush.tiles[i].max ||\r\n          tile.canPush.tiles[i].max == null) {\r\n          tile.canPush.tiles[i].max = otherTileNewPos;\r\n        } else {\r\n          return false;\r\n        }\r\n\r\n        // write the css for tile html element\r\n\r\n        for (p = 0; p < this.config.browserPrefixes.css.length; p++) {\r\n          prefix = this.config.browserPrefixes.css[p];\r\n          CSSstyleDeclaration += prefix + \"transform:translate\" + this.metrics\r\n            .transforms3Dsupport[0] + \"(\" + tile.oldPosition.left.percent +\r\n            \"%,\" + otherTileNewPos + \"px\" + this.metrics.transforms3Dsupport[\r\n              1] + \"); \" + prefix + \"transition:none; \";\r\n        }\r\n\r\n        break;\r\n\r\n      case this.config.labels.RIGHT:\r\n\r\n        otherTileNewPos = (tile.newPosition.left.newValue.pixels +\r\n          (\r\n            this.metrics.tileWidth * (i + 1)));\r\n        if (otherTileNewPos > tile.canPush.tiles[i].max || tile.canPush\r\n          .tiles[i].max == null) {\r\n          tile.canPush.tiles[i].max = otherTileNewPos;\r\n        } else {\r\n          return false;\r\n        }\r\n\r\n        // write the css for tile html element\r\n        for (p = 0; p < this.config.browserPrefixes.css.length; p++) {\r\n          prefix = this.config.browserPrefixes.css[p];\r\n          CSSstyleDeclaration += prefix + \"transform:translate\" +\r\n            this.metrics\r\n            .transforms3Dsupport[0] + \"(\" + otherTileNewPos + \"px,\" +\r\n            tile.oldPosition.top.percent + \"%\" + this.metrics.transforms3Dsupport[\r\n              1] + \"); \" + prefix + \"transition:none; \";\r\n        }\r\n        break;\r\n\r\n      case this.config.labels.DOWN:\r\n\r\n        otherTileNewPos = (tile.newPosition.top.newValue.pixels + (\r\n          game\r\n          .metrics.tileHeight * (i + 1)));\r\n        if (otherTileNewPos > tile.canPush.tiles[i].max || tile.canPush\r\n          .tiles[i].max == null) {\r\n          tile.canPush.tiles[i].max = otherTileNewPos;\r\n        } else {\r\n          return false;\r\n        }\r\n\r\n        // write the css for tile html element\r\n        for (p = 0; p < this.config.browserPrefixes.css.length; p++) {\r\n          prefix = this.config.browserPrefixes.css[p];\r\n          CSSstyleDeclaration += prefix + \"transform:translate\" +\r\n            this.metrics\r\n            .transforms3Dsupport[0] + \"(\" + tile.oldPosition.left.percent +\r\n            \"%,\" + otherTileNewPos + \"px\" + this.metrics.transforms3Dsupport[\r\n              1] + \"); \" + prefix + \"transition:none; \";\r\n        }\r\n\r\n\r\n        break;\r\n\r\n      case this.config.labels.LEFT:\r\n\r\n        otherTileNewPos = (tile.newPosition.left.newValue.pixels -\r\n          (\r\n            this.metrics.tileWidth * (i + 1)));\r\n        if (otherTileNewPos < tile.canPush.tiles[i].max || tile.canPush\r\n          .tiles[i].max == null) {\r\n          tile.canPush.tiles[i].max = otherTileNewPos;\r\n        } else {\r\n          return false;\r\n        }\r\n\r\n        // write the css for tile html element\r\n        for (p = 0; p < this.config.browserPrefixes.css.length; p++) {\r\n          prefix = this.config.browserPrefixes.css[p];\r\n          CSSstyleDeclaration += prefix + \"transform:translate\" +\r\n            this.metrics\r\n            .transforms3Dsupport[0] + \"(\" + otherTileNewPos + \"px,\" +\r\n            tile.oldPosition.top.percent + \"%\" + this.metrics.transforms3Dsupport[\r\n              1] + \"); \" + prefix + \"transition:none; \";\r\n        }\r\n\r\n        break;\r\n\r\n    }\r\n    otherTile.htmlElement.style.cssText = CSSstyleDeclaration;\r\n\r\n\r\n\r\n    if (\r\n      (Math.abs(tile.newPosition.left.newValue.pixels - tile.oldPosition.left.pixels) >= this.metrics.tileWidth * this.config.minDistanceToMoveTile) ||\r\n      (Math.abs(tile.newPosition.top.newValue.pixels - tile.oldPosition.top.pixels) >= this.metrics.tileHeight * this.config.minDistanceToMoveTile)\r\n    ) {\r\n      otherTile.revert = false;\r\n    } else {\r\n      otherTile.revert = true;\r\n    }\r\n\r\n  }\r\n};\r\n","game.getMovableTiles = function(params) {\r\n  \"use strict\";\r\n  var direction = params.direction,\r\n    pushing = params.pushing,\r\n    moving = params.moving,\r\n    t;\r\n\r\n  this.runtime.movableTiles = [];\r\n\r\n  if (this.runtime.running || params.force === true) {\r\n    for (var i = 0; i < this.config.size.n; i++) {\r\n      t = this.runtime.tiles[\"tile-\" + i];\r\n\r\n      if (!!t.canMove && moving && (typeof direction === \"undefined\" ||\r\n          direction === t.canMove)) {\r\n        this.runtime.movableTiles.push(this.getTile(this.config.labels.TILE_PREFIX +\r\n          t.i));\r\n      };\r\n\r\n      if (this.config.pushMultiple && pushing && !!t.canPush && !t.canMove &&\r\n        (typeof direction === \"undefined\" || direction === t.canPush.direction)\r\n      ) {\r\n        this.runtime.movableTiles.push(this.getTile(this.config.labels.TILE_PREFIX +\r\n          t.i));\r\n      };\r\n    }\r\n\r\n  };\r\n  return this.runtime.movableTiles;\r\n};\r\n","game.getTile = function(param) {\r\n  \"use strict\";\r\n\r\n  var target = null,\r\n    maxLevels = 5,\r\n    tiles = this.runtime.tiles,\r\n    col = parseInt(param.col),\r\n    row = parseInt(param.row),\r\n    prefix = this.config.labels.TILE_PREFIX,\r\n    i;\r\n\r\n  switch (typeof param) {\r\n\r\n    case \"object\":\r\n\r\n      if (param.srcElement) {\r\n        target = param.srcElement;\r\n      } else if (param.pageX && param.pageY) {\r\n        target = document.elementFromPoint(param.pageX, param.pageY);\r\n      } else if (!isNaN(parseInt(param.col)) && !isNaN(parseInt(\r\n          param.row))) {\r\n\r\n        for (i = 0; i < this.config.size.n; i++) {\r\n          if (tiles[prefix + i].col === col && tiles[prefix + i].row === row) {\r\n            return tiles[prefix + i];\r\n          }\r\n        }\r\n        return false;\r\n      } else {\r\n        return false;\r\n      }\r\n\r\n      if (target === null) {\r\n        return false;\r\n      }\r\n\r\n      for (i = 0; i < maxLevels; i++) {\r\n\r\n        if (\r\n          typeof target === \"undefined\" ||\r\n          typeof target.parentNode === \"undefined\" ||\r\n          target === null ||\r\n          target.parentNode === null\r\n        ) {\r\n          return false;\r\n        } else if (target.parentNode.id === this.config.labels.BOARD_ID) {\r\n          return this.runtime.tiles[target.id];\r\n        } else {\r\n          target = target.parentNode;\r\n        }\r\n      }\r\n      return false;\r\n\r\n      break;\r\n\r\n    case \"string\":\r\n      if (param.indexOf(prefix) === 0) {\r\n        return tiles[param];\r\n      }\r\n      return false;\r\n\r\n    case \"number\":\r\n      if (param < this.config.size.n) {\r\n        return tiles[prefix + param];\r\n      }\r\n      return false;\r\n\r\n\r\n  }\r\n};\r\n","game.init = function() {\r\n  \"use strict\";\r\n\r\n  this.runtime = {\r\n    started: false, //    - - false before running, a date obj when started\r\n    running: false, //    - - true if the game is started (and user can win)    \r\n    ended: false, //    - - false while running, a date obj when ended\r\n    timePlaying: 0, //tbd\r\n    movesCount: false, //   - - number of moves the user has made since the start\r\n    dragging: false, //   - - true when any tile is being dragged\r\n    resizeTimer: -1, //   - - variable needed for the resize timer\r\n    selectedTile: null, //    - - the selected tile object (extends normal tile objects \r\n    tiles: {}, //   - - tile tiles (associative) array\r\n    latestSelection: 0, //   - - used to ignore doubleclicks\r\n    eventListeners: {}\r\n  };\r\n\r\n  this.checkFeatures();\r\n  this.createBoard(); //   - - creates the board, the tiles objects and the html       \r\n  this.metricsUpdate();\r\n  this.initListeners(); //   - - create event listeners enabling user interaction\r\n  this.refresh({\r\n    transitions: false\r\n  }); //    - - position each tile according to the game runtime      \r\n  if (!this.loadGame()) {\r\n    this.newGame(); //   - - repeatedly changes random tiles \r\n  } else {\r\n    this.animate({\r\n      element: document.getElementById(this.config.labels.GAME_ID),\r\n      animation: \"load\",\r\n      duration: 1000\r\n    });\r\n    this.start(); //   - - set the game as started. from this moment on the game checks if the user has won\r\n  }\r\n\r\n\r\n\r\n  game.setBgImage({\r\n    imgUrl: \"https://source.unsplash.com/random/\" + this.metrics.width + \"x\" + this.metrics.height\r\n  });\r\n\r\n\r\n\r\n\r\n};\r\n","game.initListeners = function() {\r\n  \"use strict\";\r\n\r\n  // BEGIN TOUCH/CLICK EVENTS\r\n\r\n  // start/down\r\n  // board\r\n  this.utils.listenTo(\r\n    document.getElementById(this.config.labels.BOARD_ID), (this.config.useTouch ? \"touchstart\" : \"mousedown\"),\r\n    function(event, context) {\r\n\r\n      // ignore doubleclicks  \r\n      if (event.timeStamp - context.runtime.latestSelection < 300) {\r\n        return false;\r\n      }\r\n      context.runtime.latestSelection = event.timeStamp;\r\n\r\n      context.selectTile(context.getTile(event), event);\r\n\r\n    },\r\n    this.runtime.eventListeners,\r\n    this\r\n  );\r\n\r\n\r\n\r\n  // move\r\n  this.utils.listenTo(\r\n    document.getElementById(this.config.labels.BOARD_ID), (this.config.useTouch ? \"touchmove\" : \"mousemove\"),\r\n    function(event, context) {\r\n\r\n\r\n      if (!!context.runtime.selectedTile) {\r\n        context.dragTile(event);\r\n      } else if (event.type !== \"mousemove\") {\r\n\r\n        // ignore doubleclicks  \r\n        if (event.timeStamp - context.runtime.latestSelection < 300) {\r\n          return false;\r\n        }\r\n        context.runtime.latestSelection = event.timeStamp;\r\n\r\n        context.selectTile(context.getTile(event), event);\r\n      }\r\n\r\n\r\n    },\r\n    this.runtime.eventListeners,\r\n    this\r\n  );\r\n\r\n\r\n\r\n  //  end/up\r\n  this.utils.listenTo(\r\n    document.getElementById(this.config.labels.WRAPPER_ID), (this.config.useTouch ? \"touchend\" : \"mouseup\"),\r\n    function(event, context) {\r\n\r\n      if (typeof context.runtime.selectedTile === \"undefined\" || context.runtime.selectedTile === null) {\r\n        return false;\r\n      }\r\n\r\n      if (context.config.useTouch && ((event.timeStamp - context.runtime.selectedTile.timeStamp) > context.config.maxTimeForClickMove)) {\r\n\r\n        if (\r\n          context.runtime.selectedTile.newPosition.top.newValue.pixels === null &&\r\n          context.runtime.selectedTile.newPosition.left.newValue.pixels === null\r\n        ) {\r\n          context.runtime.selectedTile.newPosition = undefined;\r\n        }\r\n      };\r\n\r\n      context.deselectTile();\r\n\r\n    },\r\n    this.runtime.eventListeners,\r\n    this);\r\n\r\n  // mouseout\r\n  this.utils.listenTo(\r\n    document.getElementById(this.config.labels.GAME_ID),\r\n    \"mouseout\",\r\n    function(event, context) {\r\n      event = event ? event : window.event;\r\n      var from = event.relatedTarget || event.toElement;\r\n      if (!from || from.nodeName === \"HTML\") {\r\n        context.deselectTile();\r\n      }\r\n    },\r\n    this.runtime.eventListeners,\r\n    this);\r\n\r\n\r\n  // END TOUCH/MOUSE EVENTS\r\n\r\n  if (this.config.useKeyboard) {\r\n    this.utils.listenTo(\r\n      document.body,\r\n      \"keyup\",\r\n      function(event, context) {\r\n\r\n        switch (event.which) {\r\n          case context.config.keycodes.KEY_ARROW_LEFT:\r\n            context.moveAnyTile({\r\n              direction: context.config.labels.LEFT,\r\n              pushing: event.ctrlKey\r\n            });\r\n            break;\r\n\r\n          case context.config.keycodes.KEY_ARROW_UP:\r\n            context.moveAnyTile({\r\n              direction: context.config.labels.UP,\r\n              pushing: event.ctrlKey\r\n            });\r\n            break;\r\n\r\n          case context.config.keycodes.KEY_ARROW_RIGHT:\r\n            context.moveAnyTile({\r\n              direction: context.config.labels.RIGHT,\r\n              pushing: event.ctrlKey\r\n            });\r\n            break;\r\n\r\n          case context.config.keycodes.KEY_ARROW_DOWN:\r\n            context.moveAnyTile({\r\n              direction: context.config.labels.DOWN,\r\n              pushing: event.ctrlKey\r\n            });\r\n            break;\r\n\r\n        }\r\n\r\n      },\r\n      this.runtime.eventListeners,\r\n      this);\r\n  }\r\n\r\n  // resize\r\n  this.utils.listenTo(window,\r\n    \"resize\",\r\n    function(event, context) {\r\n\r\n      context.optimizeRedraws(\"on\");\r\n\r\n      if (context.runtime.resizeTimer !== -1) {\r\n        clearTimeout(context.runtime.resizeTimer);\r\n      }\r\n\r\n      context.runtime.resizeTimer = window.setTimeout(function(context) {\r\n\r\n        if (typeof context !== \"undefined\") {\r\n          context.deselectTile();\r\n          context.metricsUpdate();\r\n          context.refresh();\r\n          context.optimizeRedraws(\"off\");\r\n        }\r\n\r\n      }, 500, context);\r\n\r\n    },\r\n    this.runtime.eventListeners,\r\n    this);\r\n\r\n\r\n};\r\n","game.isTile = function(tile) {\r\n  \"use strict\";\r\n\r\n  if (tile === null || tile === undefined) {\r\n    return false;\r\n  }\r\n\r\n  switch (typeof tile) {\r\n    case \"object\":\r\n      if (tile.id.indexOf(this.config.labels.TILE_PREFIX) < 0) {\r\n        return false;\r\n      }\r\n      break;\r\n\r\n    case \"string\":\r\n      tile = this.runtime.tiles[tile];\r\n      if (typeof tile === \"undefined\") {\r\n        return false;\r\n      };\r\n      if (tile.id.indexOf(this.config.labels.TILE_PREFIX) < 0) {\r\n        return false;\r\n      };\r\n      break;\r\n\r\n    default:\r\n      return false;\r\n      break;\r\n  }\r\n  return tile;\r\n};\r\n","game.loadGame = function(type) {\r\n  \"use strict\";\r\n  if (!this.config.useLstorage) {\r\n    return false;\r\n  }\r\n  if (typeof type === \"undefined\") {\r\n    type = this.config.labels.AUTOSAVE_LABEL;\r\n  }\r\n\r\n  var loadedGames = JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL));\r\n  var loadedGame = null;\r\n  var tileID;\r\n\r\n  if (loadedGames !== null) {\r\n    if (typeof loadedGames[type] !== \"undefined\" && loadedGames[type] !==\r\n      null) {\r\n      loadedGame = loadedGames[type];\r\n\r\n      loadedGame.saveDate = new Date(Date.UTC.apply(this,\r\n        loadedGame.saveDate.match(/\\d+\\.{0,1}\\d+/g)));\r\n\r\n\r\n      if (loadedGame.startedDate) {\r\n        loadedGame.startedDate = new Date(Date.UTC.apply(this,\r\n          loadedGame.startedDate.match(/\\d+\\.{0,1}\\d+/g)));\r\n      }\r\n\r\n      if (loadedGame.size !== this.config.size.n) {\r\n        console.log(\"cannot load game: different sizes:\",\r\n          loadedGame.size, this.config.size.n);\r\n        return false;\r\n      }\r\n\r\n      this.runtime.tiles = loadedGame.tiles;\r\n\r\n\r\n      for (var i = 0; i < this.config.size.n; i++) {\r\n\r\n        tileID = this.config.labels.TILE_PREFIX + i;\r\n        loadedGame.tiles[tileID].htmlElement = document.getElementById(\r\n          tileID);\r\n      }\r\n\r\n      this.runtime.started = loadedGame.startedDate;\r\n      this.runtime.movesCount = parseInt(loadedGame.movesCount);\r\n      this.refresh({\r\n        transitions: (type === \"user\")\r\n      });\r\n\r\n      console.log(\"game loaded\");\r\n      return true;\r\n    }\r\n\r\n    console.log(\"cannot find saved game '\" + type + \"'\");\r\n    return false;\r\n\r\n  }\r\n\r\n  console.log(\"cannot find any saved game\");\r\n  return false;\r\n};\r\n","game.metricsUpdate = function() {\r\n  \"use strict\";\r\n\r\n  this.metrics = this.metrics || {};\r\n\r\n  var wrapperHTML = document.getElementById(this.config.labels.WRAPPER_ID); // main wrapper html element\r\n  var gameHTML = document.getElementById(this.config.labels.GAME_ID); // game div html element\r\n  var wrapperWidth = wrapperHTML.offsetWidth;\r\n  var wrapperHeight = wrapperHTML.offsetHeight;\r\n  var cssPrefix = \"#\" + this.config.labels.BOARD_ID;\r\n\r\n  // save values in metrics obj\r\n  this.metrics.transforms3Dsupport = (this.config.use3Dtransforms) ? [\"3d\", \",0\"] : [\"\", \"\"]; // allows transformations 2d and 3d \r\n  this.metrics.wrapperOrientation = (wrapperWidth >= wrapperHeight) ? this.config.labels.LANDSCAPE : this.config.labels.PORTRAIT;\r\n  this.metrics.wrapperRatio = wrapperWidth / wrapperHeight;\r\n  this.metrics.pixelRatio = (window.devicePixelRatio > 1) ? window.devicePixelRatio : 1;\r\n\r\n\r\n  // if it doesn't exists yet, create wrapperSize obj\r\n  if (typeof this.metrics.wrapperSize === \"undefined\") {\r\n    this.metrics.wrapperSize = {};\r\n  };\r\n\r\n  // if it doesn't exist yet, create a sub-obj for storing metric sinformation for each screen orientation    \r\n  this.metrics.wrapperSize[this.metrics.wrapperOrientation] = {\r\n    width: wrapperWidth,\r\n    height: wrapperHeight,\r\n  };\r\n\r\n  // this is info about the board configuration\r\n  this.metrics.boardLayout = (this.config.size.h >= this.config.size.v) ? this.config.labels.LANDSCAPE : this.config.labels.PORTRAIT;\r\n  this.metrics.boardRatio = this.config.size.h / this.config.size.v;\r\n\r\n  // this is a pragmatic way to calculate a good font size for tile numbers\r\n  this.metrics.fontSize = parseInt((document.body.currentStyle || (window.getComputedStyle && getComputedStyle(document.body, null)) || document.body.style).fontSize);\r\n\r\n  // initialize the margin around the game board\r\n  this.metrics.marginH = {\r\n    percent: this.config.margin.h,\r\n    pixels: 0\r\n  };\r\n\r\n  // initialize the margin around the game board\r\n  this.metrics.marginV = {\r\n    percent: this.config.margin.v,\r\n    pixels: 0\r\n  };\r\n\r\n  // initialize the bezel around the game board\r\n  this.metrics.borderSize = {\r\n    percent: this.config.borderSize,\r\n    pixels: 0\r\n  };\r\n\r\n  // depending on orientation, calculate board size to optimize space\r\n  // board will always be a square, so calculate width first\r\n  if (this.metrics.wrapperOrientation === this.config.labels.LANDSCAPE) {\r\n\r\n    this.metrics.height = this.utils.roundTo(wrapperHeight / 100 * (100 - this.config.borderSize * 2 - this.metrics.marginV.percent * 2), this.config.size.h);\r\n    this.metrics.width = this.metrics.height;\r\n\r\n    this.metrics.borderSize.pixels = Math.round(wrapperHeight / 100 * this.config.borderSize);\r\n    this.metrics.marginH.pixels = Math.round(wrapperHeight / 100 * this.metrics.marginH.percent);\r\n    this.metrics.marginV.pixels = Math.round(wrapperHeight / 100 * this.metrics.marginV.percent);\r\n\r\n    this.metrics.left = Math.round((wrapperWidth - this.metrics.width - this.metrics.borderSize.pixels - this.metrics.marginH.pixels) / 2);\r\n    this.metrics.top = Math.round((this.metrics.wrapperSize[this.metrics.wrapperOrientation].height - this.metrics.height - this.metrics.borderSize.pixels - this.metrics.marginV.pixels) / 2);\r\n\r\n  } else {\r\n\r\n    this.metrics.width = this.utils.roundTo(wrapperWidth / 100 * (100 - this.config.borderSize * 2 - this.metrics.marginH.percent * 2), this.config.size.v);\r\n    this.metrics.height = this.metrics.width;\r\n\r\n    this.metrics.borderSize.pixels = Math.round(wrapperWidth / 100 * this.config.borderSize);\r\n    this.metrics.marginH.pixels = Math.round(wrapperWidth / 100 * this.metrics.marginH.percent);\r\n    this.metrics.marginV.pixels = Math.round(wrapperWidth / 100 * this.metrics.marginV.percent);\r\n\r\n    this.metrics.left = Math.round((wrapperWidth - this.metrics.width - this.metrics.borderSize.pixels - this.metrics.marginH.pixels) / 2);\r\n    this.metrics.top = Math.round((this.metrics.wrapperSize[this.metrics.wrapperOrientation].height - this.metrics.height - this.metrics.borderSize.pixels - this.metrics.marginV.pixels) / 2);\r\n\r\n  }\r\n\r\n  // with the board size, get the tile size\r\n  this.metrics.tileWidth = Math.round(this.metrics.width / this.config.size.h);\r\n  this.metrics.tileHeight = Math.round(this.metrics.height / this.config.size.v);\r\n\r\n\r\n  // WRITING PHASE\r\n\r\n  // hide to speed up redraws; also write the page height as inline style to prevent reflows\r\n  this.optimizeRedraws(\"on\");\r\n\r\n  // write the css for game html element\r\n\r\n  var CSSstyleDeclaration = \"\" + \"padding:\" + Math.round(this.metrics.borderSize.pixels) + \"px;\" + \"width:\" + this.metrics.width + \"px; \" + \"height:\" + this.metrics.height + \"px; \" + \"left:\" + this.metrics.left + \"px; \" + \"top:\" + this.metrics.top + \"px; \";\r\n\r\n  if (typeof game.runtime.backgroundImage !== \"undefined\") {\r\n    var rgb = game.runtime.backgroundImage.averageRGB_brighter;\r\n    if (typeof rgb === \"object\") {\r\n      CSSstyleDeclaration += \"background-color: rgb(\" + rgb.r + \",\" + rgb.g + \",\" + rgb.b + \");\"\r\n    };\r\n  };\r\n\r\n  gameHTML.style.cssText = CSSstyleDeclaration;\r\n\r\n  // font size (used both for numbers, spacing and borders)\r\n\r\n  document.getElementById(this.config.labels.GAME_ID).style.fontSize = \"\" + document.getElementById(this.config.labels.BOARD_ID).offsetHeight / this.config.size.v / 2 + \"px\";\r\n\r\n\r\n  // css for tile\r\n  var tileWpc = (100 / this.config.size.h) + \"%\";\r\n  var tileHpc = (100 / this.config.size.v) + \"%\";\r\n\r\n  // if the class rule is not present..\r\n  if (this.utils.editCSSRule(cssPrefix + \" .\" + this.config.labels.TILE_CLASS) === null) {\r\n\r\n    // ...create it\r\n    this.utils.createCSSClass(cssPrefix + \" .\" + this.config.labels.TILE_CLASS,\r\n      \"width: \" + tileWpc + \"; height: \" + tileHpc + \";\"\r\n    );\r\n\r\n  } else {\r\n\r\n    // ...or updated it\r\n    this.utils.editCSSRule(cssPrefix + \" .\" + this.config.labels.TILE_CLASS, \"width\", tileWpc);\r\n    this.utils.editCSSRule(cssPrefix + \" .\" + this.config.labels.TILE_CLASS, \"height\", tileHpc);\r\n\r\n  };\r\n\r\n  // same for inner class\r\n  var bgSize = \"auto \" + this.metrics.height + \"px\";\r\n\r\n  if (this.utils.editCSSRule(cssPrefix + \" .\" + this.config.labels.TILE_INNER_CLASS) === null) {\r\n    this.utils.createCSSClass(cssPrefix + \".\" + this.config.labels.TILE_INNER_CLASS, \"background-size: \" + bgSize + \";\");\r\n  } else {\r\n    this.utils.editCSSRule(cssPrefix + \" .\" + this.config.labels.TILE_INNER_CLASS, \"backgroundSize\", bgSize);\r\n  }\r\n\r\n\r\n  // finally, reveal the updated html element\r\n  this.optimizeRedraws(\"off\");\r\n\r\n};\r\n","game.moveAnyTile = function(params) {\r\n  \"use strict\";\r\n\r\n  var tiles = (params.pushing === true) ? this.getMovableTiles({\r\n      pushing: false,\r\n      moving: true,\r\n      direction: params.direction\r\n    }).concat(this.getMovableTiles({\r\n      pushing: true,\r\n      moving: false,\r\n      direction: params.direction\r\n    }).sort(function(t1, t2) {\r\n      return t1.canPush.n - t2.canPush.n;\r\n    })) :\r\n    this.getMovableTiles({\r\n      pushing: false,\r\n      moving: true,\r\n      direction: params.direction\r\n    });\r\n  for (var i = 0; i < tiles.length; i++) {\r\n    this.moveTile(tiles[i], {\r\n      transitions: false,\r\n      force: false,\r\n      refresh: false\r\n    });\r\n  }\r\n  this.refresh({\r\n    transitionDuration: this.config.transitionDuration.byKeyboard\r\n  });\r\n\r\n  return tiles;\r\n};\r\n","game.moveTile = function(tile, params) {\r\n  \"use strict\";\r\n\r\n  tile = this.isTile(tile);\r\n  if (!tile) {\r\n    return false;\r\n  };\r\n\r\n  var hole = this.runtime.tiles[this.config.labels.TILE_PREFIX + this.config.labels.HOLE_INDEX];\r\n  var temp = {};\r\n\r\n  if (!this.canMove(tile)) {\r\n    return false;\r\n  }\r\n\r\n  if (params.force !== true) {\r\n    if (!this.runtime.running) {\r\n      return false;\r\n    }\r\n    this.countMove();\r\n  }\r\n\r\n  temp.col = tile.col;\r\n  temp.row = tile.row;\r\n\r\n  tile.col = hole.col;\r\n  tile.row = hole.row;\r\n\r\n  hole.col = temp.col;\r\n  hole.row = temp.row;\r\n\r\n  if (params.refresh === true) {\r\n    this.refresh({\r\n      transitions: params.transitions,\r\n      saveGame: !params.force,\r\n      redraw: !!!params.force\r\n    });\r\n  }\r\n\r\n  return true;\r\n};\r\n","game.newGame = function() {\r\n  \"use strict\";\r\n\r\n  var animationDuration = 2000;\r\n\r\n  if (this.runtime.running) {\r\n    console.log(\"user reset\");\r\n\r\n    this.stop();\r\n\r\n    setTimeout(function(context) {\r\n\r\n      context.loadGame(context.config.labels.SORTEDSAVE_LABEL);\r\n\r\n      context.refresh({\r\n        transitions: false\r\n      });\r\n\r\n      context.saveGame(context.config.labels.SORTEDSAVE_LABEL);\r\n\r\n\r\n    }, animationDuration * 0.34, this);\r\n\r\n    this.animate({\r\n      element: document.getElementById(this.config.labels.GAME_ID),\r\n      animation: \"resetboard\",\r\n      duration: animationDuration,\r\n      easing: \"ease-in-out\"\r\n    });\r\n\r\n  } else {\r\n    console.log(\"first launch\");\r\n\r\n    this.refresh({\r\n      transitions: false\r\n    });\r\n\r\n    this.saveGame(this.config.labels.SORTEDSAVE_LABEL);\r\n\r\n    this.animate({\r\n      element: document.getElementById(this.config.labels.GAME_ID),\r\n      animation: \"intro\",\r\n      duration: animationDuration\r\n    });\r\n\r\n  }\r\n\r\n  setTimeout(function(context) {\r\n\r\n    context.shuffle(context.config.size.n * context.config.size.n);\r\n    context.saveGame(context.config.labels.SHUFFLEDSAVE_LABEL);\r\n    context.start();\r\n\r\n  }, animationDuration * 0.85, this);\r\n};\r\n","game.optimizeRedraws = function(state) {\r\n  \"use strict\";\r\n\r\n  var elements = [\r\n    this.config.labels.WRAPPER_ID,\r\n    this.config.labels.BACKGROUND_CONTAINER_ID,\r\n    this.config.labels.GAME_ID\r\n  ];\r\n\r\n  var i = 0;\r\n\r\n\r\n  if (state == \"on\") {\r\n\r\n\r\n    for (i = 0; i < elements.length; i++) {\r\n      document.getElementById(elements[i]).style.visibility = \"hidden\";\r\n    }\r\n\r\n  } else {\r\n\r\n    for (i = 0; i < elements.length; i++) {\r\n      document.getElementById(elements[i]).style.visibility = \"visible\";\r\n\r\n    }\r\n\r\n\r\n  };\r\n\r\n\r\n}\r\n","game.refresh = function(params) {\r\n  \"use strict\";\r\n\r\n  var tileID,\r\n    tile,\r\n    CSSstyleDeclaration = \"\",\r\n    win = true;\r\n\r\n  if (typeof params === \"undefined\") {\r\n    params = {\r\n      transitions: true,\r\n      saveGame: false\r\n    };\r\n  };\r\n\r\n  if (params.transitions === false) {\r\n    params.transitionDuration = 0;\r\n  } else // transitions = true\r\n  {\r\n    if (typeof params.transitionDuration !== \"number\") {\r\n      params.transitionDuration = this.config.transitionDuration.generic;\r\n    }\r\n  };\r\n\r\n  console.log(\"refresh\", params);\r\n\r\n  for (var i = 0; i < this.config.size.n; i++) {\r\n\r\n    tileID = this.config.labels.TILE_PREFIX + i;\r\n    tile = this.runtime.tiles[tileID];\r\n\r\n    // write the css for tile html element\r\n    var prefix = \"\";\r\n    for (var p = 0; p < this.config.browserPrefixes.css.length; p++) {\r\n\r\n      prefix = this.config.browserPrefixes.css[p];\r\n\r\n      CSSstyleDeclaration += prefix + \"transform:translate\" + this.metrics.transforms3Dsupport[0] + \"(\" + (tile.col * 100) + \"%,\" + (tile.row * 100) + \"%\" + this.metrics.transforms3Dsupport[1] + \"); \";\r\n      CSSstyleDeclaration += prefix + \"transition-property:\" + prefix + \"transform;\";\r\n      CSSstyleDeclaration += prefix + \"transition-duration:\" + parseInt(Math.abs(params.transitionDuration)) + \"ms !important;\";\r\n      CSSstyleDeclaration += prefix + \"transition-timing-function:\" + this.config.easings.EASING_TILES_MOVEMENT + \";\";\r\n    }\r\n\r\n\r\n    if (params.redraw !== false) {\r\n      tile.htmlElement.style.cssText = CSSstyleDeclaration;\r\n    }\r\n\r\n    tile.htmlElement.childNodes[0].style.backgroundPosition = \"-\" + (tile.correctCol * this.metrics.tileWidth) + \"px -\" + (tile.correctRow * this.metrics.tileHeight) + \"px\";\r\n\r\n    tile.canMove = this.canMove(tileID);\r\n    tile.canPush = this.canPush(tileID);\r\n\r\n    // clean up data created when dragging or moving a tile\r\n    tile.offse = undefined;\r\n    tile.newPosition = undefined;\r\n    tile.oldPosition = undefined;\r\n    tile.timeStamp = undefined;\r\n    tile.revert = undefined;\r\n    tile.max = undefined;\r\n\r\n    // check if the user has won\r\n    if (tile.correctCol !== tile.col || tile.correctRow !== tile.row) {\r\n      win = false;\r\n    }\r\n\r\n  };\r\n\r\n  if (this.runtime.running && win /* && this.runtime.movesCount > 0 */ ) {\r\n    setTimeout(function() {\r\n      window.alert(\"Hai vinto!\");\r\n    }, 500);\r\n    this.stop();\r\n\r\n    this.newGame();\r\n  }\r\n\r\n  if (params.saveGame === true) {\r\n    this.saveGame();\r\n  }\r\n};\r\n","game.saveGame = function(type) {\r\n  \"use strict\";\r\n  if (!this.config.useLstorage) {\r\n    return false;\r\n  }\r\n  if (this.runtime.ended !== false) {\r\n    return false;\r\n  }\r\n  if (typeof type === \"undefined\") {\r\n    type = this.config.labels.AUTOSAVE_LABEL;\r\n  }\r\n\r\n  var savedGames = {};\r\n  var savedGame = {\r\n    saveDate: new Date().toUTCString(),\r\n    type: type,\r\n    size: this.config.size.n,\r\n    tiles: {},\r\n    movesCount: this.runtime.movesCount\r\n  };\r\n  var tileID;\r\n\r\n  if (JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL)) != null) {\r\n    savedGames = JSON.parse(localStorage.getItem(this.config.labels.SAVEDGAMES_LABEL));\r\n  }\r\n\r\n  if (this.runtime.started) {\r\n    savedGame.startedDate = this.runtime.started.toUTCString();\r\n  }\r\n\r\n  for (var i = 0; i < this.config.size.n; i++) {\r\n\r\n    tileID = this.config.labels.TILE_PREFIX + i;\r\n    savedGame.tiles[tileID] = this.utils.cloneObj(this.runtime.tiles[tileID]);\r\n  }\r\n\r\n  savedGames[type] = savedGame;\r\n\r\n  localStorage.setItem(this.config.labels.SAVEDGAMES_LABEL, JSON.stringify(savedGames));\r\n\r\n  console.log(\"game saved (\" + type + \")\");\r\n};\r\n","game.selectTile = function(tile, event) {\r\n  \"use strict\";\r\n\r\n  if (!this.runtime.running) {\r\n    return false;\r\n  }\r\n\r\n  tile = this.isTile(tile);\r\n\r\n  if (!tile) {\r\n    return false;\r\n  };\r\n\r\n  var direction = (this.config.pushMultiple && tile.canPush) ? tile.canPush.direction : tile.canMove;\r\n\r\n  this.runtime.selectedTile = tile;\r\n\r\n  if (this.canMove(tile) || this.config.pushMultiple) {\r\n\r\n    this.runtime.selectedTile.timeStamp = (typeof event !== \"undefined\") ? event.timeStamp : new Date();\r\n\r\n    this.runtime.selectedTile.oldPosition = {\r\n\r\n      left: {\r\n        percent: 100 * tile.col,\r\n        pixels: this.metrics.tileWidth * tile.col\r\n      },\r\n      top: {\r\n        percent: 100 * tile.row,\r\n        pixels: this.metrics.tileHeight * tile.row\r\n      }\r\n\r\n    };\r\n    this.runtime.selectedTile.offset = (typeof event !== \"undefined\") ? {\r\n      top: ((event.pageY - this.metrics.top - this.metrics.borderSize.pixels) % this.metrics.tileHeight),\r\n      left: ((event.pageX - this.metrics.left - this.metrics.borderSize.pixels) % this.metrics.tileWidth)\r\n    } : {\r\n      top: this.metrics.tileHeight / 2,\r\n      left: this.metrics.tileWidth / 2\r\n    };\r\n\r\n    this.runtime.selectedTile.newPosition = {\r\n      top: {\r\n        min: {\r\n          pixels: null,\r\n          percent: null\r\n        },\r\n        newValue: {\r\n          pixels: null,\r\n          percent: null\r\n        },\r\n        max: {\r\n          pixels: null,\r\n          percent: null\r\n        }\r\n      },\r\n      left: {\r\n        min: {\r\n          pixels: null,\r\n          percent: null\r\n        },\r\n        newValue: {\r\n          pixels: null,\r\n          percent: null\r\n        },\r\n        max: {\r\n          pixels: null,\r\n          percent: null\r\n        }\r\n      }\r\n    };\r\n\r\n    switch (direction) {\r\n\r\n      case this.config.labels.UP:\r\n        this.runtime.selectedTile.newPosition.top.min.pixels = Math.round(this.runtime.selectedTile.oldPosition.top.pixels - this.metrics.tileHeight);\r\n        this.runtime.selectedTile.newPosition.top.max.pixels = Math.round(this.runtime.selectedTile.oldPosition.top.pixels);\r\n        this.runtime.selectedTile.newPosition.left.min.pixels = Math.round(this.runtime.selectedTile.oldPosition.left.pixels);\r\n        this.runtime.selectedTile.newPosition.left.max.pixels = Math.round(this.runtime.selectedTile.oldPosition.left.pixels);\r\n        break;\r\n\r\n      case this.config.labels.DOWN:\r\n        this.runtime.selectedTile.newPosition.top.min.pixels = Math.round(this.runtime.selectedTile.oldPosition.top.pixels);\r\n        this.runtime.selectedTile.newPosition.top.max.pixels = Math.round(this.runtime.selectedTile.oldPosition.top.pixels + this.metrics.tileHeight);\r\n        this.runtime.selectedTile.newPosition.left.min.pixels = Math.round(this.runtime.selectedTile.oldPosition.left.pixels);\r\n        this.runtime.selectedTile.newPosition.left.max.pixels = Math.round(this.runtime.selectedTile.oldPosition.left.pixels);\r\n        break;\r\n\r\n      case this.config.labels.LEFT:\r\n        this.runtime.selectedTile.newPosition.left.min.pixels = Math.round(this.runtime.selectedTile.oldPosition.left.pixels - this.metrics.tileWidth);\r\n        this.runtime.selectedTile.newPosition.left.max.pixels = Math.round(this.runtime.selectedTile.oldPosition.left.pixels);\r\n        this.runtime.selectedTile.newPosition.top.min.pixels = Math.round(this.runtime.selectedTile.oldPosition.top.pixels);\r\n        this.runtime.selectedTile.newPosition.top.max.pixels = Math.round(this.runtime.selectedTile.oldPosition.top.pixels);\r\n        break;\r\n\r\n      case this.config.labels.RIGHT:\r\n        this.runtime.selectedTile.newPosition.left.min.pixels = Math.round(this.runtime.selectedTile.oldPosition.left.pixels);\r\n        this.runtime.selectedTile.newPosition.left.max.pixels = Math.round(this.runtime.selectedTile.oldPosition.left.pixels + this.metrics.tileWidth);\r\n        this.runtime.selectedTile.newPosition.top.min.pixels = Math.round(this.runtime.selectedTile.oldPosition.top.pixels);\r\n        this.runtime.selectedTile.newPosition.top.max.pixels = Math.round(this.runtime.selectedTile.oldPosition.top.pixels);\r\n        break;\r\n    }\r\n\r\n    if (!this.runtime.dragging) {\r\n      this.utils.addClass(tile.htmlElement, this.config.labels.PRESSED_LABEL +\r\n        \" \" +\r\n        this.config.labels.SELECTED_LABEL);\r\n    }\r\n\r\n    if (tile.canPush !== false && this.config.pushMultiple) {\r\n\r\n      tile.canPush.tiles = [];\r\n\r\n      for (var i = 1; i <= tile.canPush.n; i++) {\r\n\r\n        switch (tile.canPush.direction) {\r\n\r\n          case this.config.labels.UP:\r\n            tile.canPush.tiles.push(this.getTile({\r\n              col: tile.col,\r\n              row: tile.row - i\r\n            }));\r\n            break;\r\n\r\n          case this.config.labels.RIGHT:\r\n            tile.canPush.tiles.push(this.getTile({\r\n              col: tile.col + i,\r\n              row: tile.row\r\n            }));\r\n            break;\r\n\r\n          case this.config.labels.DOWN:\r\n            tile.canPush.tiles.push(this.getTile({\r\n              col: tile.col,\r\n              row: tile.row + i\r\n            }));\r\n            break;\r\n\r\n          case this.config.labels.LEFT:\r\n            tile.canPush.tiles.push(this.getTile({\r\n              col: tile.col - i,\r\n              row: tile.row\r\n            }));\r\n            break;\r\n\r\n        }\r\n\r\n        tile.canPush.tiles[i - 1].max = null;\r\n\r\n      }\r\n\r\n    }\r\n\r\n    this.vibrate(\"select\");\r\n\r\n    if (!!tile.canMove || !!tile.canPush) {\r\n      this.runtime.dragging = true;\r\n    }\r\n\r\n    //console.log(\"selected\",tile);\r\n\r\n  }\r\n};\r\n","game.setBgImage = function(params) {\r\n  \"use strict\";\r\n\r\n  if (!document.createElement ||\r\n    typeof params.imgUrl !== \"string\"\r\n  ) {\r\n    return false;\r\n  }\r\n\r\n  var img = document.getElementById(this.config.labels.BACKGROUND_IMAGE_ID) || document.createElement(\"img\");\r\n  var rgb = {};\r\n\r\n  console.log(\"loading image \" + params.imgUrl + \"...\");\r\n  img.crossOrigin = '';\r\n  img.src = params.imgUrl;\r\n  img.crossOrigin = \"\";\r\n  img.id = this.config.labels.BACKGROUND_IMAGE_ID;\r\n\r\n  this.utils.listenTo(img, \"load\", function(event, context) {\r\n      console.log(\"background image loading complete\", img)\r\n      context.applyBgImage(event.target);\r\n    },\r\n    this.runtime.eventListeners,\r\n    this\r\n  );\r\n\r\n  return true;\r\n\r\n};\r\n\r\n\r\ngame.applyBgImage = function(img) {\r\n\r\n  \"use strict\";\r\n\r\n  var i;\r\n  var tileName;\r\n  var tile;\r\n  var averageRGB;\r\n\r\n  this.runtime.backgroundImage = this.runtime.backgroundImage || {};\r\n  this.runtime.backgroundImage.src = img.src;\r\n\r\n\r\n  for (tileName in this.runtime.tiles) {\r\n    tile = this.getTile(tileName).htmlElement;\r\n    for (i = 0; i < tile.childNodes.length; i++) {\r\n      if (tile.childNodes[i].className === this.config.labels.TILE_INNER_CLASS) {\r\n        tile.childNodes[i].style.backgroundImage = \"url(\" + img.src + \")\";\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  document.getElementById(this.config.labels.BACKGROUND_CONTAINER_ID).appendChild(img);\r\n\r\n  averageRGB = this.utils.getAverageRGB(img);\r\n\r\n  console.log(\"The average color for this image is \", averageRGB);\r\n\r\n  this.applyBgColor(averageRGB);\r\n\r\n  this.utils.stopListeningTo(\r\n    img,\r\n    \"load\",\r\n    this.runtime.eventListeners\r\n  );\r\n\r\n};\r\n\r\ngame.adjustColor = function(rgb, mode, amount) {\r\n  \"use strict\";\r\n\r\n  if (typeof rgb === \"undefined\") {\r\n    console.log(\"which color?\");\r\n    return false;\r\n  }\r\n  if (typeof amount !== \"number\") {\r\n    amount = 0.25;\r\n  }\r\n\r\n  function limit(n, min, max) {\r\n\r\n    n = Math.round(n);\r\n\r\n    if (n < min) {\r\n      return min;\r\n    }\r\n    if (n > max) {\r\n      return max;\r\n    }\r\n    return n;\r\n  }\r\n\r\n  switch (mode) {\r\n\r\n    case \"brighter\":\r\n      return {\r\n        r: limit(rgb.r * (1 + amount), 0, 255),\r\n        g: limit(rgb.g * (1 + amount), 0, 255),\r\n        b: limit(rgb.b * (1 + amount), 0, 255)\r\n      };\r\n\r\n    case \"darker\":\r\n      return {\r\n        r: limit(rgb.r * (1 - amount), 0, 255),\r\n        g: limit(rgb.g * (1 - amount), 0, 255),\r\n        b: limit(rgb.b * (1 - amount), 0, 255)\r\n      };\r\n\r\n    default:\r\n      console.log(\"color not changed\", rgb);\r\n      return rgb;\r\n\r\n  };\r\n\r\n};\r\n\r\ngame.applyBgColor = function(rgb) {\r\n\r\n  \"use strict\";\r\n\r\n  var rgbVal = \"rgb(\" + rgb.r + \",\" + rgb.g + \",\" + rgb.b + \")\";\r\n\r\n  var rgbDark = this.adjustColor(rgb, \"darker\", 0.75);\r\n  var rgbDarkVal = \"rgb(\" + rgbDark.r + \",\" + rgbDark.g + \",\" + rgbDark.b + \")\";\r\n\r\n\r\n  var rgbBright = this.adjustColor(rgb, \"brighter\", 0.25);\r\n  var rgbBrightVal = \"rgb(\" + rgbBright.r + \",\" + rgbBright.g + \",\" + rgbBright.b + \")\";\r\n\r\n\r\n  this.runtime.backgroundImage = this.runtime.backgroundImage || {};\r\n  this.runtime.backgroundImage.averageRGB = rgb;\r\n  this.runtime.backgroundImage.averageRGB_darker = rgbDark;\r\n  this.runtime.backgroundImage.averageRGB_brighter = rgbBright;\r\n\r\n  document.getElementById(this.config.labels.BACKGROUND_CONTAINER_ID).style.backgroundColor = rgbVal;\r\n  document.getElementById(this.config.labels.GAME_ID).style.backgroundColor = rgbBrightVal;\r\n\r\n\r\n  var currentBoxShadow = this.utils.editCSSRule(\"#\" + this.config.labels.BOARD_ID + \" .\" + this.config.labels.TILE_INNER_CLASS, \"boxShadow\");\r\n\r\n  if (!!currentBoxShadow) {\r\n\r\n    var boxShadowProps = currentBoxShadow.replace(/,\\s+/g, \",\").split(\" \");\r\n\r\n    for (var i = 0; i < boxShadowProps.length; i++) {\r\n      if (boxShadowProps[i].indexOf(\"rgb\") > -1 || boxShadowProps[i].indexOf(\"#\") > -1) {\r\n        boxShadowProps[i] = rgbDarkVal;\r\n      };\r\n      break;\r\n    }\r\n\r\n    this.utils.editCSSRule(\"#\" + this.config.labels.BOARD_ID + \" .\" + this.config.labels.TILE_INNER_CLASS, \"boxShadow\", boxShadowProps.join(\" \"));\r\n\r\n    document.getElementById(this.config.labels.BOARD_ID).style.backgroundColor = rgbDarkVal;\r\n\r\n  };\r\n\r\n};\r\n","game.shuffle = function(n, refresh) {\r\n  \"use strict\";\r\n\r\n  console.log(\"shuffle\");\r\n  this.vibrate(\"shuffle\");\r\n\r\n  if (typeof n === \"undefined\") {\r\n    n = 10 * this.config.size.n;\r\n  }\r\n  if (typeof refresh === \"undefined\") {\r\n    refresh = true;\r\n  }\r\n\r\n  var directions = [\r\n    this.config.labels.UP,\r\n    this.config.labels.RIGHT,\r\n    this.config.labels.DOWN,\r\n    this.config.labels.LEFT\r\n  ];\r\n\r\n  var movableTiles = [];\r\n\r\n  var d;\r\n\r\n  for (var i = 0; i < n; i++) {\r\n    d = directions[Math.round(Math.random() * (directions.length - 1))];\r\n\r\n    movableTiles = this.getMovableTiles({\r\n      direction: d,\r\n      pushing: false,\r\n      moving: true,\r\n      force: true\r\n    });\r\n\r\n    this.moveTile(\r\n      movableTiles[0], {\r\n        transitions: false,\r\n        force: true,\r\n        refresh: true\r\n      }\r\n    );\r\n  }\r\n\r\n  if (refresh) {\r\n    this.refresh({\r\n      transitions: true,\r\n      transitionDuration: 100\r\n    });\r\n  }\r\n\r\n};\r\n","game.start = function() {\r\n  \"use strict\";\r\n  this.runtime.started = new Date(); //   - - saves the time of game start\r\n  this.runtime.ended = false;\r\n  this.runtime.running = true; //   - - when true the game checks if the user has won at every move during refresh\r\n  this.runtime.movesCount = 0;\r\n  console.log(\"game started\");\r\n};\r\n","game.stop = function() {\r\n  \"use strict\";\r\n  //    - reverse start()\r\n  this.runtime.ended = new Date(); //   - - saves the time of game end\r\n  this.runtime.running = false; //    - - the game won't check if the user has won\r\n  console.log(\"game stopped\");\r\n};\r\n","game.vibrate = function(reasonToVibrate) {\r\n  \"use strict\";\r\n  return false;\r\n  var pattern = [20]\r\n\r\n  switch (reasonToVibrate) {\r\n\r\n    case \"select\":\r\n      pattern = [40];\r\n      break;\r\n\r\n    case \"bump\":\r\n      pattern = [60];\r\n      break;\r\n\r\n    case \"deselect\":\r\n      pattern = [30];\r\n      break;\r\n\r\n    case \"suffle\":\r\n      pattern = [Math.round(Math.random() * 300), Math.round(Math.random() * 300), Math.round(Math.random() * 300), Math.round(Math.random() * 300)];\r\n      break;\r\n\r\n    case \"move\":\r\n      pattern = [20];\r\n      break;\r\n\r\n    default:\r\n      break;\r\n  }\r\n\r\n  console.log(\"vibrate\", reasonToVibrate, pattern);\r\n\r\n  if (window.navigator && window.navigator.vibrate) {\r\n    window.navigator.vibrate(pattern);\r\n  };\r\n\r\n};\r\n"]}